<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interactive BOM for KiCAD</title>
  <style type="text/css">
:root {
  --pcb-edge-color: black;
  --pad-color: #878787;
  --pad-hole-color: #CCCCCC;
  --pad-color-highlight: #D04040;
  --pin1-outline-color: #ffb629;
  --pin1-outline-color-highlight: #b4ff03;
  --silkscreen-edge-color: #aa4;
  --silkscreen-polygon-color: #4aa;
  --silkscreen-text-color: #4aa;
  --fabrication-edge-color: #907651;
  --fabrication-polygon-color: #907651;
  --fabrication-text-color: #a27c24;
  --track-color: #def5f1;
  --track-color-highlight: #D04040;
  --zone-color: #def5f1;
  --zone-color-highlight: #d0404080;
}

html, body {
  margin: 0px;
  height: 100%;
  font-family: Verdana, sans-serif;
}

.dark.topmostdiv {
  --pcb-edge-color: #eee;
  --pad-color: #808080;
  --pin1-outline-color: #ffa800;
  --pin1-outline-color-highlight: #ccff00;
  --track-color: #42524f;
  --zone-color: #42524f;
  background-color: #252c30;
  color: #eee;
}

button {
  background-color: #eee;
  border: 1px solid #888;
  color: black;
  height: 44px;
  width: 44px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 14px;
  font-weight: bolder;
}

.dark button {
  /* This will be inverted */
  background-color: #c3b7b5;
}

button.depressed {
  background-color: #0a0;
  color: white;
}

.dark button.depressed {
  /* This will be inverted */
  background-color: #b3b;
}

button:focus {
  outline: 0;
}

button#tb-btn {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8.47 8.47'%3E%3Crect transform='translate(0 -288.53)' ry='1.17' y='288.8' x='.27' height='7.94' width='7.94' fill='%23f9f9f9'/%3E%3Cg transform='translate(0 -288.53)'%3E%3Crect width='7.94' height='7.94' x='.27' y='288.8' ry='1.17' fill='none' stroke='%23000' stroke-width='.4' stroke-linejoin='round'/%3E%3Cpath d='M1.32 290.12h5.82M1.32 291.45h5.82' fill='none' stroke='%23000' stroke-width='.4'/%3E%3Cpath d='M4.37 292.5v4.23M.26 292.63H8.2' fill='none' stroke='%23000' stroke-width='.3'/%3E%3Ctext font-weight='700' font-size='3.17' font-family='sans-serif'%3E%3Ctspan x='1.35' y='295.73'%3EF%3C/tspan%3E%3Ctspan x='5.03' y='295.68'%3EB%3C/tspan%3E%3C/text%3E%3C/g%3E%3C/svg%3E%0A");
}

button#lr-btn {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8.47 8.47'%3E%3Crect transform='translate(0 -288.53)' ry='1.17' y='288.8' x='.27' height='7.94' width='7.94' fill='%23f9f9f9'/%3E%3Cg transform='translate(0 -288.53)'%3E%3Crect width='7.94' height='7.94' x='.27' y='288.8' ry='1.17' fill='none' stroke='%23000' stroke-width='.4' stroke-linejoin='round'/%3E%3Cpath d='M1.06 290.12H3.7m-2.64 1.33H3.7m-2.64 1.32H3.7m-2.64 1.3H3.7m-2.64 1.33H3.7' fill='none' stroke='%23000' stroke-width='.4'/%3E%3Cpath d='M4.37 288.8v7.94m0-4.11h3.96' fill='none' stroke='%23000' stroke-width='.3'/%3E%3Ctext font-weight='700' font-size='3.17' font-family='sans-serif'%3E%3Ctspan x='5.11' y='291.96'%3EF%3C/tspan%3E%3Ctspan x='5.03' y='295.68'%3EB%3C/tspan%3E%3C/text%3E%3C/g%3E%3C/svg%3E%0A");
}

button#bom-btn {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8.47 8.47'%3E%3Crect transform='translate(0 -288.53)' ry='1.17' y='288.8' x='.27' height='7.94' width='7.94' fill='%23f9f9f9'/%3E%3Cg transform='translate(0 -288.53)' fill='none' stroke='%23000' stroke-width='.4'%3E%3Crect width='7.94' height='7.94' x='.27' y='288.8' ry='1.17' stroke-linejoin='round'/%3E%3Cpath d='M1.59 290.12h5.29M1.59 291.45h5.33M1.59 292.75h5.33M1.59 294.09h5.33M1.59 295.41h5.33'/%3E%3C/g%3E%3C/svg%3E");
}

button#bom-grouped-btn {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32'%3E%3Cg stroke='%23000' stroke-linejoin='round' class='layer'%3E%3Crect width='29' height='29' x='1.5' y='1.5' stroke-width='2' fill='%23fff' rx='5' ry='5'/%3E%3Cpath stroke-linecap='square' stroke-width='2' d='M6 10h4m4 0h5m4 0h3M6.1 22h3m3.9 0h5m4 0h4m-16-8h4m4 0h4'/%3E%3Cpath stroke-linecap='null' d='M5 17.5h22M5 26.6h22M5 5.5h22'/%3E%3C/g%3E%3C/svg%3E");
}

button#bom-ungrouped-btn {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32'%3E%3Cg stroke='%23000' stroke-linejoin='round' class='layer'%3E%3Crect width='29' height='29' x='1.5' y='1.5' stroke-width='2' fill='%23fff' rx='5' ry='5'/%3E%3Cpath stroke-linecap='square' stroke-width='2' d='M6 10h4m-4 8h3m-3 8h4'/%3E%3Cpath stroke-linecap='null' d='M5 13.5h22m-22 8h22M5 5.5h22'/%3E%3C/g%3E%3C/svg%3E");
}

button#bom-netlist-btn {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32'%3E%3Cg fill='none' stroke='%23000' class='layer'%3E%3Crect width='29' height='29' x='1.5' y='1.5' stroke-width='2' fill='%23fff' rx='5' ry='5'/%3E%3Cpath stroke-width='2' d='M6 26l6-6v-8m13.8-6.3l-6 6v8'/%3E%3Ccircle cx='11.8' cy='9.5' r='2.8' stroke-width='2'/%3E%3Ccircle cx='19.8' cy='22.8' r='2.8' stroke-width='2'/%3E%3C/g%3E%3C/svg%3E");
}

button#copy {
  background-image: url("data:image/svg+xml,%3Csvg height='48' viewBox='0 0 48 48' width='48' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0h48v48h-48z' fill='none'/%3E%3Cpath d='M32 2h-24c-2.21 0-4 1.79-4 4v28h4v-28h24v-4zm6 8h-22c-2.21 0-4 1.79-4 4v28c0 2.21 1.79 4 4 4h22c2.21 0 4-1.79 4-4v-28c0-2.21-1.79-4-4-4zm0 32h-22v-28h22v28z'/%3E%3C/svg%3E");
  background-position: 6px 6px;
  background-repeat: no-repeat;
  background-size: 26px 26px;
  border-radius: 6px;
  height: 40px;
  width: 40px;
  margin: 10px 5px;
}

button#copy:active {
    box-shadow: inset 0px 0px 5px #6c6c6c;
}

textarea.clipboard-temp {
  position: fixed;
  top: 0;
  left: 0;
  width: 2em;
  height: 2em;
  padding: 0;
  border: None;
  outline: None;
  box-shadow: None;
  background: transparent;
}

.left-most-button {
  border-right: 0;
  border-top-left-radius: 6px;
  border-bottom-left-radius: 6px;
}

.middle-button {
  border-right: 0;
}

.right-most-button {
  border-top-right-radius: 6px;
  border-bottom-right-radius: 6px;
}

.button-container {
  font-size: 0;
  margin: 10px 10px 10px 0px;
}

.dark .button-container {
  filter: invert(1);
}

.button-container button {
  background-size: 32px 32px;
  background-position: 5px 5px;
  background-repeat: no-repeat;
}

@media print {
  .hideonprint {
    display: none;
  }
}

canvas {
  cursor: crosshair;
}

canvas:active {
  cursor: grabbing;
}

.fileinfo {
  width: 100%;
  max-width: 1000px;
  border: none;
  padding: 5px;
}

.fileinfo .title {
  font-size: 20pt;
  font-weight: bold;
}

.fileinfo td {
  overflow: hidden;
  white-space: nowrap;
  max-width: 1px;
  width: 50%;
  text-overflow: ellipsis;
}

.bom {
  border-collapse: collapse;
  font-family: Consolas, "DejaVu Sans Mono", Monaco, monospace;
  font-size: 10pt;
  table-layout: fixed;
  width: 100%;
  margin-top: 1px;
}

.bom th, .bom td {
  border: 1px solid black;
  padding: 5px;
  word-wrap: break-word;
  text-align: center;
  position: relative;
}

.dark .bom th, .dark .bom td {
  border: 1px solid #777;
}

.bom th {
  background-color: #CCCCCC;
  background-clip: padding-box;
}

.dark .bom th {
  background-color: #3b4749;
}

.bom tr.highlighted:nth-child(n) {
  background-color: #cfc;
}

.dark .bom tr.highlighted:nth-child(n) {
  background-color: #226022;
}

.bom tr:nth-child(even) {
  background-color: #f2f2f2;
}

.dark .bom tr:nth-child(even) {
  background-color: #313b40;
}

.bom tr.checked {
  color: #aaa;
}

.dark .bom tr.checked {
  color: #666;
}

.bom tr {
  transition: background-color 0.2s;
}

.bom .numCol {
  width: 25px;
}

.bom .Description {
  width: 10%;
}

.bom .Part {
  width: 10%;
}

.bom .Value {
  width: 15%;
}

.bom .Quantity {
  width: 65px;
}

.bom th .sortmark {
  position: absolute;
  right: 1px;
  top: 1px;
  margin-top: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #221 transparent;
  transform-origin: 50% 85%;
  transition: opacity 0.2s, transform 0.4s;
}

.dark .bom th .sortmark {
  filter: invert(1);
}

.bom th .sortmark.none {
  opacity: 0;
}

.bom th .sortmark.desc {
  transform: rotate(180deg);
}

.bom th:hover .sortmark.none {
  opacity: 0.5;
}

.bom .bom-checkbox {
  width: 30px;
  position: relative;
  user-select: none;
  -moz-user-select: none;
}

.bom .bom-checkbox:before {
  content: "";
  position: absolute;
  border-width: 15px;
  border-style: solid;
  border-color: #51829f transparent transparent transparent;
  visibility: hidden;
  top: -15px;
}

.bom .bom-checkbox:after {
  content: "Double click to set/unset all";
  position: absolute;
  color: white;
  top: -35px;
  left: -26px;
  background: #51829f;
  padding: 5px 15px;
  border-radius: 8px;
  white-space: nowrap;
  visibility: hidden;
}

.bom .bom-checkbox:hover:before, .bom .bom-checkbox:hover:after {
  visibility: visible;
  transition: visibility 0.2s linear 1s;
}

.split {
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
  overflow-y: auto;
  overflow-x: hidden;
  background-color: inherit;
}

.split.split-horizontal, .gutter.gutter-horizontal {
  height: 100%;
  float: left;
}

.gutter {
  background-color: #ddd;
  background-repeat: no-repeat;
  background-position: 50%;
  transition: background-color 0.3s;
}

.dark .gutter {
  background-color: #777;
}

.gutter.gutter-horizontal {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAeCAYAAADkftS9AAAAIklEQVQoU2M4c+bMfxAGAgYYmwGrIIiDjrELjpo5aiZeMwF+yNnOs5KSvgAAAABJRU5ErkJggg==');
  cursor: ew-resize;
  width: 5px;
}

.gutter.gutter-vertical {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAFAQMAAABo7865AAAABlBMVEVHcEzMzMzyAv2sAAAAAXRSTlMAQObYZgAAABBJREFUeF5jOAMEEAIEEFwAn3kMwcB6I2AAAAAASUVORK5CYII=');
  cursor: ns-resize;
  height: 5px;
}

.searchbox {
  float: left;
  height: 40px;
  margin: 10px 5px;
  padding: 12px 32px;
  font-family: Consolas, "DejaVu Sans Mono", Monaco, monospace;
  font-size: 18px;
  box-sizing: border-box;
  border: 1px solid #888;
  border-radius: 6px;
  outline: none;
  background-color: #eee;
  transition: background-color 0.2s, border 0.2s;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABNklEQVQ4T8XSMUvDQBQH8P/LElFa/AIZHcTBQSz0I/gFstTBRR2KUC4ldDxw7h0Bl3RRUATxi4iiODgoiLNrbQYp5J6cpJJqomkX33Z37/14d/dIa33MzDuYI4johOI4XhyNRteO46zNYjDzAxE1yBZprVeZ+QbAUhXEGJMA2Ox2u4+fQIa0mPmsCgCgJYQ4t7lfgF0opQYAdv9ABkKI/UnOFCClXKjX61cA1osQY8x9kiRNKeV7IWA3oyhaSdP0FkAtjxhj3hzH2RBCPOf3pzqYHCilfAAX+URm9oMguPzeWSGQvUcMYC8rOBJCHBRdqxTo9/vbRHRqi8bj8XKv1xvODbiuW2u32/bvf0SlDv4XYOY7z/Mavu+nM1+BmQ+NMc0wDF/LprP0DbTWW0T00ul0nn4b7Q87+X4Qmfiq2wAAAABJRU5ErkJggg==');
  background-position: 10px 10px;
  background-repeat: no-repeat;
}

.dark .searchbox {
  background-color: #111;
  color: #eee;
}

.searchbox::placeholder {
  color: #ccc;
}

.dark .searchbox::placeholder {
  color: #666;
}

.filter {
  width: calc(60% - 64px);
}

.reflookup {
  width: calc(40% - 10px);
}

input[type=text]:focus {
  background-color: white;
  border: 1px solid #333;
}

.dark input[type=text]:focus {
  background-color: #333;
  border: 1px solid #ccc;
}

mark.highlight {
  background-color: #5050ff;
  color: #fff;
  padding: 2px;
  border-radius: 6px;
}

.dark mark.highlight {
  background-color: #76a6da;
  color: #111;
}

.menubtn {
  background-color: white;
  border: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='36' height='36' viewBox='0 0 20 20'%3E%3Cpath fill='none' d='M0 0h20v20H0V0z'/%3E%3Cpath d='M15.95 10.78c.03-.25.05-.51.05-.78s-.02-.53-.06-.78l1.69-1.32c.15-.12.19-.34.1-.51l-1.6-2.77c-.1-.18-.31-.24-.49-.18l-1.99.8c-.42-.32-.86-.58-1.35-.78L12 2.34c-.03-.2-.2-.34-.4-.34H8.4c-.2 0-.36.14-.39.34l-.3 2.12c-.49.2-.94.47-1.35.78l-1.99-.8c-.18-.07-.39 0-.49.18l-1.6 2.77c-.1.18-.06.39.1.51l1.69 1.32c-.04.25-.07.52-.07.78s.02.53.06.78L2.37 12.1c-.15.12-.19.34-.1.51l1.6 2.77c.1.18.31.24.49.18l1.99-.8c.42.32.86.58 1.35.78l.3 2.12c.04.2.2.34.4.34h3.2c.2 0 .37-.14.39-.34l.3-2.12c.49-.2.94-.47 1.35-.78l1.99.8c.18.07.39 0 .49-.18l1.6-2.77c.1-.18.06-.39-.1-.51l-1.67-1.32zM10 13c-1.65 0-3-1.35-3-3s1.35-3 3-3 3 1.35 3 3-1.35 3-3 3z'/%3E%3C/svg%3E%0A");
  background-position: center;
  background-repeat: no-repeat;
}

.statsbtn {
  background-color: white;
  border: none;
  background-image: url("data:image/svg+xml,%3Csvg width='36' height='36' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M4 6h28v24H4V6zm0 8h28v8H4m9-16v24h10V5.8' fill='none' stroke='%23000' stroke-width='2'/%3E%3C/svg%3E");
  background-position: center;
  background-repeat: no-repeat;
}

.iobtn {
  background-color: white;
  border: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='36' height='36'%3E%3Cpath fill='none' stroke='%23000' stroke-width='2' d='M3 33v-7l6.8-7h16.5l6.7 7v7H3zM3.2 26H33M21 9l5-5.9 5 6h-2.5V15h-5V9H21zm-4.9 0l-5 6-5-6h2.5V3h5v6h2.5z'/%3E%3Cpath fill='none' stroke='%23000' d='M6.1 29.5H10'/%3E%3C/svg%3E");
  background-position: center;
  background-repeat: no-repeat;
}

.dark .statsbtn, .dark .savebtn, .dark .menubtn, .dark .iobtn {
  filter: invert(1);
}

.flexbox {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
}

.savebtn {
  background-color: #d6d6d6;
  width: auto;
  height: 30px;
  flex-grow: 1;
  margin: 5px;
  border-radius: 4px;
}

.savebtn:active {
  background-color: #0a0;
  color: white;
}

.dark .savebtn:active {
  /* This will be inverted */
  background-color: #b3b;
}

.stats {
  border-collapse: collapse;
  font-size: 12pt;
  table-layout: fixed;
  width: 100%;
  min-width: 450px;
}

.dark .stats td {
  border: 1px solid #bbb;
}

.stats td {
  border: 1px solid black;
  padding: 5px;
  word-wrap: break-word;
  text-align: center;
  position: relative;
}

#checkbox-stats div {
  position: absolute;
  left: 0;
  top: 0;
  height: 100%;
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}

#checkbox-stats .bar {
  background-color: rgba(28, 251, 0, 0.6);
}

.menu {
  position: relative;
  display: inline-block;
  margin: 10px 10px 10px 0px;
}

.menu-content {
  display: none;
  position: absolute;
  background-color: white;
  right: 0;
  min-width: 300px;
  box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
  z-index: 100;
  padding: 8px;
}

.dark .menu-content {
  background-color: #111;
}

.menu:hover .menu-content {
  display: block;
}

.menu:hover .menubtn, .menu:hover .iobtn, .menu:hover .statsbtn {
  background-color: #eee;
}

.menu-label {
  display: inline-block;
  padding: 8px;
  border: 1px solid #ccc;
  border-top: 0;
  width: calc(100% - 18px);
}

.menu-label-top {
  border-top: 1px solid #ccc;
}

.menu-textbox {
  float: left;
  height: 24px;
  margin: 10px 5px;
  padding: 5px 5px;
  font-family: Consolas, "DejaVu Sans Mono", Monaco, monospace;
  font-size: 14px;
  box-sizing: border-box;
  border: 1px solid #888;
  border-radius: 4px;
  outline: none;
  background-color: #eee;
  transition: background-color 0.2s, border 0.2s;
  width: calc(100% - 10px);
}

.menu-textbox.invalid, .dark .menu-textbox.invalid {
  color: red;
}

.dark .menu-textbox {
  background-color: #222;
  color: #eee;
}

.radio-container {
  margin: 4px;
}

.topmostdiv {
  width: 100%;
  height: 100%;
  background-color: white;
  transition: background-color 0.3s;
}

#top {
  height: 78px;
  border-bottom: 2px solid black;
}

.dark #top {
  border-bottom: 2px solid #ccc;
}

#dbg {
  display: block;
}

::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: #aaa;
}

::-webkit-scrollbar-thumb {
  background: #666;
  border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
  background: #555;
}

.slider {
  -webkit-appearance: none;
  width: 100%;
  margin: 3px 0;
  padding: 0;
  outline: none;
  opacity: 0.7;
  -webkit-transition: .2s;
  transition: opacity .2s;
  border-radius: 3px;
}

.slider:hover {
  opacity: 1;
}

.slider:focus {
  outline: none;
}

.slider::-webkit-slider-runnable-track {
  -webkit-appearance: none;
  width: 100%;
  height: 8px;
  background: #d3d3d3;
  border-radius: 3px;
  border: none;
}

.slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 15px;
  height: 15px;
  border-radius: 50%;
  background: #0a0;
  cursor: pointer;
  margin-top: -4px;
}

.dark .slider::-webkit-slider-thumb {
  background: #3d3;
}

.slider::-moz-range-thumb {
  width: 15px;
  height: 15px;
  border-radius: 50%;
  background: #0a0;
  cursor: pointer;
}

.slider::-moz-range-track {
  height: 8px;
  background: #d3d3d3;
  border-radius: 3px;
}

.dark .slider::-moz-range-thumb {
  background: #3d3;
}

.slider::-ms-track {
  width: 100%;
  height: 8px;
  border-width: 3px 0;
  background: transparent;
  border-color: transparent;
  color: transparent;
  transition: opacity .2s;
}

.slider::-ms-fill-lower {
  background: #d3d3d3;
  border: none;
  border-radius: 3px;
}

.slider::-ms-fill-upper {
  background: #d3d3d3;
  border: none;
  border-radius: 3px;
}

.slider::-ms-thumb {
  width: 15px;
  height: 15px;
  border-radius: 50%;
  background: #0a0;
  cursor: pointer;
  margin: 0;
}

.shameless-plug {
  font-size: 0.8em;
  text-align: center;
  display: block;
}

a {
  color: #0278a4;
}

.dark a {
  color: #00b9fd;
}

#frontcanvas, #backcanvas {
    touch-action: none;
}

 
  </style>
  <script type="text/javascript" >
///////////////////////////////////////////////
/*
  Split.js - v1.3.5
  MIT License
  https://github.com/nathancahill/Split.js
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Split=t()}(this,function(){"use strict";var e=window,t=e.document,n="addEventListener",i="removeEventListener",r="getBoundingClientRect",s=function(){return!1},o=e.attachEvent&&!e[n],a=["","-webkit-","-moz-","-o-"].filter(function(e){var n=t.createElement("div");return n.style.cssText="width:"+e+"calc(9px)",!!n.style.length}).shift()+"calc",l=function(e){return"string"==typeof e||e instanceof String?t.querySelector(e):e};return function(u,c){function z(e,t,n){var i=A(y,t,n);Object.keys(i).forEach(function(t){return e.style[t]=i[t]})}function h(e,t){var n=B(y,t);Object.keys(n).forEach(function(t){return e.style[t]=n[t]})}function f(e){var t=E[this.a],n=E[this.b],i=t.size+n.size;t.size=e/this.size*i,n.size=i-e/this.size*i,z(t.element,t.size,this.aGutterSize),z(n.element,n.size,this.bGutterSize)}function m(e){var t;this.dragging&&((t="touches"in e?e.touches[0][b]-this.start:e[b]-this.start)<=E[this.a].minSize+M+this.aGutterSize?t=E[this.a].minSize+this.aGutterSize:t>=this.size-(E[this.b].minSize+M+this.bGutterSize)&&(t=this.size-(E[this.b].minSize+this.bGutterSize)),f.call(this,t),c.onDrag&&c.onDrag())}function g(){var e=E[this.a].element,t=E[this.b].element;this.size=e[r]()[y]+t[r]()[y]+this.aGutterSize+this.bGutterSize,this.start=e[r]()[G]}function d(){var t=this,n=E[t.a].element,r=E[t.b].element;t.dragging&&c.onDragEnd&&c.onDragEnd(),t.dragging=!1,e[i]("mouseup",t.stop),e[i]("touchend",t.stop),e[i]("touchcancel",t.stop),t.parent[i]("mousemove",t.move),t.parent[i]("touchmove",t.move),delete t.stop,delete t.move,n[i]("selectstart",s),n[i]("dragstart",s),r[i]("selectstart",s),r[i]("dragstart",s),n.style.userSelect="",n.style.webkitUserSelect="",n.style.MozUserSelect="",n.style.pointerEvents="",r.style.userSelect="",r.style.webkitUserSelect="",r.style.MozUserSelect="",r.style.pointerEvents="",t.gutter.style.cursor="",t.parent.style.cursor=""}function S(t){var i=this,r=E[i.a].element,o=E[i.b].element;!i.dragging&&c.onDragStart&&c.onDragStart(),t.preventDefault(),i.dragging=!0,i.move=m.bind(i),i.stop=d.bind(i),e[n]("mouseup",i.stop),e[n]("touchend",i.stop),e[n]("touchcancel",i.stop),i.parent[n]("mousemove",i.move),i.parent[n]("touchmove",i.move),r[n]("selectstart",s),r[n]("dragstart",s),o[n]("selectstart",s),o[n]("dragstart",s),r.style.userSelect="none",r.style.webkitUserSelect="none",r.style.MozUserSelect="none",r.style.pointerEvents="none",o.style.userSelect="none",o.style.webkitUserSelect="none",o.style.MozUserSelect="none",o.style.pointerEvents="none",i.gutter.style.cursor=j,i.parent.style.cursor=j,g.call(i)}function v(e){e.forEach(function(t,n){if(n>0){var i=F[n-1],r=E[i.a],s=E[i.b];r.size=e[n-1],s.size=t,z(r.element,r.size,i.aGutterSize),z(s.element,s.size,i.bGutterSize)}})}function p(){F.forEach(function(e){e.parent.removeChild(e.gutter),E[e.a].element.style[y]="",E[e.b].element.style[y]=""})}void 0===c&&(c={});var y,b,G,E,w=l(u[0]).parentNode,D=e.getComputedStyle(w).flexDirection,U=c.sizes||u.map(function(){return 100/u.length}),k=void 0!==c.minSize?c.minSize:100,x=Array.isArray(k)?k:u.map(function(){return k}),L=void 0!==c.gutterSize?c.gutterSize:10,M=void 0!==c.snapOffset?c.snapOffset:30,O=c.direction||"horizontal",j=c.cursor||("horizontal"===O?"ew-resize":"ns-resize"),C=c.gutter||function(e,n){var i=t.createElement("div");return i.className="gutter gutter-"+n,i},A=c.elementStyle||function(e,t,n){var i={};return"string"==typeof t||t instanceof String?i[e]=t:i[e]=o?t+"%":a+"("+t+"% - "+n+"px)",i},B=c.gutterStyle||function(e,t){return n={},n[e]=t+"px",n;var n};"horizontal"===O?(y="width","clientWidth",b="clientX",G="left","paddingLeft"):"vertical"===O&&(y="height","clientHeight",b="clientY",G="top","paddingTop");var F=[];return E=u.map(function(e,t){var i,s={element:l(e),size:U[t],minSize:x[t]};if(t>0&&(i={a:t-1,b:t,dragging:!1,isFirst:1===t,isLast:t===u.length-1,direction:O,parent:w},i.aGutterSize=L,i.bGutterSize=L,i.isFirst&&(i.aGutterSize=L/2),i.isLast&&(i.bGutterSize=L/2),"row-reverse"===D||"column-reverse"===D)){var a=i.a;i.a=i.b,i.b=a}if(!o&&t>0){var c=C(t,O);h(c,L),c[n]("mousedown",S.bind(i)),c[n]("touchstart",S.bind(i)),w.insertBefore(c,s.element),i.gutter=c}0===t||t===u.length-1?z(s.element,s.size,L/2):z(s.element,s.size,L);var f=s.element[r]()[y];return f<s.minSize&&(s.minSize=f),t>0&&F.push(i),s}),o?{setSizes:v,destroy:p}:{setSizes:v,getSizes:function(){return E.map(function(e){return e.size})},collapse:function(e){if(e===F.length){var t=F[e-1];g.call(t),o||f.call(t,t.size-t.bGutterSize)}else{var n=F[e];g.call(n),o||f.call(n,n.aGutterSize)}},destroy:p}}});

///////////////////////////////////////////////

///////////////////////////////////////////////
// Copyright (c) 2013 Pieroxy <pieroxy@pieroxy.net>
// This work is free. You can redistribute it and/or modify it
// under the terms of the WTFPL, Version 2
// For more information see LICENSE.txt or http://www.wtfpl.net/
//
// For more information, the home page:
// http://pieroxy.net/blog/pages/lz-string/testing.html
//
// LZ-based compression algorithm, version 1.4.4
var LZString=function(){var o=String.fromCharCode,i={};var n={decompressFromBase64:function(o){return null==o?"":""==o?null:n._decompress(o.length,32,function(n){return function(o,n){if(!i[o]){i[o]={};for(var t=0;t<o.length;t++)i[o][o.charAt(t)]=t}return i[o][n]}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o.charAt(n))})},_decompress:function(i,n,t){var r,e,a,s,p,u,l,f=[],c=4,d=4,h=3,v="",g=[],m={val:t(0),position:n,index:1};for(r=0;r<3;r+=1)f[r]=r;for(a=0,p=Math.pow(2,2),u=1;u!=p;)s=m.val&m.position,m.position>>=1,0==m.position&&(m.position=n,m.val=t(m.index++)),a|=(s>0?1:0)*u,u<<=1;switch(a){case 0:for(a=0,p=Math.pow(2,8),u=1;u!=p;)s=m.val&m.position,m.position>>=1,0==m.position&&(m.position=n,m.val=t(m.index++)),a|=(s>0?1:0)*u,u<<=1;l=o(a);break;case 1:for(a=0,p=Math.pow(2,16),u=1;u!=p;)s=m.val&m.position,m.position>>=1,0==m.position&&(m.position=n,m.val=t(m.index++)),a|=(s>0?1:0)*u,u<<=1;l=o(a);break;case 2:return""}for(f[3]=l,e=l,g.push(l);;){if(m.index>i)return"";for(a=0,p=Math.pow(2,h),u=1;u!=p;)s=m.val&m.position,m.position>>=1,0==m.position&&(m.position=n,m.val=t(m.index++)),a|=(s>0?1:0)*u,u<<=1;switch(l=a){case 0:for(a=0,p=Math.pow(2,8),u=1;u!=p;)s=m.val&m.position,m.position>>=1,0==m.position&&(m.position=n,m.val=t(m.index++)),a|=(s>0?1:0)*u,u<<=1;f[d++]=o(a),l=d-1,c--;break;case 1:for(a=0,p=Math.pow(2,16),u=1;u!=p;)s=m.val&m.position,m.position>>=1,0==m.position&&(m.position=n,m.val=t(m.index++)),a|=(s>0?1:0)*u,u<<=1;f[d++]=o(a),l=d-1,c--;break;case 2:return g.join("")}if(0==c&&(c=Math.pow(2,h),h++),f[l])v=f[l];else{if(l!==d)return null;v=e+e.charAt(0)}g.push(v),f[d++]=e+v.charAt(0),e=v,0==--c&&(c=Math.pow(2,h),h++)}}};return n}();"function"==typeof define&&define.amd?define(function(){return LZString}):"undefined"!=typeof module&&null!=module?module.exports=LZString:"undefined"!=typeof angular&&null!=angular&&angular.module("LZString",[]).factory("LZString",function(){return LZString});
///////////////////////////////////////////////

///////////////////////////////////////////////
/*!
 * PEP v0.4.3 | https://github.com/jquery/PEP
 * Copyright jQuery Foundation and other contributors | http://jquery.org/license
 */
! function (a, b) {
  "object" == typeof exports && "undefined" != typeof module ? module.exports = b() : "function" == typeof define && define.amd ? define(b) : a.PointerEventsPolyfill = b()
}(this, function () {
  "use strict";

  function a(a, b) {
    b = b || Object.create(null);
    var c = document.createEvent("Event");
    c.initEvent(a, b.bubbles || !1, b.cancelable || !1);
    for (var d, e = 2; e < m.length; e++) d = m[e], c[d] = b[d] || n[e];
    c.buttons = b.buttons || 0;
    var f = 0;
    return f = b.pressure && c.buttons ? b.pressure : c.buttons ? .5 : 0, c.x = c.clientX, c.y = c.clientY, c.pointerId = b.pointerId || 0, c.width = b.width || 0, c.height = b.height || 0, c.pressure = f, c.tiltX = b.tiltX || 0, c.tiltY = b.tiltY || 0, c.twist = b.twist || 0, c.tangentialPressure = b.tangentialPressure || 0, c.pointerType = b.pointerType || "", c.hwTimestamp = b.hwTimestamp || 0, c.isPrimary = b.isPrimary || !1, c
  }

  function b() {
    this.array = [], this.size = 0
  }

  function c(a, b, c, d) {
    this.addCallback = a.bind(d), this.removeCallback = b.bind(d), this.changedCallback = c.bind(d), A && (this.observer = new A(this.mutationWatcher.bind(this)))
  }

  function d(a) {
    return "body /shadow-deep/ " + e(a)
  }

  function e(a) {
    return '[touch-action="' + a + '"]'
  }

  function f(a) {
    return "{ -ms-touch-action: " + a + "; touch-action: " + a + "; }"
  }

  function g() {
    if (F) {
      D.forEach(function (a) {
        String(a) === a ? (E += e(a) + f(a) + "\n", G && (E += d(a) + f(a) + "\n")) : (E += a.selectors.map(e) + f(a.rule) + "\n", G && (E += a.selectors.map(d) + f(a.rule) + "\n"))
      });
      var a = document.createElement("style");
      a.textContent = E, document.head.appendChild(a)
    }
  }

  function h() {
    if (!window.PointerEvent) {
      if (window.PointerEvent = a, window.navigator.msPointerEnabled) {
        var b = window.navigator.msMaxTouchPoints;
        Object.defineProperty(window.navigator, "maxTouchPoints", {
          value: b,
          enumerable: !0
        }), u.registerSource("ms", _)
      } else Object.defineProperty(window.navigator, "maxTouchPoints", {
        value: 0,
        enumerable: !0
      }), u.registerSource("mouse", N), void 0 !== window.ontouchstart && u.registerSource("touch", V);
      u.register(document)
    }
  }

  function i(a) {
    if (!u.pointermap.has(a)) {
      var b = new Error("InvalidPointerId");
      throw b.name = "InvalidPointerId", b
    }
  }

  function j(a) {
    for (var b = a.parentNode; b && b !== a.ownerDocument;) b = b.parentNode;
    if (!b) {
      var c = new Error("InvalidStateError");
      throw c.name = "InvalidStateError", c
    }
  }

  function k(a) {
    var b = u.pointermap.get(a);
    return 0 !== b.buttons
  }

  function l() {
    window.Element && !Element.prototype.setPointerCapture && Object.defineProperties(Element.prototype, {
      setPointerCapture: {
        value: W
      },
      releasePointerCapture: {
        value: X
      },
      hasPointerCapture: {
        value: Y
      }
    })
  }
  var m = ["bubbles", "cancelable", "view", "detail", "screenX", "screenY", "clientX", "clientY", "ctrlKey", "altKey", "shiftKey", "metaKey", "button", "relatedTarget", "pageX", "pageY"],
    n = [!1, !1, null, null, 0, 0, 0, 0, !1, !1, !1, !1, 0, null, 0, 0],
    o = window.Map && window.Map.prototype.forEach,
    p = o ? Map : b;
  b.prototype = {
    set: function (a, b) {
      return void 0 === b ? this["delete"](a) : (this.has(a) || this.size++, void(this.array[a] = b))
    },
    has: function (a) {
      return void 0 !== this.array[a]
    },
    "delete": function (a) {
      this.has(a) && (delete this.array[a], this.size--)
    },
    get: function (a) {
      return this.array[a]
    },
    clear: function () {
      this.array.length = 0, this.size = 0
    },
    forEach: function (a, b) {
      return this.array.forEach(function (c, d) {
        a.call(b, c, d, this)
      }, this)
    }
  };
  var q = ["bubbles", "cancelable", "view", "detail", "screenX", "screenY", "clientX", "clientY", "ctrlKey", "altKey", "shiftKey", "metaKey", "button", "relatedTarget", "buttons", "pointerId", "width", "height", "pressure", "tiltX", "tiltY", "pointerType", "hwTimestamp", "isPrimary", "type", "target", "currentTarget", "which", "pageX", "pageY", "timeStamp"],
    r = [!1, !1, null, null, 0, 0, 0, 0, !1, !1, !1, !1, 0, null, 0, 0, 0, 0, 0, 0, 0, "", 0, !1, "", null, null, 0, 0, 0, 0],
    s = {
      pointerover: 1,
      pointerout: 1,
      pointerenter: 1,
      pointerleave: 1
    },
    t = "undefined" != typeof SVGElementInstance,
    u = {
      pointermap: new p,
      eventMap: Object.create(null),
      captureInfo: Object.create(null),
      eventSources: Object.create(null),
      eventSourceList: [],
      registerSource: function (a, b) {
        var c = b,
          d = c.events;
        d && (d.forEach(function (a) {
          c[a] && (this.eventMap[a] = c[a].bind(c))
        }, this), this.eventSources[a] = c, this.eventSourceList.push(c))
      },
      register: function (a) {
        for (var b, c = this.eventSourceList.length, d = 0; d < c && (b = this.eventSourceList[d]); d++)
          b.register.call(b, a)
      },
      unregister: function (a) {
        for (var b, c = this.eventSourceList.length, d = 0; d < c && (b = this.eventSourceList[d]); d++)
          b.unregister.call(b, a)
      },
      contains: function (a, b) {
        try {
          return a.contains(b)
        } catch (c) {
          return !1
        }
      },
      down: function (a) {
        a.bubbles = !0, this.fireEvent("pointerdown", a)
      },
      move: function (a) {
        a.bubbles = !0, this.fireEvent("pointermove", a)
      },
      up: function (a) {
        a.bubbles = !0, this.fireEvent("pointerup", a)
      },
      enter: function (a) {
        a.bubbles = !1, this.fireEvent("pointerenter", a)
      },
      leave: function (a) {
        a.bubbles = !1, this.fireEvent("pointerleave", a)
      },
      over: function (a) {
        a.bubbles = !0, this.fireEvent("pointerover", a)
      },
      out: function (a) {
        a.bubbles = !0, this.fireEvent("pointerout", a)
      },
      cancel: function (a) {
        a.bubbles = !0, this.fireEvent("pointercancel", a)
      },
      leaveOut: function (a) {
        this.out(a), this.propagate(a, this.leave, !1)
      },
      enterOver: function (a) {
        this.over(a), this.propagate(a, this.enter, !0)
      },
      eventHandler: function (a) {
        if (!a._handledByPE) {
          var b = a.type,
            c = this.eventMap && this.eventMap[b];
          c && c(a), a._handledByPE = !0
        }
      },
      listen: function (a, b) {
        b.forEach(function (b) {
          this.addEvent(a, b)
        }, this)
      },
      unlisten: function (a, b) {
        b.forEach(function (b) {
          this.removeEvent(a, b)
        }, this)
      },
      addEvent: function (a, b) {
        a.addEventListener(b, this.boundHandler)
      },
      removeEvent: function (a, b) {
        a.removeEventListener(b, this.boundHandler)
      },
      makeEvent: function (b, c) {
        this.captureInfo[c.pointerId] && (c.relatedTarget = null);
        var d = new a(b, c);
        return c.preventDefault && (d.preventDefault = c.preventDefault), d._target = d._target || c.target, d
      },
      fireEvent: function (a, b) {
        var c = this.makeEvent(a, b);
        return this.dispatchEvent(c)
      },
      cloneEvent: function (a) {
        for (var b, c = Object.create(null), d = 0; d < q.length; d++) b = q[d], c[b] = a[b] || r[d], !t || "target" !== b && "relatedTarget" !== b || c[b] instanceof SVGElementInstance && (c[b] = c[b].correspondingUseElement);
        return a.preventDefault && (c.preventDefault = function () {
          a.preventDefault()
        }), c
      },
      getTarget: function (a) {
        var b = this.captureInfo[a.pointerId];
        return b ? a._target !== b && a.type in s ? void 0 : b : a._target
      },
      propagate: function (a, b, c) {
        for (var d = a.target, e = []; d !== document && !d.contains(a.relatedTarget);)
          if (e.push(d), d = d.parentNode, !d) return;
        c && e.reverse(), e.forEach(function (c) {
          a.target = c, b.call(this, a)
        }, this)
      },
      setCapture: function (b, c, d) {
        this.captureInfo[b] && this.releaseCapture(b, d), this.captureInfo[b] = c, this.implicitRelease = this.releaseCapture.bind(this, b, d), document.addEventListener("pointerup", this.implicitRelease), document.addEventListener("pointercancel", this.implicitRelease);
        var e = new a("gotpointercapture");
        e.pointerId = b, e._target = c, d || this.asyncDispatchEvent(e)
      },
      releaseCapture: function (b, c) {
        var d = this.captureInfo[b];
        if (d) {
          this.captureInfo[b] = void 0, document.removeEventListener("pointerup", this.implicitRelease), document.removeEventListener("pointercancel", this.implicitRelease);
          var e = new a("lostpointercapture");
          e.pointerId = b, e._target = d, c || this.asyncDispatchEvent(e)
        }
      },
      dispatchEvent: /*scope.external.dispatchEvent || */ function (a) {
        var b = this.getTarget(a);
        if (b) return b.dispatchEvent(a)
      },
      asyncDispatchEvent: function (a) {
        requestAnimationFrame(this.dispatchEvent.bind(this, a))
      }
    };
  u.boundHandler = u.eventHandler.bind(u);
  var v = {
      shadow: function (a) {
        if (a) return a.shadowRoot || a.webkitShadowRoot
      },
      canTarget: function (a) {
        return a && Boolean(a.elementFromPoint)
      },
      targetingShadow: function (a) {
        var b = this.shadow(a);
        if (this.canTarget(b)) return b
      },
      olderShadow: function (a) {
        var b = a.olderShadowRoot;
        if (!b) {
          var c = a.querySelector("shadow");
          c && (b = c.olderShadowRoot)
        }
        return b
      },
      allShadows: function (a) {
        for (var b = [], c = this.shadow(a); c;) b.push(c), c = this.olderShadow(c);
        return b
      },
      searchRoot: function (a, b, c) {
        if (a) {
          var d, e, f = a.elementFromPoint(b, c);
          for (e = this.targetingShadow(f); e;) {
            if (d = e.elementFromPoint(b, c)) {
              var g = this.targetingShadow(d);
              return this.searchRoot(g, b, c) || d
            }
            e = this.olderShadow(e)
          }
          return f
        }
      },
      owner: function (a) {
        for (var b = a; b.parentNode;) b = b.parentNode;
        return b.nodeType !== Node.DOCUMENT_NODE && b.nodeType !== Node.DOCUMENT_FRAGMENT_NODE && (b = document), b
      },
      findTarget: function (a) {
        var b = a.clientX,
          c = a.clientY,
          d = this.owner(a.target);
        return d.elementFromPoint(b, c) || (d = document), this.searchRoot(d, b, c)
      }
    },
    w = Array.prototype.forEach.call.bind(Array.prototype.forEach),
    x = Array.prototype.map.call.bind(Array.prototype.map),
    y = Array.prototype.slice.call.bind(Array.prototype.slice),
    z = Array.prototype.filter.call.bind(Array.prototype.filter),
    A = window.MutationObserver || window.WebKitMutationObserver,
    B = "[touch-action]",
    C = {
      subtree: !0,
      childList: !0,
      attributes: !0,
      attributeOldValue: !0,
      attributeFilter: ["touch-action"]
    };
  c.prototype = {
    watchSubtree: function (a) {
      //
      this.observer && v.canTarget(a) && this.observer.observe(a, C)
    },
    enableOnSubtree: function (a) {
      this.watchSubtree(a), a === document && "complete" !== document.readyState ? this.installOnLoad() : this.installNewSubtree(a)
    },
    installNewSubtree: function (a) {
      w(this.findElements(a), this.addElement, this)
    },
    findElements: function (a) {
      return a.querySelectorAll ? a.querySelectorAll(B) : []
    },
    removeElement: function (a) {
      this.removeCallback(a)
    },
    addElement: function (a) {
      this.addCallback(a)
    },
    elementChanged: function (a, b) {
      this.changedCallback(a, b)
    },
    concatLists: function (a, b) {
      return a.concat(y(b))
    },
    installOnLoad: function () {
      document.addEventListener("readystatechange", function () {
        "complete" === document.readyState && this.installNewSubtree(document)
      }.bind(this))
    },
    isElement: function (a) {
      return a.nodeType === Node.ELEMENT_NODE
    },
    flattenMutationTree: function (a) {
      var b = x(a, this.findElements, this);
      return b.push(z(a, this.isElement)), b.reduce(this.concatLists, [])
    },
    mutationWatcher: function (a) {
      a.forEach(this.mutationHandler, this)
    },
    mutationHandler: function (a) {
      if ("childList" === a.type) {
        var b = this.flattenMutationTree(a.addedNodes);
        b.forEach(this.addElement, this);
        var c = this.flattenMutationTree(a.removedNodes);
        c.forEach(this.removeElement, this)
      } else "attributes" === a.type && this.elementChanged(a.target, a.oldValue)
    }
  };
  var D = ["none", "auto", "pan-x", "pan-y", {
      rule: "pan-x pan-y",
      selectors: ["pan-x pan-y", "pan-y pan-x"]
    }],
    E = "",
    F = window.PointerEvent || window.MSPointerEvent,
    G = !window.ShadowDOMPolyfill && document.head.createShadowRoot,
    H = u.pointermap,
    I = 25,
    J = [1, 4, 2, 8, 16],
    K = !1;
  try {
    K = 1 === new MouseEvent("test", {
      buttons: 1
    }).buttons
  } catch (L) {}
  var M, N = {
      POINTER_ID: 1,
      POINTER_TYPE: "mouse",
      events: ["mousedown", "mousemove", "mouseup", "mouseover", "mouseout"],
      register: function (a) {
        u.listen(a, this.events)
      },
      unregister: function (a) {
        u.unlisten(a, this.events)
      },
      lastTouches: [],
      isEventSimulatedFromTouch: function (a) {
        for (var b, c = this.lastTouches, d = a.clientX, e = a.clientY, f = 0, g = c.length; f < g && (b = c[f]); f++) {
          var h = Math.abs(d - b.x),
            i = Math.abs(e - b.y);
          if (h <= I && i <= I) return !0
        }
      },
      prepareEvent: function (a) {
        var b = u.cloneEvent(a),
          c = b.preventDefault;
        return b.preventDefault = function () {
          a.preventDefault(), c()
        }, b.pointerId = this.POINTER_ID, b.isPrimary = !0, b.pointerType = this.POINTER_TYPE, b
      },
      prepareButtonsForMove: function (a, b) {
        var c = H.get(this.POINTER_ID);
        0 !== b.which && c ? a.buttons = c.buttons : a.buttons = 0, b.buttons = a.buttons
      },
      mousedown: function (a) {
        if (!this.isEventSimulatedFromTouch(a)) {
          var b = H.get(this.POINTER_ID),
            c = this.prepareEvent(a);
          K || (c.buttons = J[c.button], b && (c.buttons |= b.buttons), a.buttons = c.buttons), H.set(this.POINTER_ID, a), b && 0 !== b.buttons ? u.move(c) : u.down(c)
        }
      },
      mousemove: function (a) {
        if (!this.isEventSimulatedFromTouch(a)) {
          var b = this.prepareEvent(a);
          K || this.prepareButtonsForMove(b, a), b.button = -1, H.set(this.POINTER_ID, a), u.move(b)
        }
      },
      mouseup: function (a) {
        if (!this.isEventSimulatedFromTouch(a)) {
          var b = H.get(this.POINTER_ID),
            c = this.prepareEvent(a);
          if (!K) {
            var d = J[c.button];
            c.buttons = b ? b.buttons & ~d : 0, a.buttons = c.buttons
          }
          H.set(this.POINTER_ID, a),
            c.buttons &= ~J[c.button], 0 === c.buttons ? u.up(c) : u.move(c)
        }
      },
      mouseover: function (a) {
        if (!this.isEventSimulatedFromTouch(a)) {
          var b = this.prepareEvent(a);
          K || this.prepareButtonsForMove(b, a), b.button = -1, H.set(this.POINTER_ID, a), u.enterOver(b)
        }
      },
      mouseout: function (a) {
        if (!this.isEventSimulatedFromTouch(a)) {
          var b = this.prepareEvent(a);
          K || this.prepareButtonsForMove(b, a), b.button = -1, u.leaveOut(b)
        }
      },
      cancel: function (a) {
        var b = this.prepareEvent(a);
        u.cancel(b), this.deactivateMouse()
      },
      deactivateMouse: function () {
        H["delete"](this.POINTER_ID)
      }
    },
    O = u.captureInfo,
    P = v.findTarget.bind(v),
    Q = v.allShadows.bind(v),
    R = u.pointermap,
    S = 2500,
    T = 200,
    U = "touch-action",
    V = {
      events: ["touchstart", "touchmove", "touchend", "touchcancel"],
      register: function (a) {
        M.enableOnSubtree(a)
      },
      unregister: function () {},
      elementAdded: function (a) {
        var b = a.getAttribute(U),
          c = this.touchActionToScrollType(b);
        c && (a._scrollType = c, u.listen(a, this.events),
          Q(a).forEach(function (a) {
            a._scrollType = c, u.listen(a, this.events)
          }, this))
      },
      elementRemoved: function (a) {
        a._scrollType = void 0, u.unlisten(a, this.events),
          Q(a).forEach(function (a) {
            a._scrollType = void 0, u.unlisten(a, this.events)
          }, this)
      },
      elementChanged: function (a, b) {
        var c = a.getAttribute(U),
          d = this.touchActionToScrollType(c),
          e = this.touchActionToScrollType(b);
        d && e ? (a._scrollType = d, Q(a).forEach(function (a) {
          a._scrollType = d
        }, this)) : e ? this.elementRemoved(a) : d && this.elementAdded(a)
      },
      scrollTypes: {
        EMITTER: "none",
        XSCROLLER: "pan-x",
        YSCROLLER: "pan-y",
        SCROLLER: /^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/
      },
      touchActionToScrollType: function (a) {
        var b = a,
          c = this.scrollTypes;
        return "none" === b ? "none" : b === c.XSCROLLER ? "X" : b === c.YSCROLLER ? "Y" : c.SCROLLER.exec(b) ? "XY" : void 0
      },
      POINTER_TYPE: "touch",
      firstTouch: null,
      isPrimaryTouch: function (a) {
        return this.firstTouch === a.identifier
      },
      setPrimaryTouch: function (a) {
        (0 === R.size || 1 === R.size && R.has(1)) && (this.firstTouch = a.identifier, this.firstXY = {
          X: a.clientX,
          Y: a.clientY
        }, this.scrolling = !1, this.cancelResetClickCount())
      },
      removePrimaryPointer: function (a) {
        a.isPrimary && (this.firstTouch = null, this.firstXY = null, this.resetClickCount())
      },
      clickCount: 0,
      resetId: null,
      resetClickCount: function () {
        var a = function () {
          this.clickCount = 0, this.resetId = null
        }.bind(this);
        this.resetId = setTimeout(a, T)
      },
      cancelResetClickCount: function () {
        this.resetId && clearTimeout(this.resetId)
      },
      typeToButtons: function (a) {
        var b = 0;
        return "touchstart" !== a && "touchmove" !== a || (b = 1), b
      },
      touchToPointer: function (a) {
        var b = this.currentTouchEvent,
          c = u.cloneEvent(a),
          d = c.pointerId = a.identifier + 2;
        c.target = O[d] || P(c), c.bubbles = !0, c.cancelable = !0, c.detail = this.clickCount, c.button = 0, c.buttons = this.typeToButtons(b.type), c.width = 2 * (a.radiusX || a.webkitRadiusX || 0), c.height = 2 * (a.radiusY || a.webkitRadiusY || 0), c.pressure = a.force || a.webkitForce || .5, c.isPrimary = this.isPrimaryTouch(a), c.pointerType = this.POINTER_TYPE,
          c.altKey = b.altKey, c.ctrlKey = b.ctrlKey, c.metaKey = b.metaKey, c.shiftKey = b.shiftKey;
        var e = this;
        return c.preventDefault = function () {
          e.scrolling = !1, e.firstXY = null, b.preventDefault()
        }, c
      },
      processTouches: function (a, b) {
        var c = a.changedTouches;
        this.currentTouchEvent = a;
        for (var d, e = 0; e < c.length; e++) d = c[e], b.call(this, this.touchToPointer(d))
      },
      shouldScroll: function (a) {
        if (this.firstXY) {
          var b, c = a.currentTarget._scrollType;
          if ("none" === c)
            b = !1;
          else if ("XY" === c)
            b = !0;
          else {
            var d = a.changedTouches[0],
              e = c,
              f = "Y" === c ? "X" : "Y",
              g = Math.abs(d["client" + e] - this.firstXY[e]),
              h = Math.abs(d["client" + f] - this.firstXY[f]);
            b = g >= h
          }
          return this.firstXY = null, b
        }
      },
      findTouch: function (a, b) {
        for (var c, d = 0, e = a.length; d < e && (c = a[d]); d++)
          if (c.identifier === b) return !0
      },
      vacuumTouches: function (a) {
        var b = a.touches;
        if (R.size >= b.length) {
          var c = [];
          R.forEach(function (a, d) {
            if (1 !== d && !this.findTouch(b, d - 2)) {
              var e = a.out;
              c.push(e)
            }
          }, this), c.forEach(this.cancelOut, this)
        }
      },
      touchstart: function (a) {
        this.vacuumTouches(a), this.setPrimaryTouch(a.changedTouches[0]), this.dedupSynthMouse(a), this.scrolling || (this.clickCount++, this.processTouches(a, this.overDown))
      },
      overDown: function (a) {
        R.set(a.pointerId, {
          target: a.target,
          out: a,
          outTarget: a.target
        }), u.enterOver(a), u.down(a)
      },
      touchmove: function (a) {
        this.scrolling || (this.shouldScroll(a) ? (this.scrolling = !0, this.touchcancel(a)) : (a.preventDefault(), this.processTouches(a, this.moveOverOut)))
      },
      moveOverOut: function (a) {
        var b = a,
          c = R.get(b.pointerId);
        if (c) {
          var d = c.out,
            e = c.outTarget;
          u.move(b), d && e !== b.target && (d.relatedTarget = b.target, b.relatedTarget = e,
            d.target = e, b.target ? (u.leaveOut(d), u.enterOver(b)) : (
              b.target = e, b.relatedTarget = null, this.cancelOut(b))), c.out = b, c.outTarget = b.target
        }
      },
      touchend: function (a) {
        this.dedupSynthMouse(a), this.processTouches(a, this.upOut)
      },
      upOut: function (a) {
        this.scrolling || (u.up(a), u.leaveOut(a)), this.cleanUpPointer(a)
      },
      touchcancel: function (a) {
        this.processTouches(a, this.cancelOut)
      },
      cancelOut: function (a) {
        u.cancel(a), u.leaveOut(a), this.cleanUpPointer(a)
      },
      cleanUpPointer: function (a) {
        R["delete"](a.pointerId), this.removePrimaryPointer(a)
      },
      dedupSynthMouse: function (a) {
        var b = N.lastTouches,
          c = a.changedTouches[0];
        if (this.isPrimaryTouch(c)) {
          var d = {
            x: c.clientX,
            y: c.clientY
          };
          b.push(d);
          var e = function (a, b) {
            var c = a.indexOf(b);
            c > -1 && a.splice(c, 1)
          }.bind(null, b, d);
          setTimeout(e, S)
        }
      }
    };
  M = new c(V.elementAdded, V.elementRemoved, V.elementChanged, V);
  var W, X, Y, Z = u.pointermap,
    $ = window.MSPointerEvent && "number" == typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,
    _ = {
      events: ["MSPointerDown", "MSPointerMove", "MSPointerUp", "MSPointerOut", "MSPointerOver", "MSPointerCancel", "MSGotPointerCapture", "MSLostPointerCapture"],
      register: function (a) {
        u.listen(a, this.events)
      },
      unregister: function (a) {
        u.unlisten(a, this.events)
      },
      POINTER_TYPES: ["", "unavailable", "touch", "pen", "mouse"],
      prepareEvent: function (a) {
        var b = a;
        return $ && (b = u.cloneEvent(a), b.pointerType = this.POINTER_TYPES[a.pointerType]), b
      },
      cleanup: function (a) {
        Z["delete"](a)
      },
      MSPointerDown: function (a) {
        Z.set(a.pointerId, a);
        var b = this.prepareEvent(a);
        u.down(b)
      },
      MSPointerMove: function (a) {
        var b = this.prepareEvent(a);
        u.move(b)
      },
      MSPointerUp: function (a) {
        var b = this.prepareEvent(a);
        u.up(b), this.cleanup(a.pointerId)
      },
      MSPointerOut: function (a) {
        var b = this.prepareEvent(a);
        u.leaveOut(b)
      },
      MSPointerOver: function (a) {
        var b = this.prepareEvent(a);
        u.enterOver(b)
      },
      MSPointerCancel: function (a) {
        var b = this.prepareEvent(a);
        u.cancel(b), this.cleanup(a.pointerId)
      },
      MSLostPointerCapture: function (a) {
        var b = u.makeEvent("lostpointercapture", a);
        u.dispatchEvent(b)
      },
      MSGotPointerCapture: function (a) {
        var b = u.makeEvent("gotpointercapture", a);
        u.dispatchEvent(b)
      }
    },
    aa = window.navigator;
  aa.msPointerEnabled ? (W = function (a) {
    i(a), j(this), k(a) && (u.setCapture(a, this, !0), this.msSetPointerCapture(a))
  }, X = function (a) {
    i(a), u.releaseCapture(a, !0), this.msReleasePointerCapture(a)
  }) : (W = function (a) {
    i(a), j(this), k(a) && u.setCapture(a, this)
  }, X = function (a) {
    i(a), u.releaseCapture(a)
  }), Y = function (a) {
    return !!u.captureInfo[a]
  }, g(), h(), l();
  var ba = {
    dispatcher: u,
    Installer: c,
    PointerEvent: a,
    PointerMap: p,
    targetFinding: v
  };
  return ba
});
///////////////////////////////////////////////

///////////////////////////////////////////////
var config = {"show_fabrication":false,"redraw_on_drag":true,"highlight_pin1":false,"extra_fields":["BOM_Manufacturer","BOM_Manufacturer Part","BOM_Supplier","BOM_Supplier Part"],"dark_mode":false,"bom_view":"left-right","board_rotation":0,"checkboxes":"Sourced,Placed","show_silkscreen":true,"show_pads":true,"layer_view":"FB"};
///////////////////////////////////////////////

///////////////////////////////////////////////
var pcbdata = {"ibom_version":"v2.3-50-g53ae\n","edges_bbox":{"minx":4084.7,"miny":3058.9,"maxx":4500.2,"maxy":3376.9},"edges":[{"type":"polyline","net":"S$10032","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4265.9518,3216.7161 4314.0719,3216.866"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4265.9518,3216.7161 4234.3019,3216.616"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4346.4718,3216.9661 4314.0719,3216.866"},{"type":"polyline","net":"S$10005","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4346.4718,3216.9661 4362.1818,3216.9661"},{"type":"polyline","net":"S$10001","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4218.4118,3216.5659 4234.3019,3216.5659"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4372.942,3217.0459 4362.1818,3217.0161"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4218.4118,3216.5659 4213.8322,3216.5559"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4192.8014,3210.885 4180.7008,3203.8984 4179.4113,3203.0583 4178.2614,3202.1179 4177.2194,3201.0593 4176.297,3199.8945 4175.506,3198.6372 4174.8546,3197.302 4174.3507,3195.9043 4174.0006,3194.4607 4173.8009,3192.9348 4171.8234,3166.8142 4171.8185,3133.4751 4171.881,3131.8047 4171.9391,3131.1921 4172.1623,3129.5803 4172.4616,3128.1885"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4381.7189,3212.8223 4380.7858,3213.8574"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4199.4972,3082.0891 4378.9772,3196.4702"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4172.4616,3128.1885 4182.6974,3088.6997"},{"type":"arc","width":1,"svgpath":"M 4213.8332 3216.5549 A 42.3228 42.3228 0 0 1 4192.8014 3210.8849","net":""},{"type":"arc","width":1,"svgpath":"M 4380.7858 3213.8575 A 11.1604 11.1604 0 0 1 4372.9452 3217.0421","net":""},{"type":"arc","width":1,"svgpath":"M 4378.9773 3196.4701 A 11.1604 11.1604 0 0 1 4381.7191 3212.8222","net":""},{"type":"arc","width":1,"svgpath":"M 4182.6974 3088.6997 A 11.1594 11.1594 0 0 1 4199.4973 3082.089","net":""},{"type":"circle","start":[4193.5,3091.5],"radius":6.8898,"width":0.5},{"type":"circle","start":[4372.979,3205.882],"radius":6.8898,"width":0.5}],"drawings":{"silkscreen":{"F":[{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4178.178,3184.438 4209.674,3184.438 4209.674,3202.155 4178.178,3202.155 4178.178,3184.438"},{"type":"circle","_svgpath":"M 4206.863, 3199.462 m -1.414, 0 a 1.414,1.414 0 1,0 2.828,0 a 1.414,1.414 0 1,0 -2.828,0","start":[4206.863,3199.462],"radius":1.414,"width":"1","net":""},{"type":"text","svgpath":"M 4196.496 3171.9422 L 4196.286 3171.5322 L 4195.876 3171.1222 L 4195.476 3170.9222 L 4194.656 3170.9222 L 4194.246 3171.1222 L 4193.836 3171.5322 L 4193.626 3171.9422 L 4193.426 3172.5622 L 4193.426 3173.5822 L 4193.626 3174.1922 L 4193.836 3174.6022 L 4194.246 3175.0122 L 4194.656 3175.2122 L 4195.476 3175.2122 L 4195.876 3175.0122 L 4196.286 3174.6022 L 4196.496 3174.1922 M 4199.076 3170.9222 L 4198.666 3171.1222 L 4198.256 3171.5322 L 4198.046 3171.9422 L 4197.846 3172.5622 L 4197.846 3173.5822 L 4198.046 3174.1922 L 4198.256 3174.6022 L 4198.666 3175.0122 L 4199.076 3175.2122 L 4199.886 3175.2122 L 4200.296 3175.0122 L 4200.706 3174.6022 L 4200.916 3174.1922 L 4201.116 3173.5822 L 4201.116 3172.5622 L 4200.916 3171.9422 L 4200.706 3171.5322 L 4200.296 3171.1222 L 4199.886 3170.9222 L 4199.076 3170.9222 M 4202.466 3170.9222 L 4202.466 3175.2122 M 4202.466 3170.9222 L 4205.326 3175.2122 M 4205.326 3170.9222 L 4205.326 3175.2122 M 4206.676 3170.9222 L 4206.676 3175.2122 M 4206.676 3170.9222 L 4209.546 3175.2122 M 4209.546 3170.9222 L 4209.546 3175.2122 M 4210.896 3173.3722 L 4214.576 3173.3722 M 4217.356 3170.9222 L 4217.356 3175.2122 M 4215.926 3170.9222 L 4218.786 3170.9222 M 4220.136 3170.9222 L 4220.136 3175.2122 M 4223.006 3170.9222 L 4223.006 3175.2122 M 4220.136 3172.9622 L 4223.006 3172.9622 M 4224.356 3176.6522 L 4228.036 3176.6522 M 4229.386 3170.9222 L 4229.386 3175.2122 M 4229.386 3170.9222 L 4231.226 3170.9222 L 4231.836 3171.1222 L 4232.046 3171.3322 L 4232.246 3171.7422 L 4232.246 3172.1522 L 4232.046 3172.5622 L 4231.836 3172.7622 L 4231.226 3172.9622 M 4229.386 3172.9622 L 4231.226 3172.9622 L 4231.836 3173.1722 L 4232.046 3173.3722 L 4232.246 3173.7822 L 4232.246 3174.4022 L 4232.046 3174.8122 L 4231.836 3175.0122 L 4231.226 3175.2122 L 4229.386 3175.2122 M 4234.006 3170.9222 L 4236.256 3170.9222 L 4235.026 3172.5622 L 4235.646 3172.5622 L 4236.056 3172.7622 L 4236.256 3172.9622 L 4236.466 3173.5822 L 4236.466 3173.9922 L 4236.256 3174.6022 L 4235.846 3175.0122 L 4235.236 3175.2122 L 4234.626 3175.2122 L 4234.006 3175.0122 L 4233.806 3174.8122 L 4233.596 3174.4022 M 4237.816 3170.9222 L 4237.816 3175.2122 M 4237.816 3170.9222 L 4239.656 3170.9222 L 4240.266 3171.1222 L 4240.476 3171.3322 L 4240.676 3171.7422 L 4240.676 3172.1522 L 4240.476 3172.5622 L 4240.266 3172.7622 L 4239.656 3172.9622 M 4237.816 3172.9622 L 4239.656 3172.9622 L 4240.266 3173.1722 L 4240.476 3173.3722 L 4240.676 3173.7822 L 4240.676 3174.4022 L 4240.476 3174.8122 L 4240.266 3175.0122 L 4239.656 3175.2122 L 4237.816 3175.2122 M 4242.026 3173.3722 L 4245.706 3173.3722 M 4247.056 3170.9222 L 4247.056 3175.2122 M 4247.056 3170.9222 L 4248.896 3170.9222 L 4249.516 3171.1222 L 4249.716 3171.3322 L 4249.926 3171.7422 L 4249.926 3172.3522 L 4249.716 3172.7622 L 4249.516 3172.9622 L 4248.896 3173.1722 L 4247.056 3173.1722 M 4251.276 3170.9222 L 4251.276 3175.2122 M 4254.136 3170.9222 L 4254.136 3175.2122 M 4251.276 3172.9622 L 4254.136 3172.9622 M 4255.486 3173.3722 L 4259.166 3173.3722 M 4260.516 3170.9222 L 4260.516 3175.2122 M 4263.376 3170.9222 L 4260.516 3173.7822 M 4261.536 3172.7622 L 4263.376 3175.2122 M 4264.726 3173.3722 L 4268.416 3173.3722 M 4272.626 3171.5322 L 4272.216 3171.1222 L 4271.606 3170.9222 L 4270.786 3170.9222 L 4270.176 3171.1222 L 4269.766 3171.5322 L 4269.766 3171.9422 L 4269.966 3172.3522 L 4270.176 3172.5622 L 4270.576 3172.7622 L 4271.806 3173.1722 L 4272.216 3173.3722 L 4272.426 3173.5822 L 4272.626 3173.9922 L 4272.626 3174.6022 L 4272.216 3175.0122 L 4271.606 3175.2122 L 4270.786 3175.2122 L 4270.176 3175.0122 L 4269.766 3174.6022","useTrueTypeFontRendering":false,"thickness":0.6,"width":0.6,"net":"","val":1},{"type":"text","svgpath":"M 4211.258 3198.962L4215.558 3198.962 M 4215.558 3198.962L4215.558 3196.512 M 4211.258 3195.162L4215.558 3195.162 M 4211.258 3195.162L4211.258 3192.502 M 4213.308 3195.162L4213.308 3193.522 M 4215.558 3195.162L4215.558 3192.502 M 4211.258 3191.152L4215.558 3191.152 M 4211.258 3191.152L4211.258 3189.712 L4211.468 3189.102 L4211.868 3188.692 L4212.278 3188.492 L4212.898 3188.282 L4213.918 3188.282 L4214.528 3188.492 L4214.938 3188.692 L4215.348 3189.102 L4215.558 3189.712 L4215.558 3191.152 ","useTrueTypeFontRendering":false,"thickness":0.6,"width":0.6,"net":"","ref":1},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4201.9,3180.43 4178.278,3180.43 4178.278,3162.713 4201.9,3162.713 4201.9,3180.43"},{"type":"circle","_svgpath":"M 4181.089, 3165.406 m -1.414, 0 a 1.414,1.414 0 1,0 2.828,0 a 1.414,1.414 0 1,0 -2.828,0","start":[4181.089,3165.406],"radius":1.414,"width":"1","net":""},{"type":"text","svgpath":"M 4187.456 3192.926 L 4187.666 3193.336 L 4188.076 3193.746 L 4188.476 3193.946 L 4189.296 3193.946 L 4189.706 3193.746 L 4190.116 3193.336 L 4190.326 3192.926 L 4190.526 3192.306 L 4190.526 3191.286 L 4190.326 3190.676 L 4190.116 3190.266 L 4189.706 3189.856 L 4189.296 3189.656 L 4188.476 3189.656 L 4188.076 3189.856 L 4187.666 3190.266 L 4187.456 3190.676 M 4184.876 3193.946 L 4185.286 3193.746 L 4185.696 3193.336 L 4185.906 3192.926 L 4186.106 3192.306 L 4186.106 3191.286 L 4185.906 3190.676 L 4185.696 3190.266 L 4185.286 3189.856 L 4184.876 3189.656 L 4184.066 3189.656 L 4183.656 3189.856 L 4183.246 3190.266 L 4183.036 3190.676 L 4182.836 3191.286 L 4182.836 3192.306 L 4183.036 3192.926 L 4183.246 3193.336 L 4183.656 3193.746 L 4184.066 3193.946 L 4184.876 3193.946 M 4181.486 3193.946 L 4181.486 3189.656 M 4181.486 3193.946 L 4178.626 3189.656 M 4178.626 3193.946 L 4178.626 3189.656 M 4177.276 3193.946 L 4177.276 3189.656 M 4177.276 3193.946 L 4174.406 3189.656 M 4174.406 3193.946 L 4174.406 3189.656 M 4173.056 3191.496 L 4169.376 3191.496 M 4166.596 3193.946 L 4166.596 3189.656 M 4168.026 3193.946 L 4165.166 3193.946 M 4163.816 3193.946 L 4163.816 3189.656 M 4160.946 3193.946 L 4160.946 3189.656 M 4163.816 3191.906 L 4160.946 3191.906 M 4159.596 3188.216 L 4155.916 3188.216 M 4154.566 3193.946 L 4154.566 3189.656 M 4154.566 3193.946 L 4152.726 3193.946 L 4152.116 3193.746 L 4151.906 3193.536 L 4151.706 3193.126 L 4151.706 3192.716 L 4151.906 3192.306 L 4152.116 3192.106 L 4152.726 3191.906 M 4154.566 3191.906 L 4152.726 3191.906 L 4152.116 3191.696 L 4151.906 3191.496 L 4151.706 3191.086 L 4151.706 3190.466 L 4151.906 3190.056 L 4152.116 3189.856 L 4152.726 3189.656 L 4154.566 3189.656 M 4150.146 3192.926 L 4150.146 3193.126 L 4149.946 3193.536 L 4149.736 3193.746 L 4149.326 3193.946 L 4148.516 3193.946 L 4148.106 3193.746 L 4147.896 3193.536 L 4147.696 3193.126 L 4147.696 3192.716 L 4147.896 3192.306 L 4148.306 3191.696 L 4150.356 3189.656 L 4147.486 3189.656 M 4146.136 3193.946 L 4146.136 3189.656 M 4146.136 3193.946 L 4144.296 3193.946 L 4143.686 3193.746 L 4143.476 3193.536 L 4143.276 3193.126 L 4143.276 3192.716 L 4143.476 3192.306 L 4143.686 3192.106 L 4144.296 3191.906 M 4146.136 3191.906 L 4144.296 3191.906 L 4143.686 3191.696 L 4143.476 3191.496 L 4143.276 3191.086 L 4143.276 3190.466 L 4143.476 3190.056 L 4143.686 3189.856 L 4144.296 3189.656 L 4146.136 3189.656 M 4141.926 3191.496 L 4138.246 3191.496 M 4136.896 3193.946 L 4136.896 3189.656 M 4136.896 3193.946 L 4135.056 3193.946 L 4134.436 3193.746 L 4134.236 3193.536 L 4134.026 3193.126 L 4134.026 3192.516 L 4134.236 3192.106 L 4134.436 3191.906 L 4135.056 3191.696 L 4136.896 3191.696 M 4132.676 3193.946 L 4132.676 3189.656 M 4129.816 3193.946 L 4129.816 3189.656 M 4132.676 3191.906 L 4129.816 3191.906 M 4128.466 3191.496 L 4124.786 3191.496 M 4123.436 3193.946 L 4123.436 3189.656 M 4120.576 3193.946 L 4123.436 3191.086 M 4122.416 3192.106 L 4120.576 3189.656 M 4119.226 3191.496 L 4115.536 3191.496 M 4111.326 3193.336 L 4111.736 3193.746 L 4112.346 3193.946 L 4113.166 3193.946 L 4113.776 3193.746 L 4114.186 3193.336 L 4114.186 3192.926 L 4113.986 3192.516 L 4113.776 3192.306 L 4113.376 3192.106 L 4112.146 3191.696 L 4111.736 3191.496 L 4111.526 3191.286 L 4111.326 3190.876 L 4111.326 3190.266 L 4111.736 3189.856 L 4112.346 3189.656 L 4113.166 3189.656 L 4113.776 3189.856 L 4114.186 3190.266","useTrueTypeFontRendering":false,"thickness":0.6,"width":0.6,"net":"","val":1},{"type":"text","svgpath":"M 4207.499 3164.903L4203.209 3164.903 M 4207.499 3167.773L4203.209 3167.773 M 4205.459 3164.903L4205.459 3167.773 M 4207.499 3169.123L4203.209 3169.123 M 4207.499 3169.123L4207.499 3171.783 M 4205.459 3169.123L4205.459 3170.753 M 4203.209 3169.123L4203.209 3171.783 M 4207.499 3173.133L4203.209 3173.133 M 4207.499 3173.133L4207.499 3175.783 M 4205.459 3173.133L4205.459 3174.763 ","useTrueTypeFontRendering":false,"thickness":0.6,"width":0.6,"net":"","ref":1},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4205.54,3120.284 4181.918,3120.284 4181.918,3102.567 4205.54,3102.567 4205.54,3120.284"},{"type":"circle","_svgpath":"M 4184.729, 3105.26 m -1.414, 0 a 1.414,1.414 0 1,0 2.828,0 a 1.414,1.414 0 1,0 -2.828,0","start":[4184.729,3105.26],"radius":1.414,"width":"1","net":""},{"type":"text","svgpath":"M 4191.096 3132.78 L 4191.306 3133.19 L 4191.716 3133.6 L 4192.116 3133.8 L 4192.936 3133.8 L 4193.346 3133.6 L 4193.756 3133.19 L 4193.966 3132.78 L 4194.166 3132.16 L 4194.166 3131.14 L 4193.966 3130.53 L 4193.756 3130.12 L 4193.346 3129.71 L 4192.936 3129.51 L 4192.116 3129.51 L 4191.716 3129.71 L 4191.306 3130.12 L 4191.096 3130.53 M 4188.516 3133.8 L 4188.926 3133.6 L 4189.336 3133.19 L 4189.546 3132.78 L 4189.746 3132.16 L 4189.746 3131.14 L 4189.546 3130.53 L 4189.336 3130.12 L 4188.926 3129.71 L 4188.516 3129.51 L 4187.706 3129.51 L 4187.296 3129.71 L 4186.886 3130.12 L 4186.676 3130.53 L 4186.476 3131.14 L 4186.476 3132.16 L 4186.676 3132.78 L 4186.886 3133.19 L 4187.296 3133.6 L 4187.706 3133.8 L 4188.516 3133.8 M 4185.126 3133.8 L 4185.126 3129.51 M 4185.126 3133.8 L 4182.266 3129.51 M 4182.266 3133.8 L 4182.266 3129.51 M 4180.916 3133.8 L 4180.916 3129.51 M 4180.916 3133.8 L 4178.046 3129.51 M 4178.046 3133.8 L 4178.046 3129.51 M 4176.696 3131.35 L 4173.016 3131.35 M 4170.236 3133.8 L 4170.236 3129.51 M 4171.666 3133.8 L 4168.806 3133.8 M 4167.456 3133.8 L 4167.456 3129.51 M 4164.586 3133.8 L 4164.586 3129.51 M 4167.456 3131.76 L 4164.586 3131.76 M 4163.236 3128.07 L 4159.556 3128.07 M 4158.206 3133.8 L 4158.206 3129.51 M 4158.206 3133.8 L 4156.366 3133.8 L 4155.756 3133.6 L 4155.546 3133.39 L 4155.346 3132.98 L 4155.346 3132.57 L 4155.546 3132.16 L 4155.756 3131.96 L 4156.366 3131.76 M 4158.206 3131.76 L 4156.366 3131.76 L 4155.756 3131.55 L 4155.546 3131.35 L 4155.346 3130.94 L 4155.346 3130.32 L 4155.546 3129.91 L 4155.756 3129.71 L 4156.366 3129.51 L 4158.206 3129.51 M 4153.786 3132.78 L 4153.786 3132.98 L 4153.586 3133.39 L 4153.376 3133.6 L 4152.966 3133.8 L 4152.156 3133.8 L 4151.746 3133.6 L 4151.536 3133.39 L 4151.336 3132.98 L 4151.336 3132.57 L 4151.536 3132.16 L 4151.946 3131.55 L 4153.996 3129.51 L 4151.126 3129.51 M 4149.776 3133.8 L 4149.776 3129.51 M 4149.776 3133.8 L 4147.936 3133.8 L 4147.326 3133.6 L 4147.116 3133.39 L 4146.916 3132.98 L 4146.916 3132.57 L 4147.116 3132.16 L 4147.326 3131.96 L 4147.936 3131.76 M 4149.776 3131.76 L 4147.936 3131.76 L 4147.326 3131.55 L 4147.116 3131.35 L 4146.916 3130.94 L 4146.916 3130.32 L 4147.116 3129.91 L 4147.326 3129.71 L 4147.936 3129.51 L 4149.776 3129.51 M 4145.566 3131.35 L 4141.886 3131.35 M 4140.536 3133.8 L 4140.536 3129.51 M 4140.536 3133.8 L 4138.696 3133.8 L 4138.076 3133.6 L 4137.876 3133.39 L 4137.666 3132.98 L 4137.666 3132.37 L 4137.876 3131.96 L 4138.076 3131.76 L 4138.696 3131.55 L 4140.536 3131.55 M 4136.316 3133.8 L 4136.316 3129.51 M 4133.456 3133.8 L 4133.456 3129.51 M 4136.316 3131.76 L 4133.456 3131.76 M 4132.106 3131.35 L 4128.426 3131.35 M 4127.076 3133.8 L 4127.076 3129.51 M 4124.216 3133.8 L 4127.076 3130.94 M 4126.056 3131.96 L 4124.216 3129.51 M 4122.866 3131.35 L 4119.176 3131.35 M 4114.966 3133.19 L 4115.376 3133.6 L 4115.986 3133.8 L 4116.806 3133.8 L 4117.416 3133.6 L 4117.826 3133.19 L 4117.826 3132.78 L 4117.626 3132.37 L 4117.416 3132.16 L 4117.016 3131.96 L 4115.786 3131.55 L 4115.376 3131.35 L 4115.166 3131.14 L 4114.966 3130.73 L 4114.966 3130.12 L 4115.376 3129.71 L 4115.986 3129.51 L 4116.806 3129.51 L 4117.416 3129.71 L 4117.826 3130.12","useTrueTypeFontRendering":false,"thickness":0.6,"width":0.6,"net":"","val":1},{"type":"text","svgpath":"M 4211.143 3104.757L4206.853 3104.757 M 4211.143 3104.757L4211.143 3106.597 L4210.943 3107.217 L4210.733 3107.417 L4210.323 3107.627 L4209.713 3107.627 L4209.303 3107.417 L4209.103 3107.217 L4208.893 3106.597 L4208.893 3104.757 M 4210.123 3112.037L4210.533 3111.837 L4210.943 3111.427 L4211.143 3111.017 L4211.143 3110.197 L4210.943 3109.787 L4210.533 3109.387 L4210.123 3109.177 L4209.503 3108.977 L4208.483 3108.977 L4207.873 3109.177 L4207.463 3109.387 L4207.053 3109.787 L4206.853 3110.197 L4206.853 3111.017 L4207.053 3111.427 L4207.463 3111.837 L4207.873 3112.037 M 4211.143 3113.387L4206.853 3113.387 M 4211.143 3113.387L4211.143 3116.047 M 4209.103 3113.387L4209.103 3115.027 ","useTrueTypeFontRendering":false,"thickness":0.6,"width":0.6,"net":"","ref":1},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4191.588,3125.9035 4211.588,3125.9035"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4191.588,3157.7145 4191.588,3125.9035"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4211.588,3157.7145 4211.588,3125.9035"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4201.5602,3157.7145 4201.5602,3146.809 4211.588,3146.809"},{"type":"polyline","net":"","start":[0,0],"end":[0,0],"width":1,"svgpath":"M4191.588,3157.7145 4211.588,3157.7145"},{"type":"text","svgpath":"M 4178.048 3142.809 L 4182.338 3142.809 M 4178.048 3139.949 L 4182.338 3139.949 M 4180.088 3142.809 L 4180.088 3139.949 M 4178.048 3138.599 L 4182.338 3138.599 M 4178.048 3138.599 L 4178.048 3137.159 L 4178.248 3136.549 L 4178.658 3136.139 L 4179.068 3135.939 L 4179.688 3135.729 L 4180.708 3135.729 L 4181.318 3135.939 L 4181.728 3136.139 L 4182.138 3136.549 L 4182.338 3137.159 L 4182.338 3138.599 M 4178.048 3134.379 L 4182.338 3134.379 M 4178.048 3134.379 L 4178.048 3132.539 L 4178.248 3131.929 L 4178.458 3131.719 L 4178.868 3131.519 L 4179.278 3131.519 L 4179.688 3131.719 L 4179.888 3131.929 L 4180.088 3132.539 L 4180.088 3134.379 M 4180.088 3132.949 L 4182.338 3131.519 M 4180.498 3130.169 L 4180.498 3126.489 M 4178.048 3123.709 L 4182.338 3123.709 M 4178.048 3125.139 L 4178.048 3122.269 M 4178.048 3120.919 L 4182.338 3120.919 M 4178.048 3118.059 L 4182.338 3118.059 M 4180.088 3120.919 L 4180.088 3118.059 M 4183.778 3116.709 L 4183.778 3113.029 M 4178.658 3109.219 L 4178.248 3109.429 L 4178.048 3110.039 L 4178.048 3110.449 L 4178.248 3111.059 L 4178.868 3111.469 L 4179.888 3111.679 L 4180.908 3111.679 L 4181.728 3111.469 L 4182.138 3111.059 L 4182.338 3110.449 L 4182.338 3110.249 L 4182.138 3109.629 L 4181.728 3109.219 L 4181.118 3109.019 L 4180.908 3109.019 L 4180.298 3109.219 L 4179.888 3109.629 L 4179.688 3110.249 L 4179.688 3110.449 L 4179.888 3111.059 L 4180.298 3111.469 L 4180.908 3111.679 M 4178.048 3107.669 L 4182.338 3107.669 M 4178.048 3107.669 L 4178.048 3105.829 L 4178.248 3105.209 L 4178.458 3105.009 L 4178.868 3104.809 L 4179.478 3104.809 L 4179.888 3105.009 L 4180.088 3105.209 L 4180.298 3105.829 L 4180.298 3107.669 M 4180.498 3103.459 L 4180.498 3099.769 M 4178.048 3098.419 L 4182.338 3098.419 M 4178.048 3098.419 L 4178.048 3096.579 L 4178.248 3095.969 L 4178.458 3095.759 L 4178.868 3095.559 L 4179.478 3095.559 L 4179.888 3095.759 L 4180.088 3095.969 L 4180.298 3096.579 L 4180.298 3098.419 M 4179.068 3094.009 L 4178.868 3094.009 L 4178.458 3093.799 L 4178.248 3093.599 L 4178.048 3093.189 L 4178.048 3092.369 L 4178.248 3091.959 L 4178.458 3091.759 L 4178.868 3091.549 L 4179.278 3091.549 L 4179.688 3091.759 L 4180.298 3092.159 L 4182.338 3094.209 L 4182.338 3091.349 M 4181.318 3089.789 L 4181.528 3089.999 L 4181.728 3089.789 L 4181.528 3089.589 L 4181.318 3089.789 M 4178.048 3085.779 L 4178.048 3087.829 L 4179.888 3088.029 L 4179.688 3087.829 L 4179.478 3087.209 L 4179.478 3086.599 L 4179.688 3085.989 L 4180.088 3085.579 L 4180.708 3085.369 L 4181.118 3085.369 L 4181.728 3085.579 L 4182.138 3085.989 L 4182.338 3086.599 L 4182.338 3087.209 L 4182.138 3087.829 L 4181.938 3088.029 L 4181.528 3088.239 M 4178.048 3081.979 L 4180.908 3084.019 L 4180.908 3080.959 M 4178.048 3081.979 L 4182.338 3081.979 M 4180.498 3079.609 L 4180.498 3075.919 M 4178.048 3074.569 L 4182.338 3072.939 M 4178.048 3071.299 L 4182.338 3072.939 M 4180.498 3069.949 L 4180.498 3066.269 M 4178.048 3064.919 L 4182.338 3064.919 M 4178.048 3064.919 L 4178.048 3062.259 M 4180.088 3064.919 L 4180.088 3063.279 M 4180.498 3060.909 L 4180.498 3057.229 M 4178.048 3055.879 L 4182.338 3055.879 M 4178.048 3055.879 L 4178.048 3054.039 L 4178.248 3053.419 L 4178.458 3053.219 L 4178.868 3053.009 L 4179.278 3053.009 L 4179.688 3053.219 L 4179.888 3053.419 L 4180.088 3054.039 L 4180.088 3055.879 M 4180.088 3054.449 L 4182.338 3053.009 M 4179.068 3051.459 L 4178.868 3051.459 L 4178.458 3051.259 L 4178.248 3051.049 L 4178.048 3050.639 L 4178.048 3049.819 L 4178.248 3049.409 L 4178.458 3049.209 L 4178.868 3049.009 L 4179.278 3049.009 L 4179.688 3049.209 L 4180.298 3049.619 L 4182.338 3051.659 L 4182.338 3048.799 M 4180.498 3047.449 L 4180.498 3043.769 M 4179.068 3039.349 L 4178.658 3039.559 L 4178.248 3039.959 L 4178.048 3040.369 L 4178.048 3041.189 L 4178.248 3041.599 L 4178.658 3042.009 L 4179.068 3042.209 L 4179.688 3042.419 L 4180.708 3042.419 L 4181.318 3042.209 L 4181.728 3042.009 L 4182.138 3041.599 L 4182.338 3041.189 L 4182.338 3040.369 L 4182.138 3039.959 L 4181.728 3039.559 L 4181.318 3039.349 M 4178.048 3037.589 L 4178.048 3035.339 L 4179.688 3036.569 L 4179.688 3035.959 L 4179.888 3035.549 L 4180.088 3035.339 L 4180.708 3035.139 L 4181.118 3035.139 L 4181.728 3035.339 L 4182.138 3035.749 L 4182.338 3036.359 L 4182.338 3036.979 L 4182.138 3037.589 L 4181.938 3037.799 L 4181.528 3037.999 M 4180.498 3033.789 L 4180.498 3030.109 M 4178.658 3025.889 L 4178.248 3026.299 L 4178.048 3026.909 L 4178.048 3027.729 L 4178.248 3028.349 L 4178.658 3028.759 L 4179.068 3028.759 L 4179.478 3028.549 L 4179.688 3028.349 L 4179.888 3027.939 L 4180.298 3026.709 L 4180.498 3026.299 L 4180.708 3026.099 L 4181.118 3025.889 L 4181.728 3025.889 L 4182.138 3026.299 L 4182.338 3026.909 L 4182.338 3027.729 L 4182.138 3028.349 L 4181.728 3028.759 M 4179.068 3024.339 L 4178.868 3024.339 L 4178.458 3024.129 L 4178.248 3023.929 L 4178.048 3023.519 L 4178.048 3022.699 L 4178.248 3022.289 L 4178.458 3022.089 L 4178.868 3021.879 L 4179.278 3021.879 L 4179.688 3022.089 L 4180.298 3022.499 L 4182.338 3024.539 L 4182.338 3021.679 M 4181.318 3020.119 L 4181.528 3020.329 L 4181.728 3020.119 L 4181.528 3019.919 L 4181.318 3020.119 M 4178.048 3016.109 L 4178.048 3018.159 L 4179.888 3018.359 L 4179.688 3018.159 L 4179.478 3017.549 L 4179.478 3016.929 L 4179.688 3016.319 L 4180.088 3015.909 L 4180.708 3015.709 L 4181.118 3015.709 L 4181.728 3015.909 L 4182.138 3016.319 L 4182.338 3016.929 L 4182.338 3017.549 L 4182.138 3018.159 L 4181.938 3018.359 L 4181.528 3018.569 M 4178.048 3012.309 L 4180.908 3014.359 L 4180.908 3011.289 M 4178.048 3012.309 L 4182.338 3012.309","useTrueTypeFontRendering":false,"thickness":0.6,"width":0.6,"net":"","val":1},{"type":"text","svgpath":"M 4189.6404 3121.8596 L 4189.6404 3124.1396 M 4188.5004 3122.9996 L 4190.7804 3122.9996","useTrueTypeFontRendering":false,"thickness":0.6,"width":0.6,"net":""},{"type":"text","svgpath":"M 4185.6404 3158.8596 L 4185.6404 3161.1396 M 4184.5004 3159.9996 L 4186.7804 3159.9996","useTrueTypeFontRendering":false,"thickness":0.6,"width":0.6,"net":""},{"type":"text","svgpath":"M 4195.5002 3159.9997 L 4193.2202 3159.9997","useTrueTypeFontRendering":false,"thickness":0.6,"width":0.6,"net":""},{"type":"text","svgpath":"M 4195.9998 3123.0003 L 4198.2798 3123.0003","useTrueTypeFontRendering":false,"thickness":0.6,"width":0.6,"net":""},{"type":"text","svgpath":"M 4207 3203.53 L 4208.43 3207.29 M 4209.86 3203.53 L 4208.43 3207.29","useTrueTypeFontRendering":false,"thickness":0.8,"width":0.8,"net":""},{"type":"text","svgpath":"M 4199 3203.53 L 4199 3207.29 M 4199 3203.53 L 4200.25 3203.53 L 4200.79 3203.71 L 4201.15 3204.06 L 4201.33 3204.42 L 4201.51 3204.96 L 4201.51 3205.85 L 4201.33 3206.39 L 4201.15 3206.75 L 4200.79 3207.11 L 4200.25 3207.29 L 4199 3207.29","useTrueTypeFontRendering":false,"thickness":0.8,"width":0.8,"net":""},{"type":"text","svgpath":"M 4194.68 3204.42 L 4194.51 3204.06 L 4194.15 3203.71 L 4193.79 3203.53 L 4193.07 3203.53 L 4192.72 3203.71 L 4192.36 3204.06 L 4192.18 3204.42 L 4192 3204.96 L 4192 3205.85 L 4192.18 3206.39 L 4192.36 3206.75 L 4192.72 3207.11 L 4193.07 3207.29 L 4193.79 3207.29 L 4194.15 3207.11 L 4194.51 3206.75 L 4194.68 3206.39 L 4194.68 3205.85 M 4193.79 3205.85 L 4194.68 3205.85","useTrueTypeFontRendering":false,"thickness":0.8,"width":0.8,"net":""}],"B":[{"type":"text","svgpath":"M 4324.3209 3201.9604 L 4324.3209 3207.687 L 4324.6788 3208.7607 L 4325.0367 3209.1186 L 4325.7525 3209.4765 L 4326.4684 3209.4765 L 4327.1842 3209.1186 L 4327.5421 3208.7607 L 4327.9 3207.687 L 4327.9 3206.9711 M 4321.9587 3201.9604 L 4321.9587 3209.4765 M 4321.9587 3209.4765 L 4317.6638 3209.4765 M 4309.9329 3203.75 L 4310.2908 3203.0341 L 4311.0067 3202.3183 L 4311.7225 3201.9604 L 4313.1541 3201.9604 L 4313.8699 3202.3183 L 4314.5858 3203.0341 L 4314.9437 3203.75 L 4315.3016 3204.8237 L 4315.3016 3206.6132 L 4314.9437 3207.687 L 4314.5858 3208.4028 L 4313.8699 3209.1186 L 4313.1541 3209.4765 L 4311.7225 3209.4765 L 4311.0067 3209.1186 L 4310.2908 3208.4028 L 4309.9329 3207.687 M 4303.9916 3201.9604 L 4303.9916 3207.687 L 4304.3495 3208.7607 L 4304.7074 3209.1186 L 4305.4233 3209.4765 L 4306.1391 3209.4765 L 4306.8549 3209.1186 L 4307.2128 3208.7607 L 4307.5707 3207.687 L 4307.5707 3206.9711 M 4301.6294 3201.9604 L 4301.6294 3209.4765 M 4301.6294 3209.4765 L 4297.3345 3209.4765 M 4289.6037 3203.75 L 4289.9616 3203.0341 L 4290.6774 3202.3183 L 4291.3932 3201.9604 L 4292.8248 3201.9604 L 4293.5407 3202.3183 L 4294.2565 3203.0341 L 4294.6144 3203.75 L 4294.9723 3204.8237 L 4294.9723 3206.6132 L 4294.6144 3207.687 L 4294.2565 3208.4028 L 4293.5407 3209.1186 L 4292.8248 3209.4765 L 4291.3932 3209.4765 L 4290.6774 3209.1186 L 4289.9616 3208.4028 L 4289.6037 3207.687 M 4283.6623 3201.9604 L 4283.6623 3207.687 L 4284.0203 3208.7607 L 4284.3782 3209.1186 L 4285.094 3209.4765 L 4285.8098 3209.4765 L 4286.5256 3209.1186 L 4286.8835 3208.7607 L 4287.2414 3207.687 L 4287.2414 3206.9711 M 4281.3001 3201.9604 L 4281.3001 3209.4765 M 4281.3001 3209.4765 L 4277.0052 3209.4765 M 4269.2744 3203.75 L 4269.6323 3203.0341 L 4270.3481 3202.3183 L 4271.0639 3201.9604 L 4272.4956 3201.9604 L 4273.2114 3202.3183 L 4273.9272 3203.0341 L 4274.2851 3203.75 L 4274.643 3204.8237 L 4274.643 3206.6132 L 4274.2851 3207.687 L 4273.9272 3208.4028 L 4273.2114 3209.1186 L 4272.4956 3209.4765 L 4271.0639 3209.4765 L 4270.3481 3209.1186 L 4269.6323 3208.4028 L 4269.2744 3207.687 M 4263.3331 3201.9604 L 4263.3331 3207.687 L 4263.691 3208.7607 L 4264.0489 3209.1186 L 4264.7647 3209.4765 L 4265.4805 3209.4765 L 4266.1963 3209.1186 L 4266.5543 3208.7607 L 4266.9122 3207.687 L 4266.9122 3206.9711 M 4260.9709 3201.9604 L 4260.9709 3209.4765 M 4260.9709 3209.4765 L 4256.6759 3209.4765 M 4248.9451 3203.75 L 4249.303 3203.0341 L 4250.0188 3202.3183 L 4250.7346 3201.9604 L 4252.1663 3201.9604 L 4252.8821 3202.3183 L 4253.5979 3203.0341 L 4253.9558 3203.75 L 4254.3137 3204.8237 L 4254.3137 3206.6132 L 4253.9558 3207.687 L 4253.5979 3208.4028 L 4252.8821 3209.1186 L 4252.1663 3209.4765 L 4250.7346 3209.4765 L 4250.0188 3209.1186 L 4249.303 3208.4028 L 4248.9451 3207.687","useTrueTypeFontRendering":false,"thickness":0.8,"width":0.8,"net":""}]},"fabrication":{"F":[],"B":[]}},"footprints":[{"ref":"LED","center":[4193.926,3195.462],"bbox":{"pos":[4193.926,3195.462],"angle":0,"relpos":[-15.748000000000502,-11.023999999999887],"size":[31.496000000000095,17.7170000000001]},"pads":[{"layers":["F","B"],"pos":[4193.926,3195.462],"size":[6.2992,6.2992],"angle":-180,"shape":"oval","type":"th","drillsize":[3.937,3.937],"holeCenterPoint":{"x":4193.926,"y":3195.462},"polygon":[],"net":"LEDIN"},{"layers":["F","B"],"pos":[4201.8,3195.462],"size":[6.2992,6.2992],"angle":-180,"pin1":1,"shape":"oval","type":"th","drillsize":[3.937,3.937],"holeCenterPoint":{"x":4201.8,"y":3195.462},"polygon":[],"net":"5V"},{"layers":["F","B"],"pos":[4186.052,3195.462],"size":[6.2992,6.2992],"angle":-180,"shape":"oval","type":"th","drillsize":[3.937,3.937],"holeCenterPoint":{"x":4186.052,"y":3195.462},"polygon":[],"net":"GND"}],"drawings":[],"layer":"F"},{"ref":"HEF","center":[4190.089,3169.406],"bbox":{"pos":[4190.089,3169.406],"angle":180,"relpos":[-11.810999999999694,-11.023999999999432],"size":[23.62199999999939,17.716999999999643]},"pads":[{"layers":["F","B"],"pos":[4194.026,3169.406],"size":[6.2992,6.2992],"angle":0,"shape":"oval","type":"th","drillsize":[3.937,3.937],"holeCenterPoint":{"x":4194.026,"y":3169.406},"polygon":[],"net":"HEFGND"},{"layers":["F","B"],"pos":[4186.152,3169.406],"size":[6.2992,6.2992],"angle":0,"pin1":1,"shape":"oval","type":"th","drillsize":[3.937,3.937],"holeCenterPoint":{"x":4186.152,"y":3169.406},"polygon":[],"net":"24V/5VF"}],"drawings":[],"layer":"F"},{"ref":"PCF","center":[4193.729,3109.26],"bbox":{"pos":[4193.729,3109.26],"angle":180,"relpos":[-11.810999999999694,-11.023999999999432],"size":[23.6220000000003,17.7170000000001]},"pads":[{"layers":["F","B"],"pos":[4197.666,3109.26],"size":[6.2992,6.2992],"angle":0,"shape":"oval","type":"th","drillsize":[3.937,3.937],"holeCenterPoint":{"x":4197.666,"y":3109.26},"polygon":[],"net":"PCFGND"},{"layers":["F","B"],"pos":[4189.792,3109.26],"size":[6.2992,6.2992],"angle":0,"pin1":1,"shape":"oval","type":"th","drillsize":[3.937,3.937],"holeCenterPoint":{"x":4189.792,"y":3109.26},"polygon":[],"net":"24V/5VF"}],"drawings":[],"layer":"F"},{"ref":"U10","center":[4201.588,3141.809],"bbox":{"pos":[4201.588,3141.809],"angle":90,"relpos":[-15.905500000000757,-10],"size":[31.811000000000604,20]},"pads":[{"layers":["F","B"],"pos":[4206.588,3151.809],"size":[6.6929,6.6929],"angle":-90,"pin1":1,"shape":"rect","type":"th","drillsize":[4.3308,4.3308],"holeCenterPoint":{"x":4206.588,"y":3151.809},"polygon":[{"x":4203.242,"y":3155.155},{"x":4203.242,"y":3148.463},{"x":4209.934,"y":3148.463},{"x":4209.934,"y":3155.155}],"net":"PCFGND"},{"layers":["F","B"],"pos":[4196.588,3151.809],"size":[6.6929,6.6929],"angle":-90,"shape":"oval","type":"th","drillsize":[4.3308,4.3308],"holeCenterPoint":{"x":4196.588,"y":3151.809},"polygon":[],"net":"GND"},{"layers":["F","B"],"pos":[4206.588,3141.809],"size":[6.6929,6.6929],"angle":-90,"shape":"oval","type":"th","drillsize":[4.3308,4.3308],"holeCenterPoint":{"x":4206.588,"y":3141.809},"polygon":[],"net":"HEFGND"},{"layers":["F","B"],"pos":[4196.588,3141.809],"size":[6.6929,6.6929],"angle":-90,"shape":"oval","type":"th","drillsize":[4.3308,4.3308],"holeCenterPoint":{"x":4196.588,"y":3141.809},"polygon":[],"net":"LEDIN"},{"layers":["F","B"],"pos":[4206.588,3131.809],"size":[6.6929,6.6929],"angle":-90,"shape":"oval","type":"th","drillsize":[4.3308,4.3308],"holeCenterPoint":{"x":4206.588,"y":3131.809},"polygon":[],"net":"24V/5VF"},{"layers":["F","B"],"pos":[4196.588,3131.809],"size":[6.6929,6.6929],"angle":-90,"shape":"oval","type":"th","drillsize":[4.3308,4.3308],"holeCenterPoint":{"x":4196.588,"y":3131.809},"polygon":[],"net":"5V"}],"drawings":[],"layer":"F"}],"metadata":{"title":"PCB_sb","revision":"0","company":"Unknown Company","date":"2022-03-15"},"tracks":{"F":[{"type":"polyline","net":"PCFGND","start":[0,0],"end":[0,0],"width":3.937,"svgpath":"M4206.5919,3151.8059 4211.7521,3151.8059 4216.652,3146.906 4216.652,3115.906 4211.652,3110.906 4199.3122,3110.906 4197.6618,3109.2561"},{"type":"polyline","net":"LEDIN","start":[0,0],"end":[0,0],"width":3.937,"svgpath":"M4196.588,3141.8091 4192.7492,3141.8091 4177.652,3156.906 4177.652,3175.906 4183.652,3181.906 4190.152,3181.906 4194.152,3185.906 4194.152,3195.2361 4193.9259,3195.4619"},{"type":"polygon","svgpath":"M 4191.6769 3193.257 L 4196.3947 3193.5061 L 4196.1205 3191.2838 L 4192.1835 3191.076 Z ","start":[0,0],"end":[0,0],"net":"LEDIN"},{"type":"polygon","svgpath":"M 4194.3746 3144.3189 L 4194.3746 3139.2992 L 4192.7492 3139.8406 L 4192.7492 3143.7776 Z ","start":[0,0],"end":[0,0],"net":"LEDIN"},{"type":"polygon","svgpath":"M 4200.4966 3107.8785 L 4198.6831 3112.2409 L 4200.8073 3112.8745 L 4202.444 3108.9375 Z ","start":[0,0],"end":[0,0],"net":"PCFGND"},{"type":"polygon","svgpath":"M 4209.9342 3148.4629 L 4209.9342 3155.155 L 4211.7492 3153.7776 L 4211.7492 3149.8406 Z ","start":[0,0],"end":[0,0],"net":"PCFGND"}],"B":[{"type":"polyline","net":"HEFGND","start":[0,0],"end":[0,0],"width":3.937,"svgpath":"M4206.588,3141.8091 4211.5548,3141.8091 4219.652,3149.906 4219.652,3160.906 4211.152,3169.406 4194.026,3169.406"},{"type":"polygon","svgpath":"M 4196.1093 3171.7682 L 4196.1093 3167.0438 L 4198.314 3167.4375 L 4198.314 3171.3745 Z ","start":[0,0],"end":[0,0],"net":"HEFGND"},{"type":"polygon","svgpath":"M 4208.8015 3144.3189 L 4208.8015 3139.2992 L 4211.144 3139.8406 L 4211.144 3143.7776 Z ","start":[0,0],"end":[0,0],"net":"HEFGND"}]},"zones":{"F":[{"net":"GND","svgpath":"M 4372.91219 3216.02581 L 4362.53766 3215.99695 4362.17576 3215.9461 4346.47276 3215.9461 4314.07506 3215.846 4265.95499 3215.6961 4234.6586 3215.59712 4234.34647 3215.5475 4234.2956 3215.5459 4218.41248 3215.5459 4213.84378 3215.53582 4212.03709 3215.48977 4210.24944 3215.36741 4208.46913 3215.16769 4206.69915 3214.89095 4204.94285 3214.53772 4203.20351 3214.10866 4201.48441 3213.60457 4199.7888 3213.02642 4198.11984 3212.37527 4196.4807 3211.65237 4194.87443 3210.85906 4193.29834 3209.99411 4181.24391 3203.03417 4180.03244 3202.2456 4179.99757 3202.22009 4178.96643 3201.37682 4178.93459 3201.34778 4178.00003 3200.39833 4177.97151 3200.36606 4177.14438 3199.32157 4177.1194 3199.28624 4176.4101 3198.15881 4176.38917 3198.12119 4175.80494 3196.92367 4175.78814 3196.88394 4175.3363 3195.63063 4175.32386 3195.58924 4175.00992 3194.29475 4175.00203 3194.25238 4174.81506 3192.81915 4172.84453 3166.79062 4172.84339 3166.76048 4172.8385 3133.50161 4172.90028 3131.86059 4172.95365 3131.30174 4173.17059 3129.7432 4173.45642 3128.4157 4183.67773 3088.9828 4183.93272 3088.14587 4184.23932 3087.37409 4184.60806 3086.63 4185.03647 3085.91858 4185.52166 3085.24461 4186.06038 3084.61262 4186.64903 3084.02684 4187.28364 3083.4912 4187.95997 3083.0093 4188.67346 3082.58437 4189.41934 3082.21927 4190.19261 3081.91643 4190.98806 3081.6779 4191.80037 3081.50528 4192.62408 3081.39972 4193.45366 3081.36193 4194.28356 3081.39217 4195.1082 3081.49022 4195.92204 3081.65545 4196.71963 3081.88673 4197.49562 3082.18251 4198.24475 3082.5408 4198.9726 3082.9643 4378.40492 3197.31501 4379.13763 3197.82744 4379.78956 3198.3706 4380.39386 3198.96646 4380.9462 3199.61076 4381.44273 3200.299 4381.87997 3201.02635 4382.25484 3201.78772 4382.56473 3202.57777 4382.80746 3203.39097 4382.98133 3204.22162 4383.08512 3205.0639 4383.11811 3205.91192 4383.08007 3206.75972 4382.97126 3207.60136 4382.79244 3208.43097 4382.54487 3209.24271 4382.23028 3210.0309 4381.85088 3210.79002 4381.40932 3211.51475 4380.91259 3212.19337 4380.07569 3213.12175 4379.47506 3213.6667 4378.85058 3214.14786 4378.1906 3214.57904 4377.49912 3214.95764 4376.78031 3215.28137 4376.03852 3215.54828 4375.27823 3215.75675 4374.50405 3215.90552 4373.7195 3215.99394 4372.91219 3216.02581 Z M 4201.8 3199.63074 L 4202.34413 3199.59508 4202.87895 3199.4887 4203.39531 3199.31342 4203.88437 3199.07224 4204.33777 3198.76929 4204.74775 3198.40975 4205.10729 3197.99977 4205.41024 3197.54637 4205.65142 3197.05731 4205.8267 3196.54095 4205.93308 3196.00613 4205.96874 3195.462 4205.93308 3194.91787 4205.8267 3194.38305 4205.65142 3193.86669 4205.41024 3193.37763 4205.10729 3192.92423 4204.74775 3192.51425 4204.33777 3192.15471 4203.88437 3191.85176 4203.39531 3191.61058 4202.87895 3191.4353 4202.34413 3191.32892 4201.8 3191.29326 4201.25587 3191.32892 4200.72105 3191.4353 4200.20469 3191.61058 4199.71563 3191.85176 4199.26223 3192.15471 4198.85225 3192.51425 4198.49271 3192.92423 4198.19551 3193.36903 4198.08538 3193.47923 4197.94151 3193.539 4197.78571 3193.53928 4197.64162 3193.48001 4197.53111 3193.37019 4197.38809 3193.13808 4197.36579 3193.04704 4197.14351 3191.24551 4197.1405 3191.19653 4197.1405 3185.90974 4197.13848 3185.80174 4197.1058 3185.45322 4197.08959 3185.3578 4197.00532 3185.01803 4196.97507 3184.9261 4196.84111 3184.60269 4196.79749 3184.51628 4196.61682 3184.21645 4196.56082 3184.13752 4196.33748 3183.86796 4196.26254 3183.79017 4192.26783 3179.79546 4192.19004 3179.72052 4191.92048 3179.49718 4191.84155 3179.44118 4191.54172 3179.26051 4191.45531 3179.21689 4191.1319 3179.08293 4191.03997 3179.05268 4190.7002 3178.96841 4190.60478 3178.9522 4190.25626 3178.91952 4190.14826 3178.9175 4185.05556 3178.9175 4184.90249 3178.88705 4184.77272 3178.80034 4180.75766 3174.78528 4180.67095 3174.65551 4180.6405 3174.50244 4180.6405 3158.30958 4180.67095 3158.15651 4180.75766 3158.02674 4193.4523 3145.33235 4193.56885 3145.2514 4193.70632 3145.21623 4193.84742 3145.23127 4193.97439 3145.29463 4194.2064 3145.46778 4194.69383 3145.74229 4195.21236 3145.95222 4195.75347 3146.09412 4196.30829 3146.16566 4196.86771 3146.16566 4197.42253 3146.09412 4197.96364 3145.95222 4198.48217 3145.74229 4198.9696 3145.46778 4199.41792 3145.13319 4199.81978 3144.74401 4200.16857 3144.30665 4200.45856 3143.82827 4200.685 3143.31673 4200.84417 3142.78044 4200.93345 3142.2282 4200.95138 3141.66907 4200.89767 3141.11225 4200.77319 3140.56686 4200.57998 3140.04187 4200.32123 3139.54589 4200.00118 3139.08708 4199.62509 3138.67296 4199.19913 3138.31033 4198.73029 3138.00515 4198.22628 3137.76243 4197.69536 3137.58615 4197.14626 3137.47922 4196.588 3137.44337 4196.02974 3137.47922 4195.48064 3137.58615 4194.94972 3137.76243 4194.44571 3138.00515 4193.97687 3138.31033 4193.8139 3138.41087 4192.59484 3138.81692 4192.50578 3138.83567 4192.20103 3138.87151 4191.86123 3138.95578 4191.76933 3138.98602 4191.44588 3139.11999 4191.35951 3139.16359 4191.05965 3139.34428 4190.98074 3139.40027 4190.71116 3139.62362 4190.63339 3139.69853 4175.54148 3154.79015 4175.46652 3154.86796 4175.2432 3155.13749 4175.18717 3155.21645 4175.00652 3155.51626 4174.96289 3155.60269 4174.82894 3155.92607 4174.79868 3156.01804 4174.71442 3156.35777 4174.6982 3156.45322 4174.66552 3156.80171 4174.6635 3156.90974 4174.6635 3175.90226 4174.66552 3176.01026 4174.6982 3176.35878 4174.71441 3176.4542 4174.79868 3176.79397 4174.82893 3176.8859 4174.96289 3177.20931 4175.00651 3177.29572 4175.18718 3177.59555 4175.24318 3177.67448 4175.46652 3177.94404 4175.54146 3178.02183 4181.53617 3184.01654 4181.61396 3184.09148 4181.88352 3184.31482 4181.96245 3184.37082 4182.26228 3184.55149 4182.34869 3184.59511 4182.6721 3184.72907 4182.76403 3184.75932 4183.1038 3184.84359 4183.19922 3184.8598 4183.54774 3184.89248 4183.65574 3184.8945 4188.74844 3184.8945 4188.90151 3184.92495 4189.03128 3185.01166 4191.04634 3187.02672 4191.13305 3187.15649 4191.1635 3187.30956 4191.1635 3190.91325 4191.15313 3191.00375 4190.76157 3192.68946 4190.72783 3192.78157 4190.61871 3192.92423 4190.31576 3193.37763 4190.07458 3193.86669 4189.8993 3194.38305 4189.79292 3194.91787 4189.75726 3195.462 4189.79292 3196.00613 4189.8993 3196.54095 4190.07458 3197.05731 4190.31576 3197.54637 4190.61871 3197.99977 4190.97825 3198.40975 4191.38823 3198.76929 4191.84163 3199.07224 4192.33069 3199.31342 4192.84705 3199.4887 4193.38187 3199.59508 4193.926 3199.63074 4194.47013 3199.59508 4195.00495 3199.4887 4195.52131 3199.31342 4196.01037 3199.07224 4196.46377 3198.76929 4196.87375 3198.40975 4197.23329 3197.99977 4197.53041 3197.55509 4197.64077 3197.44473 4197.78496 3197.385 4197.94104 3197.385 4198.08523 3197.44473 4198.19559 3197.55509 4198.49271 3197.99977 4198.85225 3198.40975 4199.26223 3198.76929 4199.71563 3199.07224 4200.20469 3199.31342 4200.72105 3199.4887 4201.25587 3199.59508 4201.8 3199.63074 Z M 4203.01514 3156.14741 L 4203.26401 3156.17545 4209.91199 3156.17545 4210.16086 3156.14741 4210.37582 3156.07219 4210.59249 3155.93589 4212.0462 3154.83267 4212.12903 3154.78426 4212.64007 3154.65922 4212.732 3154.62897 4213.05541 3154.49501 4213.14182 3154.45139 4213.44165 3154.27072 4213.52058 3154.21472 4213.79014 3153.99138 4213.86793 3153.91644 4218.76254 3149.02183 4218.83748 3148.94404 4219.06082 3148.67448 4219.11682 3148.59555 4219.29749 3148.29572 4219.34111 3148.20931 4219.47507 3147.8859 4219.50532 3147.79397 4219.58959 3147.4542 4219.6058 3147.35878 4219.63848 3147.01026 4219.6405 3146.90226 4219.6405 3115.90974 4219.63848 3115.80174 4219.6058 3115.45322 4219.58959 3115.3578 4219.50532 3115.01803 4219.47507 3114.9261 4219.34111 3114.60269 4219.29749 3114.51628 4219.11682 3114.21645 4219.06082 3114.13752 4218.83748 3113.86796 4218.76254 3113.79017 4213.76783 3108.79546 4213.69004 3108.72052 4213.42048 3108.49718 4213.34155 3108.44118 4213.04172 3108.26051 4212.95531 3108.21689 4212.6319 3108.08293 4212.53997 3108.05268 4212.2002 3107.96841 4212.10478 3107.9522 4211.75626 3107.91952 4211.64826 3107.9175 4202.80513 3107.9175 4202.70654 3107.90516 4202.61403 3107.8689 4201.327 3107.16901 4201.2484 3107.11302 4201.1855 3107.03983 4200.97329 3106.72223 4200.61375 3106.31225 4200.20377 3105.95271 4199.75037 3105.64976 4199.26131 3105.40858 4198.74495 3105.2333 4198.21013 3105.12692 4197.666 3105.09126 4197.12187 3105.12692 4196.58705 3105.2333 4196.07069 3105.40858 4195.58163 3105.64976 4195.12823 3105.95271 4194.71825 3106.31225 4194.35871 3106.72223 4194.06159 3107.16691 4193.95123 3107.27727 4193.80704 3107.337 4193.65096 3107.337 4193.50677 3107.27727 4193.39641 3107.16691 4193.09929 3106.72223 4192.73975 3106.31225 4192.32977 3105.95271 4191.87637 3105.64976 4191.38731 3105.40858 4190.87095 3105.2333 4190.33613 3105.12692 4189.792 3105.09126 4189.24787 3105.12692 4188.71305 3105.2333 4188.19669 3105.40858 4187.70763 3105.64976 4187.25423 3105.95271 4186.84425 3106.31225 4186.48471 3106.72223 4186.18176 3107.17563 4185.94058 3107.66469 4185.7653 3108.18105 4185.65892 3108.71587 4185.62326 3109.26 4185.65892 3109.80413 4185.7653 3110.33895 4185.94058 3110.85531 4186.18176 3111.34437 4186.48471 3111.79777 4186.84425 3112.20775 4187.25423 3112.56729 4187.70763 3112.87024 4188.19669 3113.11142 4188.71305 3113.2867 4189.24787 3113.39308 4189.792 3113.42874 4190.33613 3113.39308 4190.87095 3113.2867 4191.38731 3113.11142 4191.87637 3112.87024 4192.32977 3112.56729 4192.73975 3112.20775 4193.09929 3111.79777 4193.39641 3111.35309 4193.50677 3111.24273 4193.65096 3111.183 4193.80704 3111.183 4193.95123 3111.24273 4194.06159 3111.35309 4194.35871 3111.79777 4194.71825 3112.20775 4195.12823 3112.56729 4195.58163 3112.87024 4196.07069 3113.11142 4196.58705 3113.2867 4197.12187 3113.39308 4197.63405 3113.42665 4197.80563 3113.47809 4198.01806 3113.59891 4198.33275 3113.72923 4198.4242 3113.75931 4198.76447 3113.84367 4198.85939 3113.85979 4199.20843 3113.8925 4199.31592 3113.8945 4210.24844 3113.8945 4210.40151 3113.92495 4210.53128 3114.01166 4213.54634 3117.02672 4213.63305 3117.15649 4213.6635 3117.30956 4213.6635 3145.50244 4213.63305 3145.65551 4213.54634 3145.78528 4211.44019 3147.89144 4211.3229 3147.97272 4211.18455 3148.00767 4211.04273 3147.99182 4210.9155 3147.9272 4210.56664 3147.6624 4210.37791 3147.54654 4210.16086 3147.47059 4209.91199 3147.44255 4203.26401 3147.44255 4203.01514 3147.47059 4202.80009 3147.54584 4202.60717 3147.66706 4202.44606 3147.82817 4202.32484 3148.02109 4202.24959 3148.23614 4202.22155 3148.48501 4202.22155 3155.13299 4202.24959 3155.38186 4202.32484 3155.59691 4202.44606 3155.78983 4202.60717 3155.95094 4202.80009 3156.07216 4203.01514 3156.14741 Z M 4373.17012 3213.78902 L 4373.93236 3213.73366 4374.68571 3213.605 4375.42312 3213.40422 4376.13771 3213.13321 4376.8228 3212.7945 4377.47201 3212.39125 4378.07927 3211.92723 4378.63891 3211.40676 4379.1457 3210.83471 4379.59492 3210.21641 4379.98237 3209.55765 4380.30442 3208.86457 4380.55808 3208.14364 4380.74098 3207.40159 4380.85141 3206.64536 4380.88833 3205.882 4380.85141 3205.11864 4380.74098 3204.36241 4380.55808 3203.62036 4380.30442 3202.89943 4379.98237 3202.20635 4379.59492 3201.54759 4379.1457 3200.92929 4378.63891 3200.35724 4378.07927 3199.83677 4377.47201 3199.37275 4376.8228 3198.9695 4376.13771 3198.63079 4375.42312 3198.35978 4374.68571 3198.159 4373.93236 3198.03034 4373.17012 3197.97498 4372.40609 3197.99344 4371.64741 3198.08556 4370.90116 3198.25048 4370.17431 3198.48665 4369.47365 3198.79186 4368.80572 3199.16328 4368.17675 3199.59742 4367.59262 3200.09024 4367.05878 3200.63714 4366.58022 3201.23301 4366.1614 3201.87229 4365.80623 3202.549 4365.51803 3203.25683 4365.2995 3203.98917 4365.15267 3204.73919 4365.0789 3205.49987 4365.0789 3206.26413 4365.15267 3207.02481 4365.2995 3207.77483 4365.51803 3208.50717 4365.80623 3209.215 4366.1614 3209.89171 4366.58022 3210.53099 4367.05878 3211.12686 4367.59262 3211.67376 4368.17675 3212.16658 4368.80572 3212.60072 4369.47365 3212.97214 4370.17431 3213.27735 4370.90116 3213.51352 4371.64741 3213.67844 4372.40609 3213.77056 4373.17012 3213.78902 Z M 4193.69112 3099.40702 L 4194.45336 3099.35166 4195.20671 3099.223 4195.94412 3099.02222 4196.65871 3098.75121 4197.3438 3098.4125 4197.99301 3098.00925 4198.60027 3097.54523 4199.15991 3097.02476 4199.6667 3096.45271 4200.11592 3095.83441 4200.50337 3095.17565 4200.82542 3094.48257 4201.07908 3093.76164 4201.26198 3093.01959 4201.37241 3092.26336 4201.40933 3091.5 4201.37241 3090.73664 4201.26198 3089.98041 4201.07908 3089.23836 4200.82542 3088.51743 4200.50337 3087.82435 4200.11592 3087.16559 4199.6667 3086.54729 4199.15991 3085.97524 4198.60027 3085.45477 4197.99301 3084.99075 4197.3438 3084.5875 4196.65871 3084.24879 4195.94412 3083.97778 4195.20671 3083.777 4194.45336 3083.64834 4193.69112 3083.59298 4192.92709 3083.61144 4192.16841 3083.70356 4191.42216 3083.86848 4190.69531 3084.10465 4189.99465 3084.40986 4189.32672 3084.78128 4188.69775 3085.21542 4188.11362 3085.70824 4187.57978 3086.25514 4187.10122 3086.85101 4186.6824 3087.49029 4186.32723 3088.167 4186.03903 3088.87483 4185.8205 3089.60717 4185.67367 3090.35719 4185.5999 3091.11787 4185.5999 3091.88213 4185.67367 3092.64281 4185.8205 3093.39283 4186.03903 3094.12517 4186.32723 3094.833 4186.6824 3095.50971 4187.10122 3096.14899 4187.57978 3096.74486 4188.11362 3097.29176 4188.69775 3097.78458 4189.32672 3098.21872 4189.99465 3098.59014 4190.69531 3098.89535 4191.42216 3099.13152 4192.16841 3099.29644 4192.92709 3099.38856 4193.69112 3099.40702 Z M 4193.48187 3173.53908 L 4194.026 3173.57474 4194.57013 3173.53908 4195.10495 3173.4327 4195.62131 3173.25742 4196.11037 3173.01624 4196.56377 3172.71329 4196.97375 3172.35375 4197.33329 3171.94377 4197.63624 3171.49037 4197.87742 3171.00131 4198.0527 3170.48495 4198.15908 3169.95013 4198.19474 3169.406 4198.15908 3168.86187 4198.0527 3168.32705 4197.87742 3167.81069 4197.63624 3167.32163 4197.33329 3166.86823 4196.97375 3166.45825 4196.56377 3166.09871 4196.11037 3165.79576 4195.62131 3165.55458 4195.10495 3165.3793 4194.57013 3165.27292 4194.026 3165.23726 4193.48187 3165.27292 4192.94705 3165.3793 4192.43069 3165.55458 4191.94163 3165.79576 4191.48823 3166.09871 4191.07825 3166.45825 4190.71871 3166.86823 4190.42159 3167.31291 4190.31123 3167.42327 4190.16704 3167.483 4190.01096 3167.483 4189.86677 3167.42327 4189.75641 3167.31291 4189.45929 3166.86823 4189.09975 3166.45825 4188.68977 3166.09871 4188.23637 3165.79576 4187.74731 3165.55458 4187.23095 3165.3793 4186.69613 3165.27292 4186.152 3165.23726 4185.60787 3165.27292 4185.07305 3165.3793 4184.55669 3165.55458 4184.06763 3165.79576 4183.61423 3166.09871 4183.20425 3166.45825 4182.84471 3166.86823 4182.54176 3167.32163 4182.30058 3167.81069 4182.1253 3168.32705 4182.01892 3168.86187 4181.98326 3169.406 4182.01892 3169.95013 4182.1253 3170.48495 4182.30058 3171.00131 4182.54176 3171.49037 4182.84471 3171.94377 4183.20425 3172.35375 4183.61423 3172.71329 4184.06763 3173.01624 4184.55669 3173.25742 4185.07305 3173.4327 4185.60787 3173.53908 4186.152 3173.57474 4186.69613 3173.53908 4187.23095 3173.4327 4187.74731 3173.25742 4188.23637 3173.01624 4188.68977 3172.71329 4189.09975 3172.35375 4189.45929 3171.94377 4189.75641 3171.49909 4189.86677 3171.38873 4190.01096 3171.329 4190.16704 3171.329 4190.31123 3171.38873 4190.42159 3171.49909 4190.71871 3171.94377 4191.07825 3172.35375 4191.48823 3172.71329 4191.94163 3173.01624 4192.43069 3173.25742 4192.94705 3173.4327 4193.48187 3173.53908 Z M 4195.75347 3136.09412 L 4196.30829 3136.16566 4196.86771 3136.16566 4197.42253 3136.09412 4197.96364 3135.95222 4198.48217 3135.74229 4198.9696 3135.46778 4199.41792 3135.13319 4199.81978 3134.74401 4200.16857 3134.30665 4200.45856 3133.82827 4200.685 3133.31673 4200.84417 3132.78044 4200.93345 3132.2282 4200.95138 3131.66907 4200.89767 3131.11225 4200.77319 3130.56686 4200.57998 3130.04187 4200.32123 3129.54589 4200.00118 3129.08708 4199.62509 3128.67296 4199.19913 3128.31033 4198.73029 3128.00515 4198.22628 3127.76243 4197.69536 3127.58615 4197.14626 3127.47922 4196.588 3127.44337 4196.02974 3127.47922 4195.48064 3127.58615 4194.94972 3127.76243 4194.44571 3128.00515 4193.97687 3128.31033 4193.55091 3128.67296 4193.17482 3129.08708 4192.85477 3129.54589 4192.59602 3130.04187 4192.40281 3130.56686 4192.27833 3131.11225 4192.22462 3131.66907 4192.24255 3132.2282 4192.33183 3132.78044 4192.491 3133.31673 4192.71744 3133.82827 4193.00743 3134.30665 4193.35622 3134.74401 4193.75808 3135.13319 4194.2064 3135.46778 4194.69383 3135.74229 4195.21236 3135.95222 4195.75347 3136.09412 Z M 4205.75347 3146.09412 L 4206.30829 3146.16566 4206.86771 3146.16566 4207.42253 3146.09412 4207.96364 3145.95222 4208.48217 3145.74229 4208.9696 3145.46778 4209.41792 3145.13319 4209.81978 3144.74401 4210.16857 3144.30665 4210.45856 3143.82827 4210.685 3143.31673 4210.84417 3142.78044 4210.93345 3142.2282 4210.95138 3141.66907 4210.89767 3141.11225 4210.77319 3140.56686 4210.57998 3140.04187 4210.32123 3139.54589 4210.00118 3139.08708 4209.62509 3138.67296 4209.19913 3138.31033 4208.73029 3138.00515 4208.22628 3137.76243 4207.69536 3137.58615 4207.14626 3137.47922 4206.588 3137.44337 4206.02974 3137.47922 4205.48064 3137.58615 4204.94972 3137.76243 4204.44571 3138.00515 4203.97687 3138.31033 4203.55091 3138.67296 4203.17482 3139.08708 4202.85477 3139.54589 4202.59602 3140.04187 4202.40281 3140.56686 4202.27833 3141.11225 4202.22462 3141.66907 4202.24255 3142.2282 4202.33183 3142.78044 4202.491 3143.31673 4202.71744 3143.82827 4203.00743 3144.30665 4203.35622 3144.74401 4203.75808 3145.13319 4204.2064 3145.46778 4204.69383 3145.74229 4205.21236 3145.95222 4205.75347 3146.09412 Z M 4205.75347 3136.09412 L 4206.30829 3136.16566 4206.86771 3136.16566 4207.42253 3136.09412 4207.96364 3135.95222 4208.48217 3135.74229 4208.9696 3135.46778 4209.41792 3135.13319 4209.81978 3134.74401 4210.16857 3134.30665 4210.45856 3133.82827 4210.685 3133.31673 4210.84417 3132.78044 4210.93345 3132.2282 4210.95138 3131.66907 4210.89767 3131.11225 4210.77319 3130.56686 4210.57998 3130.04187 4210.32123 3129.54589 4210.00118 3129.08708 4209.62509 3128.67296 4209.19913 3128.31033 4208.73029 3128.00515 4208.22628 3127.76243 4207.69536 3127.58615 4207.14626 3127.47922 4206.588 3127.44337 4206.02974 3127.47922 4205.48064 3127.58615 4204.94972 3127.76243 4204.44571 3128.00515 4203.97687 3128.31033 4203.55091 3128.67296 4203.17482 3129.08708 4202.85477 3129.54589 4202.59602 3130.04187 4202.40281 3130.56686 4202.27833 3131.11225 4202.22462 3131.66907 4202.24255 3132.2282 4202.33183 3132.78044 4202.491 3133.31673 4202.71744 3133.82827 4203.00743 3134.30665 4203.35622 3134.74401 4203.75808 3135.13319 4204.2064 3135.46778 4204.69383 3135.74229 4205.21236 3135.95222 4205.75347 3136.09412 Z "}],"B":[{"net":"GND","svgpath":"M 4372.91219 3216.02581 L 4362.53766 3215.99695 4362.17576 3215.9461 4346.47276 3215.9461 4314.07506 3215.846 4265.95499 3215.6961 4234.6586 3215.59712 4234.34647 3215.5475 4234.2956 3215.5459 4218.41248 3215.5459 4213.84378 3215.53582 4212.03709 3215.48977 4210.24944 3215.36741 4208.46913 3215.16769 4206.69915 3214.89095 4204.94285 3214.53772 4203.20351 3214.10866 4201.48441 3213.60457 4199.7888 3213.02642 4198.11984 3212.37527 4196.4807 3211.65237 4194.87443 3210.85906 4193.29834 3209.99411 4181.24391 3203.03417 4180.03244 3202.2456 4179.99757 3202.22009 4178.96643 3201.37682 4178.93459 3201.34778 4178.00003 3200.39833 4177.97151 3200.36606 4177.14438 3199.32157 4177.1194 3199.28624 4176.4101 3198.15881 4176.38917 3198.12119 4175.80494 3196.92367 4175.78814 3196.88394 4175.3363 3195.63063 4175.32386 3195.58924 4175.00992 3194.29475 4175.00203 3194.25238 4174.81506 3192.81915 4172.84453 3166.79062 4172.84339 3166.76048 4172.8385 3133.50161 4172.90028 3131.86059 4172.95365 3131.30174 4173.17059 3129.7432 4173.45642 3128.4157 4183.67773 3088.9828 4183.93272 3088.14587 4184.23932 3087.37409 4184.60806 3086.63 4185.03647 3085.91858 4185.52166 3085.24461 4186.06038 3084.61262 4186.64903 3084.02684 4187.28364 3083.4912 4187.95997 3083.0093 4188.67346 3082.58437 4189.41934 3082.21927 4190.19261 3081.91643 4190.98806 3081.6779 4191.80037 3081.50528 4192.62408 3081.39972 4193.45366 3081.36193 4194.28356 3081.39217 4195.1082 3081.49022 4195.92204 3081.65545 4196.71963 3081.88673 4197.49562 3082.18251 4198.24475 3082.5408 4198.9726 3082.9643 4378.40492 3197.31501 4379.13763 3197.82744 4379.78956 3198.3706 4380.39386 3198.96646 4380.9462 3199.61076 4381.44273 3200.299 4381.87997 3201.02635 4382.25484 3201.78772 4382.56473 3202.57777 4382.80746 3203.39097 4382.98133 3204.22162 4383.08512 3205.0639 4383.11811 3205.91192 4383.08007 3206.75972 4382.97126 3207.60136 4382.79244 3208.43097 4382.54487 3209.24271 4382.23028 3210.0309 4381.85088 3210.79002 4381.40932 3211.51475 4380.91259 3212.19337 4380.07569 3213.12175 4379.47506 3213.6667 4378.85058 3214.14786 4378.1906 3214.57904 4377.49912 3214.95764 4376.78031 3215.28137 4376.03852 3215.54828 4375.27823 3215.75675 4374.50405 3215.90552 4373.7195 3215.99394 4372.91219 3216.02581 Z M 4194.026 3173.57474 L 4194.57013 3173.53908 4195.10495 3173.4327 4195.62131 3173.25742 4196.11037 3173.01624 4196.474 3172.77327 4196.62591 3172.71208 4198.36948 3172.40073 4198.43979 3172.3945 4211.14826 3172.3945 4211.25626 3172.39248 4211.60478 3172.3598 4211.7002 3172.34359 4212.03997 3172.25932 4212.1319 3172.22907 4212.45531 3172.09511 4212.54172 3172.05149 4212.84155 3171.87082 4212.92048 3171.81482 4213.19004 3171.59148 4213.26783 3171.51654 4221.76254 3163.02183 4221.83748 3162.94404 4222.06082 3162.67448 4222.11682 3162.59555 4222.29749 3162.29572 4222.34111 3162.20931 4222.47507 3161.8859 4222.50532 3161.79397 4222.58959 3161.4542 4222.6058 3161.35878 4222.63848 3161.01026 4222.6405 3160.90226 4222.6405 3149.90974 4222.63848 3149.80168 4222.6058 3149.45322 4222.58957 3149.35774 4222.50532 3149.01804 4222.47505 3148.92604 4222.34111 3148.60269 4222.29746 3148.51623 4222.11683 3148.21646 4222.06078 3148.13747 4221.83748 3147.86796 4221.7625 3147.79013 4213.67059 3139.69852 4213.59284 3139.62362 4213.32324 3139.40025 4213.24435 3139.34428 4212.94446 3139.16358 4212.85812 3139.11999 4212.53465 3138.98601 4212.44277 3138.95578 4212.10295 3138.8715 4212.00759 3138.8553 4211.66147 3138.82285 4211.30344 3138.82059 4211.21589 3138.81033 4209.34873 3138.37879 4209.22059 3138.3243 4208.73029 3138.00515 4208.22628 3137.76243 4207.69536 3137.58615 4207.14626 3137.47922 4206.588 3137.44337 4206.02974 3137.47922 4205.48064 3137.58615 4204.94972 3137.76243 4204.44571 3138.00515 4203.97687 3138.31033 4203.55091 3138.67296 4203.17482 3139.08708 4202.85477 3139.54589 4202.59602 3140.04187 4202.40281 3140.56686 4202.27833 3141.11225 4202.22462 3141.66907 4202.24255 3142.2282 4202.33183 3142.78044 4202.491 3143.31673 4202.71744 3143.82827 4203.00743 3144.30665 4203.35622 3144.74401 4203.75808 3145.13319 4204.2064 3145.46778 4204.69383 3145.74229 4205.21236 3145.95222 4205.75347 3146.09412 4206.30829 3146.16566 4206.86771 3146.16566 4207.42253 3146.09412 4207.96364 3145.95222 4208.48217 3145.74229 4208.9696 3145.46778 4209.17564 3145.31401 4209.32483 3145.24484 4210.27795 3145.0246 4210.41208 3145.01677 4210.54124 3145.05378 4210.65085 3145.13148 4216.54634 3151.02675 4216.63305 3151.15652 4216.6635 3151.3096 4216.6635 3159.50244 4216.63305 3159.65551 4216.54634 3159.78528 4210.03128 3166.30034 4209.90151 3166.38705 4209.74844 3166.4175 4198.43979 3166.4175 4198.36948 3166.41127 4196.62591 3166.09992 4196.474 3166.03873 4196.11037 3165.79576 4195.62131 3165.55458 4195.10495 3165.3793 4194.57013 3165.27292 4194.026 3165.23726 4193.48187 3165.27292 4192.94705 3165.3793 4192.43069 3165.55458 4191.94163 3165.79576 4191.48823 3166.09871 4191.07825 3166.45825 4190.71871 3166.86823 4190.42159 3167.31291 4190.31123 3167.42327 4190.16704 3167.483 4190.01096 3167.483 4189.86677 3167.42327 4189.75641 3167.31291 4189.45929 3166.86823 4189.09975 3166.45825 4188.68977 3166.09871 4188.23637 3165.79576 4187.74731 3165.55458 4187.23095 3165.3793 4186.69613 3165.27292 4186.152 3165.23726 4185.60787 3165.27292 4185.07305 3165.3793 4184.55669 3165.55458 4184.06763 3165.79576 4183.61423 3166.09871 4183.20425 3166.45825 4182.84471 3166.86823 4182.54176 3167.32163 4182.30058 3167.81069 4182.1253 3168.32705 4182.01892 3168.86187 4181.98326 3169.406 4182.01892 3169.95013 4182.1253 3170.48495 4182.30058 3171.00131 4182.54176 3171.49037 4182.84471 3171.94377 4183.20425 3172.35375 4183.61423 3172.71329 4184.06763 3173.01624 4184.55669 3173.25742 4185.07305 3173.4327 4185.60787 3173.53908 4186.152 3173.57474 4186.69613 3173.53908 4187.23095 3173.4327 4187.74731 3173.25742 4188.23637 3173.01624 4188.68977 3172.71329 4189.09975 3172.35375 4189.45929 3171.94377 4189.75641 3171.49909 4189.86677 3171.38873 4190.01096 3171.329 4190.16704 3171.329 4190.31123 3171.38873 4190.42159 3171.49909 4190.71871 3171.94377 4191.07825 3172.35375 4191.48823 3172.71329 4191.94163 3173.01624 4192.43069 3173.25742 4192.94705 3173.4327 4193.48187 3173.53908 4194.026 3173.57474 Z M 4373.17012 3213.78902 L 4373.93236 3213.73366 4374.68571 3213.605 4375.42312 3213.40422 4376.13771 3213.13321 4376.8228 3212.7945 4377.47201 3212.39125 4378.07927 3211.92723 4378.63891 3211.40676 4379.1457 3210.83471 4379.59492 3210.21641 4379.98237 3209.55765 4380.30442 3208.86457 4380.55808 3208.14364 4380.74098 3207.40159 4380.85141 3206.64536 4380.88833 3205.882 4380.85141 3205.11864 4380.74098 3204.36241 4380.55808 3203.62036 4380.30442 3202.89943 4379.98237 3202.20635 4379.59492 3201.54759 4379.1457 3200.92929 4378.63891 3200.35724 4378.07927 3199.83677 4377.47201 3199.37275 4376.8228 3198.9695 4376.13771 3198.63079 4375.42312 3198.35978 4374.68571 3198.159 4373.93236 3198.03034 4373.17012 3197.97498 4372.40609 3197.99344 4371.64741 3198.08556 4370.90116 3198.25048 4370.17431 3198.48665 4369.47365 3198.79186 4368.80572 3199.16328 4368.17675 3199.59742 4367.59262 3200.09024 4367.05878 3200.63714 4366.58022 3201.23301 4366.1614 3201.87229 4365.80623 3202.549 4365.51803 3203.25683 4365.2995 3203.98917 4365.15267 3204.73919 4365.0789 3205.49987 4365.0789 3206.26413 4365.15267 3207.02481 4365.2995 3207.77483 4365.51803 3208.50717 4365.80623 3209.215 4366.1614 3209.89171 4366.58022 3210.53099 4367.05878 3211.12686 4367.59262 3211.67376 4368.17675 3212.16658 4368.80572 3212.60072 4369.47365 3212.97214 4370.17431 3213.27735 4370.90116 3213.51352 4371.64741 3213.67844 4372.40609 3213.77056 4373.17012 3213.78902 Z M 4193.69112 3099.40702 L 4194.45336 3099.35166 4195.20671 3099.223 4195.94412 3099.02222 4196.65871 3098.75121 4197.3438 3098.4125 4197.99301 3098.00925 4198.60027 3097.54523 4199.15991 3097.02476 4199.6667 3096.45271 4200.11592 3095.83441 4200.50337 3095.17565 4200.82542 3094.48257 4201.07908 3093.76164 4201.26198 3093.01959 4201.37241 3092.26336 4201.40933 3091.5 4201.37241 3090.73664 4201.26198 3089.98041 4201.07908 3089.23836 4200.82542 3088.51743 4200.50337 3087.82435 4200.11592 3087.16559 4199.6667 3086.54729 4199.15991 3085.97524 4198.60027 3085.45477 4197.99301 3084.99075 4197.3438 3084.5875 4196.65871 3084.24879 4195.94412 3083.97778 4195.20671 3083.777 4194.45336 3083.64834 4193.69112 3083.59298 4192.92709 3083.61144 4192.16841 3083.70356 4191.42216 3083.86848 4190.69531 3084.10465 4189.99465 3084.40986 4189.32672 3084.78128 4188.69775 3085.21542 4188.11362 3085.70824 4187.57978 3086.25514 4187.10122 3086.85101 4186.6824 3087.49029 4186.32723 3088.167 4186.03903 3088.87483 4185.8205 3089.60717 4185.67367 3090.35719 4185.5999 3091.11787 4185.5999 3091.88213 4185.67367 3092.64281 4185.8205 3093.39283 4186.03903 3094.12517 4186.32723 3094.833 4186.6824 3095.50971 4187.10122 3096.14899 4187.57978 3096.74486 4188.11362 3097.29176 4188.69775 3097.78458 4189.32672 3098.21872 4189.99465 3098.59014 4190.69531 3098.89535 4191.42216 3099.13152 4192.16841 3099.29644 4192.92709 3099.38856 4193.69112 3099.40702 Z M 4193.926 3199.63074 L 4194.47013 3199.59508 4195.00495 3199.4887 4195.52131 3199.31342 4196.01037 3199.07224 4196.46377 3198.76929 4196.87375 3198.40975 4197.23329 3197.99977 4197.53041 3197.55509 4197.64077 3197.44473 4197.78496 3197.385 4197.94104 3197.385 4198.08523 3197.44473 4198.19559 3197.55509 4198.49271 3197.99977 4198.85225 3198.40975 4199.26223 3198.76929 4199.71563 3199.07224 4200.20469 3199.31342 4200.72105 3199.4887 4201.25587 3199.59508 4201.8 3199.63074 4202.34413 3199.59508 4202.87895 3199.4887 4203.39531 3199.31342 4203.88437 3199.07224 4204.33777 3198.76929 4204.74775 3198.40975 4205.10729 3197.99977 4205.41024 3197.54637 4205.65142 3197.05731 4205.8267 3196.54095 4205.93308 3196.00613 4205.96874 3195.462 4205.93308 3194.91787 4205.8267 3194.38305 4205.65142 3193.86669 4205.41024 3193.37763 4205.10729 3192.92423 4204.74775 3192.51425 4204.33777 3192.15471 4203.88437 3191.85176 4203.39531 3191.61058 4202.87895 3191.4353 4202.34413 3191.32892 4201.8 3191.29326 4201.25587 3191.32892 4200.72105 3191.4353 4200.20469 3191.61058 4199.71563 3191.85176 4199.26223 3192.15471 4198.85225 3192.51425 4198.49271 3192.92423 4198.19559 3193.36891 4198.08523 3193.47927 4197.94104 3193.539 4197.78496 3193.539 4197.64077 3193.47927 4197.53041 3193.36891 4197.23329 3192.92423 4196.87375 3192.51425 4196.46377 3192.15471 4196.01037 3191.85176 4195.52131 3191.61058 4195.00495 3191.4353 4194.47013 3191.32892 4193.926 3191.29326 4193.38187 3191.32892 4192.84705 3191.4353 4192.33069 3191.61058 4191.84163 3191.85176 4191.38823 3192.15471 4190.97825 3192.51425 4190.61871 3192.92423 4190.31576 3193.37763 4190.07458 3193.86669 4189.8993 3194.38305 4189.79292 3194.91787 4189.75726 3195.462 4189.79292 3196.00613 4189.8993 3196.54095 4190.07458 3197.05731 4190.31576 3197.54637 4190.61871 3197.99977 4190.97825 3198.40975 4191.38823 3198.76929 4191.84163 3199.07224 4192.33069 3199.31342 4192.84705 3199.4887 4193.38187 3199.59508 4193.926 3199.63074 Z M 4197.666 3113.42874 L 4198.21013 3113.39308 4198.74495 3113.2867 4199.26131 3113.11142 4199.75037 3112.87024 4200.20377 3112.56729 4200.61375 3112.20775 4200.97329 3111.79777 4201.27624 3111.34437 4201.51742 3110.85531 4201.6927 3110.33895 4201.79908 3109.80413 4201.83474 3109.26 4201.79908 3108.71587 4201.6927 3108.18105 4201.51742 3107.66469 4201.27624 3107.17563 4200.97329 3106.72223 4200.61375 3106.31225 4200.20377 3105.95271 4199.75037 3105.64976 4199.26131 3105.40858 4198.74495 3105.2333 4198.21013 3105.12692 4197.666 3105.09126 4197.12187 3105.12692 4196.58705 3105.2333 4196.07069 3105.40858 4195.58163 3105.64976 4195.12823 3105.95271 4194.71825 3106.31225 4194.35871 3106.72223 4194.06159 3107.16691 4193.95123 3107.27727 4193.80704 3107.337 4193.65096 3107.337 4193.50677 3107.27727 4193.39641 3107.16691 4193.09929 3106.72223 4192.73975 3106.31225 4192.32977 3105.95271 4191.87637 3105.64976 4191.38731 3105.40858 4190.87095 3105.2333 4190.33613 3105.12692 4189.792 3105.09126 4189.24787 3105.12692 4188.71305 3105.2333 4188.19669 3105.40858 4187.70763 3105.64976 4187.25423 3105.95271 4186.84425 3106.31225 4186.48471 3106.72223 4186.18176 3107.17563 4185.94058 3107.66469 4185.7653 3108.18105 4185.65892 3108.71587 4185.62326 3109.26 4185.65892 3109.80413 4185.7653 3110.33895 4185.94058 3110.85531 4186.18176 3111.34437 4186.48471 3111.79777 4186.84425 3112.20775 4187.25423 3112.56729 4187.70763 3112.87024 4188.19669 3113.11142 4188.71305 3113.2867 4189.24787 3113.39308 4189.792 3113.42874 4190.33613 3113.39308 4190.87095 3113.2867 4191.38731 3113.11142 4191.87637 3112.87024 4192.32977 3112.56729 4192.73975 3112.20775 4193.09929 3111.79777 4193.39641 3111.35309 4193.50677 3111.24273 4193.65096 3111.183 4193.80704 3111.183 4193.95123 3111.24273 4194.06159 3111.35309 4194.35871 3111.79777 4194.71825 3112.20775 4195.12823 3112.56729 4195.58163 3112.87024 4196.07069 3113.11142 4196.58705 3113.2867 4197.12187 3113.39308 4197.666 3113.42874 Z M 4209.91199 3156.17545 L 4210.16086 3156.14741 4210.37591 3156.07216 4210.56883 3155.95094 4210.72994 3155.78983 4210.85116 3155.59691 4210.92641 3155.38186 4210.95445 3155.13299 4210.95445 3148.48501 4210.92641 3148.23614 4210.85116 3148.02109 4210.72994 3147.82817 4210.56883 3147.66706 4210.37591 3147.54584 4210.16086 3147.47059 4209.91199 3147.44255 4203.26401 3147.44255 4203.01514 3147.47059 4202.80009 3147.54584 4202.60717 3147.66706 4202.44606 3147.82817 4202.32484 3148.02109 4202.24959 3148.23614 4202.22155 3148.48501 4202.22155 3155.13299 4202.24959 3155.38186 4202.32484 3155.59691 4202.44606 3155.78983 4202.60717 3155.95094 4202.80009 3156.07216 4203.01514 3156.14741 4203.26401 3156.17545 4209.91199 3156.17545 Z M 4205.75347 3136.09412 L 4206.30829 3136.16566 4206.86771 3136.16566 4207.42253 3136.09412 4207.96364 3135.95222 4208.48217 3135.74229 4208.9696 3135.46778 4209.41792 3135.13319 4209.81978 3134.74401 4210.16857 3134.30665 4210.45856 3133.82827 4210.685 3133.31673 4210.84417 3132.78044 4210.93345 3132.2282 4210.95138 3131.66907 4210.89767 3131.11225 4210.77319 3130.56686 4210.57998 3130.04187 4210.32123 3129.54589 4210.00118 3129.08708 4209.62509 3128.67296 4209.19913 3128.31033 4208.73029 3128.00515 4208.22628 3127.76243 4207.69536 3127.58615 4207.14626 3127.47922 4206.588 3127.44337 4206.02974 3127.47922 4205.48064 3127.58615 4204.94972 3127.76243 4204.44571 3128.00515 4203.97687 3128.31033 4203.55091 3128.67296 4203.17482 3129.08708 4202.85477 3129.54589 4202.59602 3130.04187 4202.40281 3130.56686 4202.27833 3131.11225 4202.22462 3131.66907 4202.24255 3132.2282 4202.33183 3132.78044 4202.491 3133.31673 4202.71744 3133.82827 4203.00743 3134.30665 4203.35622 3134.74401 4203.75808 3135.13319 4204.2064 3135.46778 4204.69383 3135.74229 4205.21236 3135.95222 4205.75347 3136.09412 Z M 4196.86771 3136.16566 L 4197.42253 3136.09412 4197.96364 3135.95222 4198.48217 3135.74229 4198.9696 3135.46778 4199.41792 3135.13319 4199.81978 3134.74401 4200.16857 3134.30665 4200.45856 3133.82827 4200.685 3133.31673 4200.84417 3132.78044 4200.93345 3132.2282 4200.95138 3131.66907 4200.89767 3131.11225 4200.77319 3130.56686 4200.57998 3130.04187 4200.32123 3129.54589 4200.00118 3129.08708 4199.62509 3128.67296 4199.19913 3128.31033 4198.73029 3128.00515 4198.22628 3127.76243 4197.69536 3127.58615 4197.14626 3127.47922 4196.588 3127.44337 4196.02974 3127.47922 4195.48064 3127.58615 4194.94972 3127.76243 4194.44571 3128.00515 4193.97687 3128.31033 4193.55091 3128.67296 4193.17482 3129.08708 4192.85477 3129.54589 4192.59602 3130.04187 4192.40281 3130.56686 4192.27833 3131.11225 4192.22462 3131.66907 4192.24255 3132.2282 4192.33183 3132.78044 4192.491 3133.31673 4192.71744 3133.82827 4193.00743 3134.30665 4193.35622 3134.74401 4193.75808 3135.13319 4194.2064 3135.46778 4194.69383 3135.74229 4195.21236 3135.95222 4195.75347 3136.09412 4196.30829 3136.16566 4196.86771 3136.16566 Z M 4195.75347 3146.09412 L 4196.30829 3146.16566 4196.86771 3146.16566 4197.42253 3146.09412 4197.96364 3145.95222 4198.48217 3145.74229 4198.9696 3145.46778 4199.41792 3145.13319 4199.81978 3144.74401 4200.16857 3144.30665 4200.45856 3143.82827 4200.685 3143.31673 4200.84417 3142.78044 4200.93345 3142.2282 4200.95138 3141.66907 4200.89767 3141.11225 4200.77319 3140.56686 4200.57998 3140.04187 4200.32123 3139.54589 4200.00118 3139.08708 4199.62509 3138.67296 4199.19913 3138.31033 4198.73029 3138.00515 4198.22628 3137.76243 4197.69536 3137.58615 4197.14626 3137.47922 4196.588 3137.44337 4196.02974 3137.47922 4195.48064 3137.58615 4194.94972 3137.76243 4194.44571 3138.00515 4193.97687 3138.31033 4193.55091 3138.67296 4193.17482 3139.08708 4192.85477 3139.54589 4192.59602 3140.04187 4192.40281 3140.56686 4192.27833 3141.11225 4192.22462 3141.66907 4192.24255 3142.2282 4192.33183 3142.78044 4192.491 3143.31673 4192.71744 3143.82827 4193.00743 3144.30665 4193.35622 3144.74401 4193.75808 3145.13319 4194.2064 3145.46778 4194.69383 3145.74229 4195.21236 3145.95222 4195.75347 3146.09412 Z "}]},"pads":[],"nets":["GND","5V","24V/5VF","HEFGND","PCFGND","LEDIN"],"bom":{"both":[[1,"CONN-TH_B3B-PH-K-S","CONN-TH_B3B-PH-K-S",[["LED",0]],["JST","B3B-PH-K-S(LF)(SN)","LCSC","C131339"]],[2,"CONN-TH_B2B-PH-K-S","CONN-TH_B2B-PH-K-S",[["HEF",1],["PCF",2]],["JST","B2B-PH-K-S(LF)(SN)","LCSC","C131337"]],[1,"HDR-TH_6P-P2.54-V-F-R2-C3-S2.54","HDR-TH_6P-P2.54-V-F-R2-C3-S2.54",[["U10",3]],["CONNFLY","DS1023-2*3SF11","LCSC","C92272"]]],"F":[[1,"CONN-TH_B3B-PH-K-S","CONN-TH_B3B-PH-K-S",[["LED",0]],["JST","B3B-PH-K-S(LF)(SN)","LCSC","C131339"]],[2,"CONN-TH_B2B-PH-K-S","CONN-TH_B2B-PH-K-S",[["HEF",1],["PCF",2]],["JST","B2B-PH-K-S(LF)(SN)","LCSC","C131337"]],[1,"HDR-TH_6P-P2.54-V-F-R2-C3-S2.54","HDR-TH_6P-P2.54-V-F-R2-C3-S2.54",[["U10",3]],["CONNFLY","DS1023-2*3SF11","LCSC","C92272"]]],"B":[],"skipped":[],"customColumns":["BOM_Manufacturer","BOM_Manufacturer Part","BOM_Supplier","BOM_Supplier Part"]}};
///////////////////////////////////////////////

///////////////////////////////////////////////
/* Utility functions */

var storagePrefix = 'ibom__' + pcbdata.metadata.title + '__' +
  pcbdata.metadata.revision + '__#';

function buildKeyForLocalStorageDict() {  
  return storagePrefix;
}

var storage;
var _isLocalStorageUsed = false;

function initStorage(key) {
  try {
    window.localStorage.getItem("blank");
    storage = window.localStorage;    
    _isLocalStorageUsed = true;
  } catch (e) {
    // localStorage not available
  }
  if (!storage) {
    try {
      window.sessionStorage.getItem("blank");
      storage = window.sessionStorage;      
    } catch (e) {
      // sessionStorage also not available
    }
  }
}



function readStorage(key) {
  if(!storage) {
    return null;
  }

  if(!_isLocalStorageUsed) {    
    return storage.getItem(storagePrefix + key);
  }

  try {
    var dictKey = buildKeyForLocalStorageDict();
    var obj = JSON.parse(storage.getItem(dictKey));    
    if(!obj || !obj.hasOwnProperty(key)) {
      return null;
    }

    return JSON.parse(storage.getItem(dictKey))[key];
  } catch(e) {
    console.log('[ibom]: Unable to obtain a value from local storage!');
    console.log(e);
  }
  
  // Original implementation
  // return storage.getItem(storagePrefix + key);
}


function writeStorage(key, value) {
  if(!storage) {
    return;
  }

  if(!_isLocalStorageUsed) {
    storage.setItem(storagePrefix + key, value);
    return;
  }

  try {
    var dictKey = buildKeyForLocalStorageDict();
    if(!storage.getItem(dictKey)) {
      storage.setItem(dictKey,JSON.stringify({
        _storagePrefix: storagePrefix
      }));
    }

    var obj = JSON.parse(storage.getItem(dictKey));
    obj[key] = value;
    storage.setItem(dictKey,JSON.stringify(obj));            
  } catch(e) {
    console.log('[ibom]: Unable to write key to local storage!');
    console.log(e);
  }
  
  // Original implementation
  // storage.setItem(storagePrefix + key, value);
}

function fancyDblClickHandler(el, onsingle, ondouble) {
  return function() {
    if (el.getAttribute("data-dblclick") == null) {
      el.setAttribute("data-dblclick", 1);
      setTimeout(function() {
        if (el.getAttribute("data-dblclick") == 1) {
          onsingle();
        }
        el.removeAttribute("data-dblclick");
      }, 200);
    } else {
      el.removeAttribute("data-dblclick");
      ondouble();
    }
  }
}

function smoothScrollToRow(rowid) {
  document.getElementById(rowid).scrollIntoView({
    behavior: "smooth",
    block: "center",
    inline: "nearest"
  });
}

function focusInputField(input) {
  input.scrollIntoView(false);
  input.focus();
  input.select();
}

function copyToClipboard() {
  var text = '';
  for (var node of bomhead.childNodes[0].childNodes) {
    if (node.firstChild) {
      text = text + node.firstChild.nodeValue;
    }
    if (node != bomhead.childNodes[0].lastChild) {
      text += '\t';
    }
  }
  text += '\n';
  for (var row of bombody.childNodes) {
    for (var cell of row.childNodes) {
      for (var node of cell.childNodes) {
        if (node.nodeName == "INPUT") {
          if (node.checked) {
            text = text + '';
          }
        } else if (node.nodeName == "MARK") {
          text = text + node.firstChild.nodeValue;
        } else {
          text = text + node.nodeValue;
        }
      }
      if (cell != row.lastChild) {
        text += '\t';
      }
    }
    text += '\n';
  }
  var textArea = document.createElement("textarea");
  textArea.classList.add('clipboard-temp');
  textArea.value = text;

  document.body.appendChild(textArea);
  textArea.focus();
  textArea.select();

  try {
    if (document.execCommand('copy')) {
      console.log('Bom copied to clipboard.');
    }
  } catch (err) {
    console.log('Can not copy to clipboard.');
  }

  document.body.removeChild(textArea);
}

function removeGutterNode(node) {
  for (var i = 0; i < node.childNodes.length; i++) {
    if (node.childNodes[i].classList &&
      node.childNodes[i].classList.contains("gutter")) {
      node.removeChild(node.childNodes[i]);
      break;
    }
  }
}

function cleanGutters() {
  removeGutterNode(document.getElementById("bot"));
  removeGutterNode(document.getElementById("canvasdiv"));
}

var units = {
  prefixes: {
    giga: ["G", "g", "giga", "Giga", "GIGA"],
    mega: ["M", "mega", "Mega", "MEGA"],
    kilo: ["K", "k", "kilo", "Kilo", "KILO"],
    milli: ["m", "milli", "Milli", "MILLI"],
    micro: ["U", "u", "micro", "Micro", "MICRO", "", ""], // different utf8 
    nano: ["N", "n", "nano", "Nano", "NANO"],
    pico: ["P", "p", "pico", "Pico", "PICO"],
  },
  unitsShort: ["R", "r", "", "F", "f", "H", "h"],
  unitsLong: [
    "OHM", "Ohm", "ohm", "ohms",
    "FARAD", "Farad", "farad",
    "HENRY", "Henry", "henry"
  ],
  getMultiplier: function(s) {
    if (this.prefixes.giga.includes(s)) return 1e9;
    if (this.prefixes.mega.includes(s)) return 1e6;
    if (this.prefixes.kilo.includes(s)) return 1e3;
    if (this.prefixes.milli.includes(s)) return 1e-3;
    if (this.prefixes.micro.includes(s)) return 1e-6;
    if (this.prefixes.nano.includes(s)) return 1e-9;
    if (this.prefixes.pico.includes(s)) return 1e-12;
    return 1;
  },
  valueRegex: null,
}

function initUtils() {
  var allPrefixes = units.prefixes.giga
                    .concat(units.prefixes.mega)
                    .concat(units.prefixes.kilo)
                    .concat(units.prefixes.milli)
                    .concat(units.prefixes.micro)
                    .concat(units.prefixes.nano)
                    .concat(units.prefixes.pico);
  var allUnits = units.unitsShort.concat(units.unitsLong);
  units.valueRegex = new RegExp("^([0-9\.]+)" +
                         "\\s*(" + allPrefixes.join("|") + ")?" +
                         "(" + allUnits.join("|") + ")?" +
                         "(\\b.*)?$", "");
  units.valueAltRegex = new RegExp("^([0-9]*)" +
                         "(" + units.unitsShort.join("|") + ")?" +
                         "([GgMmKkUuNnPp])?" +
                         "([0-9]*)" +
                         "(\\b.*)?$", "");
  for (var bom_type of ["both", "F", "B"]) {
    for (var row of pcbdata.bom[bom_type]) {
      row.push(parseValue(row[1], row[3][0][0]));
    }
  }
}

function parseValue(val, ref) {
  var inferUnit = (unit, ref) => {
    if (unit) {
      unit = unit.toLowerCase();
      if (unit == '' || unit == "ohm" || unit == "ohms") {
        unit = 'r';
      }
      unit = unit[0];
    } else {
      ref = /^([a-z]+)\d+$/i.exec(ref);
      if (ref) {
        ref = ref[1].toLowerCase();
        if (ref == "c") unit = 'f';
        else if (ref == "l") unit = 'h';
        else if (ref == "r" || ref == "rv") unit = 'r';
        else unit = null;
      }
    }
    return unit;
  };
  val = val.replace(/,/g, "");
  var match = units.valueRegex.exec(val);
  var unit;
  if (match) {
    val = parseFloat(match[1]);
    if (match[2]) {
      val = val * units.getMultiplier(match[2]);
    }
    unit = inferUnit(match[3], ref);
    if (!unit) return null;
    else return {
      val: val,
      unit: unit,
      extra: match[4],
    }
  }
  match = units.valueAltRegex.exec(val);
  if (match && (match[1] || match[4])) {
    val = parseFloat(match[1] + "." + match[4]);
    if (match[3]) {
      val = val * units.getMultiplier(match[3]);
    }
    unit = inferUnit(match[2], ref);
    if (!unit) return null;
    else return {
      val: val,
      unit: unit,
      extra: match[5],
    }
  }
  return null;
}

function valueCompare(a, b, stra, strb) {
  if (a === null && b === null) {
    // Failed to parse both values, compare them as strings.
    if (stra != strb) return stra > strb ? 1 : -1;
    else return 0;
  } else if (a === null) {
    return 1;
  } else if (b === null) {
    return -1;
  } else {
    if (a.unit != b.unit) return a.unit > b.unit ? 1 : -1;
    else if (a.val != b.val) return a.val > b.val ? 1 : -1;
    else if (a.extra != b.extra) return a.extra > b.extra ? 1 : -1;
    else return 0;
  }
}

function validateSaveImgDimension(element) {
  var valid = false;
  var intValue = 0;
  if (/^[1-9]\d*$/.test(element.value)) {
    intValue = parseInt(element.value);
    if (intValue <= 16000) {
      valid = true;
    }
  }
  if (valid) {
    element.classList.remove("invalid");
  } else {
    element.classList.add("invalid");
  }
  return intValue;
}

function saveImage(layer) {
  var width = validateSaveImgDimension(document.getElementById("render-save-width"));
  var height = validateSaveImgDimension(document.getElementById("render-save-height"));
  var bgcolor = null;
  if (!document.getElementById("render-save-transparent").checked) {
    var style = getComputedStyle(topmostdiv);
    bgcolor = style.getPropertyValue("background-color");
  }
  if (!width || !height) return;

  // Prepare image
  var canvas = document.createElement("canvas");
  var layerdict = {
    transform: {
      x: 0,
      y: 0,
      s: 1,
      panx: 0,
      pany: 0,
      zoom: 1,
    },
    bg: canvas,
    fab: canvas,
    silk: canvas,
    highlight: canvas,
    layer: layer,
  }
  // Do the rendering
  recalcLayerScale(layerdict, width, height);
  prepareLayer(layerdict);
  clearCanvas(canvas, bgcolor);
  drawBackground(layerdict, false);
  drawHighlightsOnLayer(layerdict, false);

  // Save image
  var imgdata = canvas.toDataURL("image/png");

  var filename = pcbdata.metadata.title;
  if (pcbdata.metadata.revision) {
    filename += `.${pcbdata.metadata.revision}`;
  }
  filename += `.${layer}.png`;
  saveFile(filename, dataURLtoBlob(imgdata));
}

function saveSettings() {
  var data = {
    type: "InteractiveHtmlBom settings",
    version: 1,
    pcbmetadata: pcbdata.metadata,
    settings: settings,
  }
  var blob = new Blob([JSON.stringify(data, null, 4)], {type: "application/json"});
  saveFile(`${pcbdata.metadata.title}.settings.json`, blob);
}

function loadSettings() {
  var input = document.createElement("input");
  input.type = "file";
  input.accept = ".settings.json";
  input.onchange = function(e) {
    var file = e.target.files[0];
    var reader = new FileReader();
    reader.onload = readerEvent => {
      var content = readerEvent.target.result;
      var newSettings;
      try {
        newSettings = JSON.parse(content);
      } catch(e) {
        alert("Selected file is not InteractiveHtmlBom settings file.");
        return;
      }
      if (newSettings.type != "InteractiveHtmlBom settings") {
        alert("Selected file is not InteractiveHtmlBom settings file.");
        return;
      }
      var metadataMatches = newSettings.hasOwnProperty("pcbmetadata");
      if (metadataMatches) {
        for (var k in pcbdata.metadata) {
          if (!newSettings.pcbmetadata.hasOwnProperty(k) || newSettings.pcbmetadata[k] != pcbdata.metadata[k]) {
            metadataMatches = false;
          }
        }
      }
      if (!metadataMatches) {
        var currentMetadata = JSON.stringify(pcbdata.metadata, null, 4);
        var fileMetadata = JSON.stringify(newSettings.pcbmetadata, null, 4);
        if (!confirm(
          `Settins file metadata does not match current metadata.\n\n` +
          `Page metadata:\n${currentMetadata}\n\n` +
          `Settings file metadata:\n${fileMetadata}\n\n` +
          `Press OK if you would like to import settings anyway.`)) {
          return;
        }
      }
      overwriteSettings(newSettings.settings);
    }
    reader.readAsText(file, 'UTF-8');
  }
  input.click();
}

function overwriteSettings(newSettings) {

  initDone = false;
  Object.assign(settings, newSettings);
  writeStorage("bomlayout", settings.bomlayout);
  writeStorage("bommode", settings.bommode);
  writeStorage("canvaslayout", settings.canvaslayout);
  writeStorage("bomCheckboxes", settings.checkboxes.join(","));
  document.getElementById("bomCheckboxes").value = settings.checkboxes.join(",");
  for (var checkbox of settings.checkboxes) {
    writeStorage("checkbox_" + checkbox, settings.checkboxStoredRefs[checkbox]);
  }
  writeStorage("darkenWhenChecked", settings.darkenWhenChecked);
  padsVisible(settings.renderPads);
  document.getElementById("padsCheckbox").checked = settings.renderPads;
  fabricationVisible(settings.renderFabrication);
  document.getElementById("fabricationCheckbox").checked = settings.renderFabrication;
  silkscreenVisible(settings.renderSilkscreen);
  document.getElementById("silkscreenCheckbox").checked = settings.renderSilkscreen;
  referencesVisible(settings.renderReferences);
  document.getElementById("referencesCheckbox").checked = settings.renderReferences;
  valuesVisible(settings.renderValues);
  document.getElementById("valuesCheckbox").checked = settings.renderValues;
  tracksVisible(settings.renderTracks);
  document.getElementById("tracksCheckbox").checked = settings.renderTracks;
  zonesVisible(settings.renderZones);
  document.getElementById("zonesCheckbox").checked = settings.renderZones;
  dnpOutline(settings.renderDnpOutline);
  document.getElementById("dnpOutlineCheckbox").checked = settings.renderDnpOutline;
  setRedrawOnDrag(settings.redrawOnDrag);
  document.getElementById("dragCheckbox").checked = settings.redrawOnDrag;
  setShowCrosshair(settings.showCrosshair);
  document.getElementById("crosshairCheckbox").checked = settings.showCrosshair;
  setDarkMode(settings.darkMode);
  document.getElementById("darkmodeCheckbox").checked = settings.darkMode;
  setHighlightPin1(settings.highlightpin1);
  document.getElementById("highlightpin1Checkbox").checked = settings.highlightpin1;
  writeStorage("boardRotation", settings.boardRotation);
  document.getElementById("boardRotation").value = settings.boardRotation / 5;
  document.getElementById("rotationDegree").textContent = settings.boardRotation;
  initDone = true;
  prepCheckboxes();
  changeBomLayout(settings.bomlayout);
}

function saveFile(filename, blob) {
  var link = document.createElement("a");
  var objurl = URL.createObjectURL(blob);
  link.download = filename;
  link.href = objurl;
  link.click();
}

function dataURLtoBlob(dataurl) {
  var arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],
      bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
  while(n--){
      u8arr[n] = bstr.charCodeAt(n);
  }
  return new Blob([u8arr], {type:mime});
}

var settings = {
  canvaslayout: "default",
  bomlayout: "default",
  bommode: "grouped",
  checkboxes: [],
  checkboxStoredRefs: {},
  darkMode: false,
  highlightpin1: false,
  redrawOnDrag: true,
  boardRotation: 0,
  renderPads: true,
  renderReferences: true,
  renderValues: true,
  renderSilkscreen: true,
  renderFabrication: true,
  renderDnpOutline: false,
  renderTracks: true,
  renderZones: true,
}

function initDefaults() {
  settings.bomlayout = readStorage("bomlayout");
  if (settings.bomlayout === null) {
    settings.bomlayout = config.bom_view;
  }
  if (!['bom-only', 'left-right', 'top-bottom'].includes(settings.bomlayout)) {
    settings.bomlayout = config.bom_view;
  }
  settings.bommode = readStorage("bommode");
  if (settings.bommode === null) {
    settings.bommode = "grouped";
  }
  if (!["grouped", "ungrouped", "netlist"].includes(settings.bommode)) {
    settings.bommode = "grouped";
  }
  settings.canvaslayout = readStorage("canvaslayout");
  if (settings.canvaslayout === null) {
    settings.canvaslayout = config.layer_view;
  }
  var bomCheckboxes = readStorage("bomCheckboxes");
  if (bomCheckboxes === null) {
    bomCheckboxes = config.checkboxes;
  }
  settings.checkboxes = bomCheckboxes.split(",").filter((e) => e);
  document.getElementById("bomCheckboxes").value = bomCheckboxes;

  settings.darkenWhenChecked = readStorage("darkenWhenChecked") || "";
  populateDarkenWhenCheckedOptions();

  function initBooleanSetting(storageString, def, elementId, func) {    
    var b = readStorage(storageString);
    if (b === null) {
      b = def;
    } else {
      b = (b === true);
    }
    document.getElementById(elementId).checked = b;
    func(b);
  }

  initBooleanSetting("padsVisible", config.show_pads, "padsCheckbox", padsVisible);
  initBooleanSetting("fabricationVisible", config.show_fabrication, "fabricationCheckbox", fabricationVisible);
  initBooleanSetting("silkscreenVisible", config.show_silkscreen, "silkscreenCheckbox", silkscreenVisible);
  initBooleanSetting("referencesVisible", true, "referencesCheckbox", referencesVisible);
  initBooleanSetting("valuesVisible", false, "valuesCheckbox", valuesVisible);
  if ("tracks" in pcbdata) {
    initBooleanSetting("tracksVisible", true, "tracksCheckbox", tracksVisible);
    initBooleanSetting("zonesVisible", true, "zonesCheckbox", zonesVisible);
  } else {
    document.getElementById("tracksAndZonesCheckboxes").style.display = "none";
    tracksVisible(false);
    zonesVisible(false);
  }
  initBooleanSetting("dnpOutline", false, "dnpOutlineCheckbox", dnpOutline);
  initBooleanSetting("redrawOnDrag", config.redraw_on_drag, "dragCheckbox", setRedrawOnDrag);
  initBooleanSetting("showCrosshair", config.show_crosshair, "crosshairCheckbox", setShowCrosshair);
  initBooleanSetting("darkmode", config.dark_mode, "darkmodeCheckbox", setDarkMode);
  initBooleanSetting("highlightpin1", config.highlight_pin1, "highlightpin1Checkbox", setHighlightPin1);
  settings.boardRotation = readStorage("boardRotation");
  if (settings.boardRotation === null) {
    settings.boardRotation = config.board_rotation * 5;
  } else {
    settings.boardRotation = parseInt(settings.boardRotation);
  }
  document.getElementById("boardRotation").value = settings.boardRotation / 5;
  document.getElementById("rotationDegree").textContent = settings.boardRotation;
}

// Helper classes for user js callbacks.

const IBOM_EVENT_TYPES = {
  ALL: "all",
  HIGHLIGHT_EVENT: "highlightEvent",
  CHECKBOX_CHANGE_EVENT: "checkboxChangeEvent",
  BOM_BODY_CHANGE_EVENT: "bomBodyChangeEvent",
}

const EventHandler = {
  callbacks: {},
  init: function() {
    for (eventType of Object.values(IBOM_EVENT_TYPES))
      this.callbacks[eventType] = [];
  },
  registerCallback: function(eventType, callback) {
    this.callbacks[eventType].push(callback);
  },
  emitEvent: function(eventType, eventArgs) {
    event = {
      eventType: eventType,
      args: eventArgs,
    }
    var callback;
    for(callback of this.callbacks[eventType])
      callback(event);
    for(callback of this.callbacks[IBOM_EVENT_TYPES.ALL])
      callback(event);
  }
}
EventHandler.init();

///////////////////////////////////////////////

///////////////////////////////////////////////
/* PCB rendering code */

var emptyContext2d = document.createElement("canvas").getContext("2d");
var hitTestContext2d = document.createElement("canvas").getContext("2d");

function deg2rad(deg) {
  return deg * Math.PI / 180;
}

function calcFontPoint(linepoint, text, offsetx, offsety, tilt) {
  var point = [
    linepoint[0] * text.width + offsetx,
    linepoint[1] * text.height + offsety
  ];
  // This approximates pcbnew behavior with how text tilts depending on horizontal justification
  point[0] -= (linepoint[1] + 0.5 * (1 + text.justify[0])) * text.height * tilt;
  return point;
}

function drawText(ctx, text, color) {
  if ("ref" in text && !settings.renderReferences) return;
  if ("val" in text && !settings.renderValues) return;
  ctx.save();
  ctx.fillStyle = color;
  ctx.strokeStyle = color;
  ctx.lineCap = "round";
  ctx.lineJoin = "round";
  ctx.lineWidth = text.thickness;

  if ("svgpath" in text) {    
    // TODO: This path must be cached!
    const path = new Path2D(text.svgpath);
    if(text.useTrueTypeFontRendering) {            
      ctx.fill(path);
    } else {
      ctx.stroke(path);
    }
    
    ctx.restore();
    return;
  }

  ctx.translate(...text.pos);
  ctx.translate(text.thickness * 0.5, 0);
  var angle = -text.angle;
  if (text.attr.includes("mirrored")) {
    ctx.scale(-1, 1);
    angle = -angle;
  }
  var tilt = 0;
  if (text.attr.includes("italic")) {
    tilt = 0.125;
  }
  var interline = text.height * 1.5 + text.thickness;
  var txt = text.text.split("\n");
  // KiCad ignores last empty line.
  if (txt[txt.length - 1] == '') txt.pop();
  ctx.rotate(deg2rad(angle));
  var offsety = (1 - text.justify[1]) / 2 * text.height; // One line offset
  offsety -= (txt.length - 1) * (text.justify[1] + 1) / 2 * interline; // Multiline offset
  for (var i in txt) {
    var lineWidth = text.thickness + interline / 2 * tilt;
    for (var j = 0; j < txt[i].length; j++) {
      if (txt[i][j] == '\t') {
        var fourSpaces = 4 * pcbdata.font_data[' '].w * text.width;
        lineWidth += fourSpaces - lineWidth % fourSpaces;
      } else {
        if (txt[i][j] == '~') {
          j++;
          if (j == txt[i].length)
            break;
        }
        lineWidth += pcbdata.font_data[txt[i][j]].w * text.width;
      }
    }
    var offsetx = -lineWidth * (text.justify[0] + 1) / 2;
    var inOverbar = false;
    for (var j = 0; j < txt[i].length; j++) {
      if (txt[i][j] == '\t') {
        var fourSpaces = 4 * pcbdata.font_data[' '].w * text.width;
        offsetx += fourSpaces - offsetx % fourSpaces;
        continue;
      } else if (txt[i][j] == '~') {
        j++;
        if (j == txt[i].length)
          break;
        if (txt[i][j] != '~') {
          inOverbar = !inOverbar;
        }
      }
      var glyph = pcbdata.font_data[txt[i][j]];
      if (inOverbar) {
        var overbarStart = [offsetx, -text.height * 1.4 + offsety];
        var overbarEnd = [offsetx + text.width * glyph.w, overbarStart[1]];

        if (!lastHadOverbar) {
          overbarStart[0] += text.height * 1.4 * tilt;
          lastHadOverbar = true;
        }
        ctx.beginPath();
        ctx.moveTo(...overbarStart);
        ctx.lineTo(...overbarEnd);
        ctx.stroke();
      } else {
        lastHadOverbar = false;
      }
      for (var line of glyph.l) {
        ctx.beginPath();
        ctx.moveTo(...calcFontPoint(line[0], text, offsetx, offsety, tilt));
        for (var k = 1; k < line.length; k++) {
          ctx.lineTo(...calcFontPoint(line[k], text, offsetx, offsety, tilt));
        }
        ctx.stroke();
      }
      offsetx += glyph.w * text.width;
    }
    offsety += interline;
  }
  ctx.restore();
}

function drawedge(ctx, scalefactor, edge, color) {
  ctx.strokeStyle = color;
  ctx.lineWidth = Math.max(1 / scalefactor, edge.width);
  ctx.lineCap = "round";
  if ("svgpath" in edge) {
    ctx.stroke(new Path2D(edge.svgpath));
  } else {
    ctx.beginPath();
    if (edge.type == "segment") {
      ctx.moveTo(...edge.start);
      ctx.lineTo(...edge.end);
    }
    if (edge.type == "rect") {
      ctx.moveTo(...edge.start);
      ctx.lineTo(edge.start[0], edge.end[1]);
      ctx.lineTo(...edge.end);
      ctx.lineTo(edge.end[0], edge.start[1]);
      ctx.lineTo(...edge.start);
    }
    if (edge.type == "arc") {
      ctx.arc(
        ...edge.start,
        edge.radius,
        deg2rad(edge.startangle),
        deg2rad(edge.endangle));
    }
    if (edge.type == "circle") {
      ctx.arc(
        ...edge.start,
        edge.radius,
        0, 2 * Math.PI);
      ctx.closePath();
    }
    if (edge.type == "curve") {
      ctx.moveTo(...edge.start);
      ctx.bezierCurveTo(...edge.cpa, ...edge.cpb, ...edge.end);
    }
    ctx.stroke();
  }
}

function getChamferedRectPath(size, radius, chamfpos, chamfratio) {
  // chamfpos is a bitmask, left = 1, right = 2, bottom left = 4, bottom right = 8
  var path = new Path2D();
  var width = size[0];
  var height = size[1];
  var x = width * -0.5;
  var y = height * -0.5;
  var chamfOffset = Math.min(width, height) * chamfratio;
  path.moveTo(x, 0);
  if (chamfpos & 4) {
    path.lineTo(x, y + height - chamfOffset);
    path.lineTo(x + chamfOffset, y + height);
    path.lineTo(0, y + height);
  } else {
    path.arcTo(x, y + height, x + width, y + height, radius);
  }
  if (chamfpos & 8) {
    path.lineTo(x + width - chamfOffset, y + height);
    path.lineTo(x + width, y + height - chamfOffset);
    path.lineTo(x + width, 0);
  } else {
    path.arcTo(x + width, y + height, x + width, y, radius);
  }
  if (chamfpos & 2) {
    path.lineTo(x + width, y + chamfOffset);
    path.lineTo(x + width - chamfOffset, y);
    path.lineTo(0, y);
  } else {
    path.arcTo(x + width, y, x, y, radius);
  }
  if (chamfpos & 1) {
    path.lineTo(x + chamfOffset, y);
    path.lineTo(x, y + chamfOffset);
    path.lineTo(x, 0);
  } else {
    path.arcTo(x, y, x, y + height, radius);
  }
  path.closePath();
  return path;
}

function getOblongPath(size) {
  return getChamferedRectPath(size, Math.min(size[0], size[1]) / 2, 0, 0);
}

function getPolygonsPath(shape) {
  if (shape.path2d) {
    return shape.path2d;
  }
  if ("svgpath" in shape) {
    shape.path2d = new Path2D(shape.svgpath);
  } else {
    var path = new Path2D();
    for (var polygon of shape.polygons) {
      path.moveTo(...polygon[0]);
      for (var i = 1; i < polygon.length; i++) {
        path.lineTo(...polygon[i]);
      }
      path.closePath();
    }
    shape.path2d = path;
  }
  return shape.path2d;
}

function drawPolygonShape(ctx, shape, color) {
  ctx.save();
  ctx.fillStyle = color;
  if (!("svgpath" in shape)) {
    ctx.translate(...shape.pos);
    ctx.rotate(deg2rad(-shape.angle));
  }
  ctx.fill(getPolygonsPath(shape));
  ctx.restore();
}


function drawPolylineShape(ctx, shape, color) {
  ctx.save();
  ctx.strokeStyle = color;
  ctx.lineWidth = shape.width;
  if (!("svgpath" in shape)) {
    ctx.translate(...shape.pos);
    ctx.rotate(deg2rad(-shape.angle));
  }
  ctx.stroke(getPolygonsPath(shape));
  ctx.restore();
}

function drawDrawing(ctx, scalefactor, drawing, color) {  
  if (["segment", "arc", "circle", "curve"].includes(drawing.type)) {
    drawedge(ctx, scalefactor, drawing, color);
  } else if (drawing.type == "polygon") {
    drawPolygonShape(ctx, drawing, color);
  } else if (drawing.type == "text") {    
    drawText(ctx, drawing, color);
  } else if (drawing.type == "polyline") {    
    drawPolylineShape(ctx, drawing, color);
  }
}

function getCirclePath(radius) {
  var path = new Path2D();
  path.arc(0, 0, radius, 0, 2 * Math.PI);
  path.closePath();
  return path;
}

function getCachedPadPath(pad) {
  if (!pad.path2d) {
    // if path2d is not set, build one and cache it on pad object
    if (pad.shape == "rect") {
      pad.path2d = new Path2D();
      pad.path2d.rect(...pad.size.map(c => -c * 0.5), ...pad.size);
    } else if (pad.shape == "oval") {
      pad.path2d = getOblongPath(pad.size);
    } else if (pad.shape == "circle") {
      pad.path2d = getCirclePath(pad.size[0] / 2);
    } else if (pad.shape == "roundrect") {
      pad.path2d = getChamferedRectPath(pad.size, pad.radius, 0, 0);
    } else if (pad.shape == "chamfrect") {
      pad.path2d = getChamferedRectPath(pad.size, pad.radius, pad.chamfpos, pad.chamfratio)
    } else if (pad.shape == "custom") {
      pad.path2d = getPolygonsPath(pad);
    } else if(pad.shape === "polygon") {      
      pad.path2d = new Path2D();
      if(pad.polygon.length > 1) {
        const pos = {
          x: pad.pos[0],
          y: pad.pos[1]
        };

        pad.path2d.moveTo(pad.polygon[0].x - pos.x, pad.polygon[0].y - pos.y);
        for (var i = 1; i < pad.polygon.length; i++) {
          const point = pad.polygon[i];          
          pad.path2d.lineTo(point.x - pos.x, point.y - pos.y);
        }
        pad.path2d.closePath();              
      }
    }
  }
  return pad.path2d;
}

function drawPad(ctx, pad, color, outline) {
  ctx.save();
  ctx.translate(...pad.pos);
  if(pad.shape !== 'polygon') {
    ctx.rotate(deg2rad(pad.angle));  
  } else {
    ctx.rotate(deg2rad(0));  
  }
  
  if (pad.offset) {
    ctx.translate(...pad.offset);
  }
  ctx.fillStyle = color;
  ctx.strokeStyle = color;
  var path = getCachedPadPath(pad);
  if (outline) {
    ctx.stroke(path);
  } else {
    ctx.fill(path);
  }
  ctx.restore();
}

function drawPadHole(ctx, pad, padHoleColor) {
  if (pad.type != "th") {
    return
  };

  ctx.save();
  ctx.translate(pad.holeCenterPoint.x, pad.holeCenterPoint.y);    
  ctx.rotate(deg2rad(pad.angle));
  ctx.fillStyle = padHoleColor;
  if (pad.drillshape == "oblong") {
    ctx.fill(getOblongPath(pad.drillsize));
  } else {
    ctx.fill(getCirclePath(pad.drillsize[0] / 2));
  }
  ctx.restore();
}

function drawFootprint(ctx, layer, scalefactor, footprint, padColor, padHoleColor, outlineColor, highlight, outline) {
  if (highlight) {
    // draw bounding box
    if (footprint.layer == layer) {
      ctx.save();
      ctx.globalAlpha = 0.2;
      ctx.translate(...footprint.bbox.pos);
      ctx.rotate(deg2rad(-footprint.bbox.angle));
      ctx.translate(...footprint.bbox.relpos);
      ctx.fillStyle = padColor;
      ctx.fillRect(0, 0, ...footprint.bbox.size);
      ctx.globalAlpha = 1;
      ctx.strokeStyle = padColor;
      ctx.strokeRect(0, 0, ...footprint.bbox.size);
      ctx.restore();
    }
  }
  // draw drawings
  for (var drawing of footprint.drawings) {
    if (drawing.layer == layer) {
      drawDrawing(ctx, scalefactor, drawing.drawing, padColor);
    }
  }
  // draw pads
  if (settings.renderPads) {
    for (var pad of footprint.pads) {
      if (pad.layers.includes(layer)) {
        drawPad(ctx, pad, padColor, outline);
        if (pad.pin1 && settings.highlightpin1) {
          drawPad(ctx, pad, outlineColor, true);
        }
      }
    }
    for (var pad of footprint.pads) {
      drawPadHole(ctx, pad, padHoleColor);
    }
  }
}

function drawCrosshair(canvas, x, y, scalefactor, color) {
  if(!settings.showCrosshair) {
    return;
  }

  var ctx = canvas.getContext("2d");

  HTMLFormControlsCollection.log
  
  ctx.save();
  ctx.globalAlpha = 0.75;
  ctx.lineWidth = 2 / scalefactor;
  ctx.strokeStyle = color;

  // TODO: Should calculate a proper bbox for the view port.
  const dummyOffset = 4000;

  // horz line
  ctx.beginPath();
  ctx.moveTo(x - dummyOffset, y);
  ctx.lineTo(x + dummyOffset, y);
  ctx.stroke();

  // vert line
  ctx.beginPath();
  ctx.moveTo(x, y - dummyOffset);
  ctx.lineTo(x, y + dummyOffset);
  ctx.stroke();

  ctx.globalAlpha = 1;
  ctx.restore();
}

function drawEdgeCuts(canvas, scalefactor) {
  var ctx = canvas.getContext("2d");
  var edgecolor = getComputedStyle(topmostdiv).getPropertyValue('--pcb-edge-color');
  for (var edge of pcbdata.edges) {
    drawedge(ctx, scalefactor, edge, edgecolor);
  }
}

function drawOrphanPads(canvas, layer, scalefactor, highlight, highlightedPads) {
  if (!settings.renderPads) {
    return;
  }

  highlightedPads = highlightedPads || [];

  var ctx = canvas.getContext("2d");
  ctx.save();
  ctx.lineWidth = 3 / scalefactor;
  var style = getComputedStyle(topmostdiv);
  var padColor = style.getPropertyValue('--pad-color');
  var padHoleColor = style.getPropertyValue('--pad-hole-color');  
  if (highlight) {
    padColor = style.getPropertyValue('--pad-color-highlight');
    outlineColor = style.getPropertyValue('--pin1-outline-color-highlight');
  }

  var i = 0;
  for (var pad of pcbdata.pads) {
    if (pad.layers.includes(layer)) {
      var outline = settings.renderDnpOutline;
      if (!highlight || highlightedPads.includes(i)) {
        drawPad(ctx, pad, padColor, outline); 
      }     
    }

    i++;
  }
  
  for (var pad of pcbdata.pads) {
    drawPadHole(ctx, pad, padHoleColor);
  }  

  ctx.restore();
}

function drawFootprints(canvas, layer, scalefactor, highlight) {
  var ctx = canvas.getContext("2d");
  ctx.save();
  ctx.lineWidth = 3 / scalefactor;
  var style = getComputedStyle(topmostdiv);
  var padColor = style.getPropertyValue('--pad-color');
  var padHoleColor = style.getPropertyValue('--pad-hole-color');
  var outlineColor = style.getPropertyValue('--pin1-outline-color');
  if (highlight) {
    padColor = style.getPropertyValue('--pad-color-highlight');
    outlineColor = style.getPropertyValue('--pin1-outline-color-highlight');
  }
  for (var i = 0; i < pcbdata.footprints.length; i++) {
    var mod = pcbdata.footprints[i];
    var outline = settings.renderDnpOutline && pcbdata.bom.skipped.includes(i);
    if (!highlight || highlightedFootprints.includes(i)) {
      drawFootprint(ctx, layer, scalefactor, mod, padColor, padHoleColor, outlineColor, highlight, outline);
    }
  }
  ctx.restore();
}

function drawBgLayer(layername, canvas, layer, scalefactor, edgeColor, polygonColor, textColor) {
  var ctx = canvas.getContext("2d");
  for (var d of pcbdata.drawings[layername][layer]) {
    if (["segment", "arc", "circle", "curve", "rect","polyline"].includes(d.type)) {
      drawedge(ctx, scalefactor, d, edgeColor);
    } else if (d.type == "polygon") {
      drawPolygonShape(ctx, d, polygonColor);
    } else if (d.type == "text") {
      drawText(ctx, d, polygonColor);
    }
  }
}

function drawTracks(canvas, layer, color, highlight) {
  ctx = canvas.getContext("2d");
  ctx.strokeStyle = color;
  ctx.lineCap = "round";
  for(var track of pcbdata.tracks[layer]) {
    if (highlight && highlightedNet != track.net) continue;
    ctx.lineWidth = track.width;

    if(track.type === 'polyline') {
      drawPolylineShape(ctx,track,color);
    } else if(track.type === 'polygon') {
      drawPolygonShape(ctx, track, color);
    } else if(track.type === 'text') {
      drawText(ctx, track, color);
    } else {
      if ('radius' in track) {
        ctx.beginPath();
        ctx.arc(
            ...track.center,
            track.radius,
            deg2rad(track.startangle),
            deg2rad(track.endangle));
        ctx.stroke();
      } else if('start' in track && 'end' in track) {
        ctx.beginPath();
        ctx.moveTo(...track.start);
        ctx.lineTo(...track.end);
        ctx.stroke();
      }
      
    }

  }
}

function drawZones(canvas, layer, color, highlight) {
  ctx = canvas.getContext("2d");
  ctx.save();
  ctx.strokeStyle = color;
  ctx.fillStyle = color;
  ctx.lineJoin = "round";
  for(var zone of pcbdata.zones[layer]) {
    if (!zone.path2d) {
      zone.path2d = getPolygonsPath(zone);
    }
    if (highlight && highlightedNet != zone.net) continue;
    ctx.fill(zone.path2d);
    if (zone.width > 0) {
      ctx.lineWidth = zone.width;
      ctx.stroke(zone.path2d);
    }
  }
  ctx.restore();
}

function clearCanvas(canvas, color = null) {
  var ctx = canvas.getContext("2d");
  ctx.save();
  ctx.setTransform(1, 0, 0, 1, 0, 0);
  if (color) {
    ctx.fillStyle = color;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
  } else {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }
  ctx.restore();
}

function drawNets(canvas, layer, highlight) {
  var style = getComputedStyle(topmostdiv);
  if (settings.renderTracks) {
    var trackColor = style.getPropertyValue(highlight ? '--track-color-highlight' : '--track-color');
    drawTracks(canvas, layer, trackColor, highlight);
  }
  if (settings.renderZones) {
    var zoneColor = style.getPropertyValue(highlight ? '--zone-color-highlight' : '--zone-color');
    drawZones(canvas, layer, zoneColor, highlight);
  }
  if (highlight && settings.renderPads) {
    var padColor = style.getPropertyValue('--pad-color-highlight');
    var padHoleColor = style.getPropertyValue('--pad-hole-color');
    var ctx = canvas.getContext("2d");
    for (var footprint of pcbdata.footprints) {
      // draw pads
      var padDrawn = false;
      for (var pad of footprint.pads) {
        if (highlightedNet != pad.net) continue;
        if (pad.layers.includes(layer)) {
          drawPad(ctx, pad, padColor, false);
          padDrawn = true;
        }
      }
      if (padDrawn) {
        // redraw all pad holes because some pads may overlap
        for (var pad of footprint.pads) {
          drawPadHole(ctx, pad, padHoleColor);
        }
      }
    }
  }
}

function drawHighlightsOnLayer(canvasdict, clear = true) {
  if (clear) {
    clearCanvas(canvasdict.highlight);
  }
  
  if (highlightedFootprints.length > 0) {
    drawFootprints(canvasdict.highlight, canvasdict.layer,
      canvasdict.transform.s * canvasdict.transform.zoom, true);
  }

  // Draw crosshairs
  if (highlightedFootprints.length > 0) {
    for(var i = 0; i < pcbdata.footprints.length; i++) {
      const footprint = pcbdata.footprints[i];
      if(highlightedFootprints.includes(i) && footprint.layer === canvasdict.layer) {
        drawCrosshair(canvasdict.highlight, footprint.center[0], footprint.center[1], canvasdict.transform.s * canvasdict.transform.zoom, 'red');
      }
    }
  }

  if (highlightedNet !== null) {
    var highlightedPads = [];
    for(var i = 0; i < pcbdata.pads.length; i++) {
      var pad = pcbdata.pads[i];
      if(pad.net === highlightedNet) {
        highlightedPads.push(i);
      }
    }
    
    drawOrphanPads(canvasdict.highlight, canvasdict.layer,
      canvasdict.transform.s * canvasdict.transform.zoom, true, highlightedPads);

    drawNets(canvasdict.highlight, canvasdict.layer, true);
  }
}

function drawHighlights() {
  drawHighlightsOnLayer(allcanvas.front);
  drawHighlightsOnLayer(allcanvas.back);
}

function drawBackground(canvasdict, clear = true) {
  if (clear) {
    clearCanvas(canvasdict.bg);
    clearCanvas(canvasdict.fab);
    clearCanvas(canvasdict.silk);
  }

  drawNets(canvasdict.bg, canvasdict.layer, false);

  drawOrphanPads(canvasdict.bg, canvasdict.layer, canvasdict.transform.s * canvasdict.transform.zoom, false);

  drawFootprints(canvasdict.bg, canvasdict.layer, canvasdict.transform.s * canvasdict.transform.zoom, false);

  drawEdgeCuts(canvasdict.bg, canvasdict.transform.s);

  var style = getComputedStyle(topmostdiv);
  var edgeColor = style.getPropertyValue('--silkscreen-edge-color');
  var polygonColor = style.getPropertyValue('--silkscreen-polygon-color');
  var textColor = style.getPropertyValue('--silkscreen-text-color');
  if (settings.renderSilkscreen) {
    drawBgLayer(
      "silkscreen", canvasdict.silk, canvasdict.layer,
      canvasdict.transform.s * canvasdict.transform.zoom,
      edgeColor, polygonColor, textColor);
  }
  edgeColor = style.getPropertyValue('--fabrication-edge-color');
  polygonColor = style.getPropertyValue('--fabrication-polygon-color');
  textColor = style.getPropertyValue('--fabrication-text-color');
  if (settings.renderFabrication) {
    drawBgLayer(
      "fabrication", canvasdict.fab, canvasdict.layer,
      canvasdict.transform.s * canvasdict.transform.zoom,
      edgeColor, polygonColor, textColor);
  }
}

function prepareCanvas(canvas, flip, transform) {
  var ctx = canvas.getContext("2d");
  ctx.setTransform(1, 0, 0, 1, 0, 0);
  var fontsize = 1.55;
  ctx.scale(transform.zoom, transform.zoom);
  ctx.translate(transform.panx, transform.pany);
  if (flip) {
    ctx.scale(-1, 1);
  }
  ctx.translate(transform.x, transform.y);
  ctx.rotate(deg2rad(settings.boardRotation));
  ctx.scale(transform.s, transform.s);
}

function prepareLayer(canvasdict) {
  var flip = (canvasdict.layer == "B");
  for (var c of ["bg", "fab", "silk", "highlight"]) {
    prepareCanvas(canvasdict[c], flip, canvasdict.transform);
  }
}

function rotateVector(v, angle) {
  angle = deg2rad(angle);
  return [
    v[0] * Math.cos(angle) - v[1] * Math.sin(angle),
    v[0] * Math.sin(angle) + v[1] * Math.cos(angle)
  ];
}

function applyRotation(bbox) {
  var corners = [
    [bbox.minx, bbox.miny],
    [bbox.minx, bbox.maxy],
    [bbox.maxx, bbox.miny],
    [bbox.maxx, bbox.maxy],
  ];
  corners = corners.map((v) => rotateVector(v, settings.boardRotation));
  return {
    minx: corners.reduce((a, v) => Math.min(a, v[0]), Infinity),
    miny: corners.reduce((a, v) => Math.min(a, v[1]), Infinity),
    maxx: corners.reduce((a, v) => Math.max(a, v[0]), -Infinity),
    maxy: corners.reduce((a, v) => Math.max(a, v[1]), -Infinity),
  }
}

function recalcLayerScale(layerdict, width, height) {
  var bbox = applyRotation(pcbdata.edges_bbox);
  var scalefactor = 0.98 * Math.min(
    width / (bbox.maxx - bbox.minx),
    height / (bbox.maxy - bbox.miny)
  );
  if (scalefactor < 0.1) {
    scalefactor = 1;
  }
  layerdict.transform.s = scalefactor;
  var flip = (layerdict.layer == "B");
  if (flip) {
    layerdict.transform.x = -((bbox.maxx + bbox.minx) * scalefactor + width) * 0.5;
  } else {
    layerdict.transform.x = -((bbox.maxx + bbox.minx) * scalefactor - width) * 0.5;
  }
  layerdict.transform.y = -((bbox.maxy + bbox.miny) * scalefactor - height) * 0.5;
  for (var c of ["bg", "fab", "silk", "highlight"]) {
    canvas = layerdict[c];
    canvas.width = width;
    canvas.height = height;
    canvas.style.width = (width / devicePixelRatio) + "px";
    canvas.style.height = (height / devicePixelRatio) + "px";
  }
}

function redrawCanvas(layerdict) {
  prepareLayer(layerdict);
  drawBackground(layerdict);
  drawHighlightsOnLayer(layerdict);
}

function resizeCanvas(layerdict) {
  var canvasdivid = {
    "F": "frontcanvas",
    "B": "backcanvas"
  } [layerdict.layer];
  var width = document.getElementById(canvasdivid).clientWidth * devicePixelRatio;
  var height = document.getElementById(canvasdivid).clientHeight * devicePixelRatio;
  recalcLayerScale(layerdict, width, height);
  redrawCanvas(layerdict);
}

function resizeAll() {
  resizeCanvas(allcanvas.front);
  resizeCanvas(allcanvas.back);
}

function pointWithinDistanceToSegment(x, y, x1, y1, x2, y2, d) {
  var A = x - x1;
  var B = y - y1;
  var C = x2 - x1;
  var D = y2 - y1;

  var dot = A * C + B * D;
  var len_sq = C * C + D * D;
  var dx, dy;
  if (len_sq == 0) {
    // start and end of the segment coincide
    dx = x - x1;
    dy = y - y1;
  } else {
    var param = dot / len_sq;
    var xx, yy;
    if (param < 0) {
      xx = x1;
      yy = y1;
    } else if (param > 1) {
      xx = x2;
      yy = y2;
    } else {
      xx = x1 + param * C;
      yy = y1 + param * D;
    }
    dx = x - xx;
    dy = y - yy;
  }
  return dx * dx + dy * dy <= d * d;
}

function modulo(n, mod) {
  return ((n % mod) + mod ) % mod;
}

function pointWithinDistanceToArc(x, y, xc, yc, radius, startangle, endangle, d) {
  var dx = x - xc;
  var dy = y - yc;
  var r_sq = dx * dx + dy * dy;
  var rmin = Math.max(0, radius-d);
  var rmax = radius + d;

  if (r_sq < rmin * rmin || r_sq > rmax * rmax)
    return false;

  var angle1 = modulo(deg2rad(startangle), 2 * Math.PI);
  var dx1 = xc + radius * Math.cos(angle1) - x;
  var dy1 = yc + radius * Math.sin(angle1) - y;
  if (dx1 * dx1 + dy1 * dy1 <= d * d)
    return true;

  var angle2 = modulo(deg2rad(endangle), 2 * Math.PI);
  var dx2 = xc + radius * Math.cos(angle2) - x;
  var dy2 = yc + radius * Math.sin(angle2) - y;
  if (dx2 * dx2 + dy2 * dy2 <= d * d)
    return true;

  var angle = modulo(Math.atan2(dy, dx), 2 * Math.PI);
  if (angle1 > angle2)
    return (angle >= angle2 || angle <= angle1);
  else
    return (angle >= angle1 && angle <= angle2);
}

function pointWithinPad(x, y, pad) {
  var v = [x - pad.pos[0], y - pad.pos[1]];
  v = rotateVector(v, -pad.angle);
  if (pad.offset) {
    v[0] -= pad.offset[0];
    v[1] -= pad.offset[1];
  }
  return emptyContext2d.isPointInPath(getCachedPadPath(pad), ...v);
}

function netHitScan(layer, x, y) {
  // TODO: Should be refactored

  // Check track segments
  if (settings.renderTracks && pcbdata.tracks) {
    for(var track of pcbdata.tracks[layer]) {
      if(track.type === 'polyline') {
        const path = getPolygonsPath(track);
        if(path) {
          hitTestContext2d.save();
          hitTestContext2d.lineWidth = track.width;
          
          if(hitTestContext2d.isPointInStroke(path,x,y)) {
            hitTestContext2d.restore();
            return track.net;            
          }
          
          hitTestContext2d.restore();          
        }        

      } else if(track.type === 'polygon') {
        const path = getPolygonsPath(track);
        if(path && hitTestContext2d.isPointInPath(path,x,y)) {          
          return track.net;                      
        }                     
      } else if(track.type === 'text') {
        // TODO: To implement taking in account TrueType fonts.
      } else if ('radius' in track) {
        if (pointWithinDistanceToArc(x, y, ...track.center, track.radius, track.startangle, track.endangle, track.width / 2)) {
          return track.net;
        }
      } else if('start' in track && 'end' in track) {
        if (pointWithinDistanceToSegment(x, y, ...track.start, ...track.end, track.width / 2)) {
          return track.net;
        }
      }
    }
  }
  // Check pads
  if (settings.renderPads) {

    // Footprints containing pads
    for (var footprint of pcbdata.footprints) {
      for(var pad of footprint.pads) {
        if (pad.layers.includes(layer) && pointWithinPad(x, y, pad)) {
          return pad.net;
        }
      }
    }

    // Orphan pads
    for(var pad of pcbdata.pads) {
      if (pad.layers.includes(layer) && pointWithinPad(x, y, pad)) {
        return pad.net;
      }
    }
  }
  return null;
}

function pointWithinFootprintBbox(x, y, bbox) {
  var v = [x - bbox.pos[0], y - bbox.pos[1]];
  v = rotateVector(v, bbox.angle);
  return bbox.relpos[0] <= v[0] && v[0] <= bbox.relpos[0] + bbox.size[0] &&
         bbox.relpos[1] <= v[1] && v[1] <= bbox.relpos[1] + bbox.size[1];
}

function bboxHitScan(layer, x, y) {
  var result = [];
  for (var i = 0; i < pcbdata.footprints.length; i++) {
    var footprint = pcbdata.footprints[i];
    if (footprint.layer == layer) {
      if (pointWithinFootprintBbox(x, y, footprint.bbox)) {
        result.push(i);
      }
    }
  }
  return result;
}

function handlePointerDown(e, layerdict) {
  if (e.button != 0 && e.button != 1) {
    return;
  }
  e.preventDefault();
  e.stopPropagation();

  if (!e.hasOwnProperty("offsetX")) {
    // The polyfill doesn't set this properly
    e.offsetX = e.pageX - e.currentTarget.offsetLeft;
    e.offsetY = e.pageY - e.currentTarget.offsetTop;
  }

  layerdict.pointerStates[e.pointerId] = {
    distanceTravelled: 0,
    lastX: e.offsetX,
    lastY: e.offsetY,
    downTime: Date.now(),
  };
}

function handleMouseClick(e, layerdict) {
  if (!e.hasOwnProperty("offsetX")) {
    // The polyfill doesn't set this properly
    e.offsetX = e.pageX - e.currentTarget.offsetLeft;
    e.offsetY = e.pageY - e.currentTarget.offsetTop;
  }

  var x = e.offsetX;
  var y = e.offsetY;
  var t = layerdict.transform;
  if (layerdict.layer == "B") {
    x = (devicePixelRatio * x / t.zoom - t.panx + t.x) / -t.s;
  } else {
    x = (devicePixelRatio * x / t.zoom - t.panx - t.x) / t.s;
  }
  y = (devicePixelRatio * y / t.zoom - t.y - t.pany) / t.s;
  var v = rotateVector([x, y], -settings.boardRotation);
  if ("nets" in pcbdata) {
    var net = netHitScan(layerdict.layer, ...v);
    if (net !== highlightedNet) {
      netClicked(net);
    }
  }
  if (highlightedNet === null) {
    var footprints = bboxHitScan(layerdict.layer, ...v);
    if (footprints.length > 0) {
      footprintsClicked(footprints);
    }
  }
}

function handlePointerLeave(e, layerdict) {
  e.preventDefault();
  e.stopPropagation();

  if (!settings.redrawOnDrag) {
    redrawCanvas(layerdict);
  }

  delete layerdict.pointerStates[e.pointerId];
}

function resetTransform(layerdict) {
  layerdict.transform.panx = 0;
  layerdict.transform.pany = 0;
  layerdict.transform.zoom = 1;
  redrawCanvas(layerdict);
}

function handlePointerUp(e, layerdict) {
  if (!e.hasOwnProperty("offsetX")) {
    // The polyfill doesn't set this properly
    e.offsetX = e.pageX - e.currentTarget.offsetLeft;
    e.offsetY = e.pageY - e.currentTarget.offsetTop;
  }

  e.preventDefault();
  e.stopPropagation();

  if (e.button == 2) {
    // Reset pan and zoom on right click.
    resetTransform(layerdict);
    layerdict.anotherPointerTapped = false;
    return;
  }

  // We haven't necessarily had a pointermove event since the interaction started, so make sure we update this now
  var ptr = layerdict.pointerStates[e.pointerId];
  ptr.distanceTravelled += Math.abs(e.offsetX - ptr.lastX) + Math.abs(e.offsetY - ptr.lastY);

  if (e.button == 0 && ptr.distanceTravelled < 10 && Date.now() - ptr.downTime <= 500) {
    if (Object.keys(layerdict.pointerStates).length == 1) {
      if (layerdict.anotherPointerTapped) {
        // This is the second pointer coming off of a two-finger tap
        resetTransform(layerdict);
      } else {
        // This is just a regular tap
        handleMouseClick(e, layerdict);
      }
      layerdict.anotherPointerTapped = false;
    } else {
      // This is the first finger coming off of what could become a two-finger tap
      layerdict.anotherPointerTapped = true;
    }
  } else {
    if (!settings.redrawOnDrag) {
      redrawCanvas(layerdict);
    }
    layerdict.anotherPointerTapped = false;
  }

  delete layerdict.pointerStates[e.pointerId];
}

function handlePointerMove(e, layerdict) {
  if (!layerdict.pointerStates.hasOwnProperty(e.pointerId)) {
    return;
  }
  e.preventDefault();
  e.stopPropagation();

  if (!e.hasOwnProperty("offsetX")) {
    // The polyfill doesn't set this properly
    e.offsetX = e.pageX - e.currentTarget.offsetLeft;
    e.offsetY = e.pageY - e.currentTarget.offsetTop;
  }

  var thisPtr = layerdict.pointerStates[e.pointerId];

  var dx = e.offsetX - thisPtr.lastX;
  var dy = e.offsetY - thisPtr.lastY;

  // If this number is low on pointer up, we count the action as a click
  thisPtr.distanceTravelled += Math.abs(dx) + Math.abs(dy);

  if (Object.keys(layerdict.pointerStates).length == 1) {
    // This is a simple drag
    layerdict.transform.panx += devicePixelRatio * dx / layerdict.transform.zoom;
    layerdict.transform.pany += devicePixelRatio * dy / layerdict.transform.zoom;
  } else if (Object.keys(layerdict.pointerStates).length == 2) {
    var otherPtr = Object.values(layerdict.pointerStates).filter((ptr) => ptr != thisPtr)[0];

    var oldDist = Math.sqrt(Math.pow(thisPtr.lastX - otherPtr.lastX, 2) + Math.pow(thisPtr.lastY - otherPtr.lastY, 2));
    var newDist = Math.sqrt(Math.pow(e.offsetX - otherPtr.lastX, 2)     + Math.pow(e.offsetY - otherPtr.lastY, 2));

    var scaleFactor = newDist/oldDist;

    if (scaleFactor != NaN) {
      layerdict.transform.zoom *= scaleFactor;

      var zoomd = (1 - scaleFactor) / layerdict.transform.zoom;
      layerdict.transform.panx += devicePixelRatio * otherPtr.lastX * zoomd;
      layerdict.transform.pany += devicePixelRatio * otherPtr.lastY * zoomd;
    }
  }

  thisPtr.lastX = e.offsetX;
  thisPtr.lastY = e.offsetY;

  if (settings.redrawOnDrag) {
    redrawCanvas(layerdict);
  }
}

function handleMouseWheel(e, layerdict) {
  e.preventDefault();
  e.stopPropagation();
  var t = layerdict.transform;
  var wheeldelta = e.deltaY;
  if (e.deltaMode == 1) {
    // FF only, scroll by lines
    wheeldelta *= 30;
  } else if (e.deltaMode == 2) {
    wheeldelta *= 300;
  }
  var m = Math.pow(1.1, -wheeldelta / 40);
  // Limit amount of zoom per tick.
  if (m > 2) {
    m = 2;
  } else if (m < 0.5) {
    m = 0.5;
  }
  t.zoom *= m;
  var zoomd = (1 - m) / t.zoom;
  t.panx += devicePixelRatio * e.offsetX * zoomd;
  t.pany += devicePixelRatio * e.offsetY * zoomd;
  redrawCanvas(layerdict);
}

function addMouseHandlers(div, layerdict) {
  div.addEventListener("pointerdown", function(e) {
    handlePointerDown(e, layerdict);
  });
  div.addEventListener("pointermove", function(e) {
    handlePointerMove(e, layerdict);
  });
  div.addEventListener("pointerup", function(e) {
    handlePointerUp(e, layerdict);
  });
  var pointerleave = function(e) {
    handlePointerLeave(e, layerdict);
  }
  div.addEventListener("pointercancel", pointerleave);
  div.addEventListener("pointerleave", pointerleave);
  div.addEventListener("pointerout", pointerleave);

  div.onwheel = function(e) {
    handleMouseWheel(e, layerdict);
  }
  for (var element of [div, layerdict.bg, layerdict.fab, layerdict.silk, layerdict.highlight]) {
    element.addEventListener("contextmenu", function(e) {
      e.preventDefault();
    }, false);
  }
}

function setRedrawOnDrag(value) {
  settings.redrawOnDrag = value;
  writeStorage("redrawOnDrag", value);
}

function setShowCrosshair(value) {
  settings.showCrosshair = value;
  writeStorage("showCrosshair", value);
}

function setBoardRotation(value) {
  settings.boardRotation = value * 5;
  writeStorage("boardRotation", settings.boardRotation);
  document.getElementById("rotationDegree").textContent = settings.boardRotation;
  resizeAll();
}

function initRender() {
  allcanvas = {
    front: {
      transform: {
        x: 0,
        y: 0,
        s: 1,
        panx: 0,
        pany: 0,
        zoom: 1,
      },
      pointerStates: {},
      anotherPointerTapped: false,
      bg: document.getElementById("F_bg"),
      fab: document.getElementById("F_fab"),
      silk: document.getElementById("F_slk"),
      highlight: document.getElementById("F_hl"),
      layer: "F",
    },
    back: {
      transform: {
        x: 0,
        y: 0,
        s: 1,
        panx: 0,
        pany: 0,
        zoom: 1,
      },
      pointerStates: {},
      anotherPointerTapped: false,
      bg: document.getElementById("B_bg"),
      fab: document.getElementById("B_fab"),
      silk: document.getElementById("B_slk"),
      highlight: document.getElementById("B_hl"),
      layer: "B",
    }
  };
  addMouseHandlers(document.getElementById("frontcanvas"), allcanvas.front);
  addMouseHandlers(document.getElementById("backcanvas"), allcanvas.back);
}

///////////////////////////////////////////////

///////////////////////////////////////////////
/* DOM manipulation and misc code */

var bomsplit;
var canvassplit;
var initDone = false;
var bomSortFunction = null;
var currentSortColumn = null;
var currentSortOrder = null;
var currentHighlightedRowId;
var highlightHandlers = [];
var footprintIndexToHandler = {};
var netsToHandler = {};
var highlightedFootprints = [];
var highlightedOrphanPads = [];
var highlightedNet = null;
var lastClicked;

function dbg(html) {
  dbgdiv.innerHTML = html;
}

function redrawIfInitDone() {
  if (initDone) {
    redrawCanvas(allcanvas.front);
    redrawCanvas(allcanvas.back);
  }
}

function padsVisible(value) {
  writeStorage("padsVisible", value);
  settings.renderPads = value;
  redrawIfInitDone();
}

function referencesVisible(value) {
  writeStorage("referencesVisible", value);
  settings.renderReferences = value;
  redrawIfInitDone();
}

function valuesVisible(value) {
  writeStorage("valuesVisible", value);
  settings.renderValues = value;
  redrawIfInitDone();
}

function tracksVisible(value) {
  writeStorage("tracksVisible", value);
  settings.renderTracks = value;
  redrawIfInitDone();
}

function zonesVisible(value) {
  writeStorage("zonesVisible", value);
  settings.renderZones = value;
  redrawIfInitDone();
}

function dnpOutline(value) {
  writeStorage("dnpOutline", value);
  settings.renderDnpOutline = value;
  redrawIfInitDone();
}

function setDarkMode(value) {
  if (value) {
    topmostdiv.classList.add("dark");
  } else {
    topmostdiv.classList.remove("dark");
  }
  writeStorage("darkmode", value);
  settings.darkMode = value;
  redrawIfInitDone();
}

function setFullscreen(value) {
  if (value) {
    document.documentElement.requestFullscreen();
  } else {
    document.exitFullscreen();
  }
}

function fabricationVisible(value) {
  writeStorage("fabricationVisible", value);
  settings.renderFabrication = value;
  redrawIfInitDone();
}

function silkscreenVisible(value) {
  writeStorage("silkscreenVisible", value);
  settings.renderSilkscreen = value;
  redrawIfInitDone();
}

function setHighlightPin1(value) {
  writeStorage("highlightpin1", value);
  settings.highlightpin1 = value;
  redrawIfInitDone();
}

function getStoredCheckboxRefs(checkbox) {
  function convert(ref) {
    var intref = parseInt(ref);
    if (isNaN(intref)) {
      for (var i = 0; i < pcbdata.footprints.length; i++) {
        if (pcbdata.footprints[i].ref == ref) {
          return i;
        }
      }
      return -1;
    } else {
      return intref;
    }
  }
  if (!(checkbox in settings.checkboxStoredRefs)) {
    var val = readStorage("checkbox_" + checkbox);
    settings.checkboxStoredRefs[checkbox] = val ? val : "";
  }
  if (!settings.checkboxStoredRefs[checkbox]) {
    return new Set();
  } else {
    return new Set(settings.checkboxStoredRefs[checkbox].split(",").map(r => convert(r)).filter(a => a >= 0));
  }
}

function getCheckboxState(checkbox, references) {
  var storedRefsSet = getStoredCheckboxRefs(checkbox);
  var currentRefsSet = new Set(references.map(r => r[1]));
  // Get difference of current - stored
  var difference = new Set(currentRefsSet);
  for (ref of storedRefsSet) {
    difference.delete(ref);
  }
  if (difference.size == 0) {
    // All the current refs are stored
    return "checked";
  } else if (difference.size == currentRefsSet.size) {
    // None of the current refs are stored
    return "unchecked";
  } else {
    // Some of the refs are stored
    return "indeterminate";
  }
}

function setBomCheckboxState(checkbox, element, references) {
  var state = getCheckboxState(checkbox, references);
  element.checked = (state == "checked");
  element.indeterminate = (state == "indeterminate");
}

function createCheckboxChangeHandler(checkbox, references, row) {
  return function() {
    refsSet = getStoredCheckboxRefs(checkbox);
    var darkenWhenChecked = settings.darkenWhenChecked == checkbox;
    eventArgs = {
      checkbox: checkbox,
      refs: references,
    }
    if (this.checked) {
      // checkbox ticked
      for (var ref of references) {
        refsSet.add(ref[1]);
      }
      if (darkenWhenChecked) {
        row.classList.add("checked");
      }
      eventArgs.state = 'checked';
    } else {
      // checkbox unticked
      for (var ref of references) {
        refsSet.delete(ref[1]);
      }
      if (darkenWhenChecked) {
        row.classList.remove("checked");
      }
      eventArgs.state = 'unchecked';
    }
    settings.checkboxStoredRefs[checkbox] = [...refsSet].join(",");
    writeStorage("checkbox_" + checkbox, settings.checkboxStoredRefs[checkbox]);
    updateCheckboxStats(checkbox);
    EventHandler.emitEvent(IBOM_EVENT_TYPES.CHECKBOX_CHANGE_EVENT, eventArgs);
  }
}

function clearHighlightedFootprints() {
  if (currentHighlightedRowId) {
    document.getElementById(currentHighlightedRowId).classList.remove("highlighted");
    currentHighlightedRowId = null;
    highlightedFootprints = [];  
    highlightedOrphanPads = [];  
    highlightedNet = null;
  }
}

function createRowHighlightHandler(rowid, refs, net) {
  return function() {
    if (currentHighlightedRowId) {
      if (currentHighlightedRowId == rowid) {
        return;
      }
      document.getElementById(currentHighlightedRowId).classList.remove("highlighted");
    }
    document.getElementById(rowid).classList.add("highlighted");
    currentHighlightedRowId = rowid;
    highlightedFootprints = refs ? refs.map(r => r[1]) : [];
    highlightedNet = net;
    drawHighlights();
    EventHandler.emitEvent(
      IBOM_EVENT_TYPES.HIGHLIGHT_EVENT,
      {
        rowid: rowid,
        refs: refs,
        net: net
      });
  }
}

function entryMatches(entry) {
  if (settings.bommode == "netlist") {
    // entry is just a net name
    return entry.toLowerCase().indexOf(filter) >= 0;
  }
  // check refs
  for (var ref of entry[3]) {
    if (ref[0].toLowerCase().indexOf(filter) >= 0) {
      return true;
    }
  }
  // check extra fields
  for (var i in config.extra_fields) {
    if (entry[4][i].toLowerCase().indexOf(filter) >= 0) {
      return true;
    }
  }
  // check value
  if (entry[1].toLowerCase().indexOf(filter) >= 0) {
    return true;
  }
  // check footprint
  if (entry[2].toLowerCase().indexOf(filter) >= 0) {
    return true;
  }
  return false;
}

function findRefInEntry(entry) {
  return entry[3].filter(r => r[0].toLowerCase() == reflookup);
}

function highlightFilter(s) {
  if (!filter) {
    return s;
  }
  var parts = s.toLowerCase().split(filter);
  if (parts.length == 1) {
    return s;
  }
  var r = "";
  var pos = 0;
  for (var i in parts) {
    if (i > 0) {
      r += '<mark class="highlight">' +
        s.substring(pos, pos + filter.length) +
        '</mark>';
      pos += filter.length;
    }
    r += s.substring(pos, pos + parts[i].length);
    pos += parts[i].length;
  }
  return r;
}

function checkboxSetUnsetAllHandler(checkboxname) {
  return function() {
    var checkboxnum = 0;
    while (checkboxnum < settings.checkboxes.length &&
      settings.checkboxes[checkboxnum].toLowerCase() != checkboxname.toLowerCase()) {
      checkboxnum++;
    }
    if (checkboxnum >= settings.checkboxes.length) {
      return;
    }
    var allset = true;
    var checkbox;
    var row;
    for (row of bombody.childNodes) {
      checkbox = row.childNodes[checkboxnum + 1].childNodes[0];
      if (!checkbox.checked || checkbox.indeterminate) {
        allset = false;
        break;
      }
    }
    for (row of bombody.childNodes) {
      checkbox = row.childNodes[checkboxnum + 1].childNodes[0];
      checkbox.checked = !allset;
      checkbox.indeterminate = false;
      checkbox.onchange();
    }
  }
}

function createColumnHeader(name, cls, comparator) {
  var th = document.createElement("TH");
  th.innerHTML = name;
  th.classList.add(cls);
  th.style.cursor = "pointer";
  var span = document.createElement("SPAN");
  span.classList.add("sortmark");
  span.classList.add("none");
  th.appendChild(span);
  th.onclick = function() {
    if (currentSortColumn && this !== currentSortColumn) {
      // Currently sorted by another column
      currentSortColumn.childNodes[1].classList.remove(currentSortOrder);
      currentSortColumn.childNodes[1].classList.add("none");
      currentSortColumn = null;
      currentSortOrder = null;
    }
    if (currentSortColumn && this === currentSortColumn) {
      // Already sorted by this column
      if (currentSortOrder == "asc") {
        // Sort by this column, descending order
        bomSortFunction = function(a, b) {
          return -comparator(a, b);
        }
        currentSortColumn.childNodes[1].classList.remove("asc");
        currentSortColumn.childNodes[1].classList.add("desc");
        currentSortOrder = "desc";
      } else {
        // Unsort
        bomSortFunction = null;
        currentSortColumn.childNodes[1].classList.remove("desc");
        currentSortColumn.childNodes[1].classList.add("none");
        currentSortColumn = null;
        currentSortOrder = null;
      }
    } else {
      // Sort by this column, ascending order
      bomSortFunction = comparator;
      currentSortColumn = this;
      currentSortColumn.childNodes[1].classList.remove("none");
      currentSortColumn.childNodes[1].classList.add("asc");
      currentSortOrder = "asc";
    }
    populateBomBody();
  }
  return th;
}

function populateBomHeader() {
  while (bomhead.firstChild) {
    bomhead.removeChild(bomhead.firstChild);
  }
  var tr = document.createElement("TR");
  var th = document.createElement("TH");
  th.classList.add("numCol");
  tr.appendChild(th);
  var checkboxCompareClosure = function(checkbox) {
    return (a, b) => {
      var stateA = getCheckboxState(checkbox, a[3]);
      var stateB = getCheckboxState(checkbox, b[3]);
      if (stateA > stateB) return -1;
      if (stateA < stateB) return 1;
      return 0;
    }
  }
  if (settings.bommode == "netlist") {
    th = createColumnHeader("Net name", "bom-netname", (a, b) => {
      if (a > b) return -1;
      if (a < b) return 1;
      return 0;
    });
    tr.appendChild(th);
  } else {
    for (var checkbox of settings.checkboxes) {
      th = createColumnHeader(
        checkbox, "bom-checkbox", checkboxCompareClosure(checkbox));
      th.onclick = fancyDblClickHandler(
        th, th.onclick.bind(th), checkboxSetUnsetAllHandler(checkbox));
      tr.appendChild(th);
    }
    tr.appendChild(createColumnHeader("References", "References", (a, b) => {
      var i = 0;
      while (i < a[3].length && i < b[3].length) {
        if (a[3][i] != b[3][i]) return a[3][i] > b[3][i] ? 1 : -1;
        i++;
      }
      return a[3].length - b[3].length;
    }));
    // Extra fields
    if (config.extra_fields.length > 0) {
      var extraFieldCompareClosure = function(fieldIndex) {
        return (a, b) => {
          var fa = a[4][fieldIndex];
          var fb = b[4][fieldIndex];
          if (fa != fb) return fa > fb ? 1 : -1;
          else return 0;
        }
      }
      for (var i in config.extra_fields) {
        tr.appendChild(createColumnHeader(
          config.extra_fields[i], "extra", extraFieldCompareClosure(i)));
      }
    }
    tr.appendChild(createColumnHeader("Value", "Value", (a, b) => {
      return valueCompare(a[5], b[5], a[1], b[1]);
    }));
    tr.appendChild(createColumnHeader("Footprint", "Footprint", (a, b) => {
      if (a[2] != b[2]) return a[2] > b[2] ? 1 : -1;
      else return 0;
    }));
    if (settings.bommode == "grouped") {
      tr.appendChild(createColumnHeader("Quantity", "Quantity", (a, b) => {
        return a[3].length - b[3].length;
      }));
    }
  }
  bomhead.appendChild(tr);
}

function populateBomBody() {
  while (bom.firstChild) {
    bom.removeChild(bom.firstChild);
  }
  highlightHandlers = [];
  footprintIndexToHandler = {};
  netsToHandler = {};
  currentHighlightedRowId = null;
  var first = true;
  if (settings.bommode == "netlist") {
    bomtable = pcbdata.nets.slice();
  } else {
    switch (settings.canvaslayout) {
      case 'F':
        bomtable = pcbdata.bom.F.slice();
        break;
      case 'FB':
        bomtable = pcbdata.bom.both.slice();
        break;
      case 'B':
        bomtable = pcbdata.bom.B.slice();
        break;
    }
    if (settings.bommode == "ungrouped") {
      // expand bom table
      expandedTable = []
      for (var bomentry of bomtable) {
        for (var ref of bomentry[3]) {
          expandedTable.push([1, bomentry[1], bomentry[2], [ref], bomentry[4], bomentry[5]]);
        }
      }
      bomtable = expandedTable;
    }
  }
  if (bomSortFunction) {
    bomtable = bomtable.sort(bomSortFunction);
  }
  for (var i in bomtable) {
    var bomentry = bomtable[i];
    if (filter && !entryMatches(bomentry)) {
      continue;
    }
    var references = null;
    var netname = null;
    var tr = document.createElement("TR");
    var td = document.createElement("TD");
    var rownum = +i + 1;
    tr.id = "bomrow" + rownum;
    td.textContent = rownum;
    tr.appendChild(td);
    if (settings.bommode == "netlist") {
      netname = bomentry;
      td = document.createElement("TD");
      td.innerHTML = highlightFilter(netname ? netname : "&lt;no net&gt;");
      tr.appendChild(td);
    } else {
      if (reflookup) {
        references = findRefInEntry(bomentry);
        if (references.length == 0) {
          continue;
        }
      } else {
        references = bomentry[3];
      }
      // Checkboxes
      for (var checkbox of settings.checkboxes) {
        if (checkbox) {
          td = document.createElement("TD");
          var input = document.createElement("input");
          input.type = "checkbox";
          input.onchange = createCheckboxChangeHandler(checkbox, references, tr);
          setBomCheckboxState(checkbox, input, references);
          if (input.checked && settings.darkenWhenChecked == checkbox) {
            tr.classList.add("checked");
          }
          td.appendChild(input);
          tr.appendChild(td);
        }
      }
      // References
      td = document.createElement("TD");
      td.innerHTML = highlightFilter(references.map(r => r[0]).join(", "));
      tr.appendChild(td);
      // Extra fields
      for (var i in config.extra_fields) {
        td = document.createElement("TD");
        td.innerHTML = highlightFilter(bomentry[4][i]);
        tr.appendChild(td);
      }
      // Value
      td = document.createElement("TD");
      td.innerHTML = highlightFilter(bomentry[1]);
      tr.appendChild(td);
      // Footprint
      td = document.createElement("TD");
      td.innerHTML = highlightFilter(bomentry[2]);
      tr.appendChild(td);
      if (settings.bommode == "grouped") {
        // Quantity
        td = document.createElement("TD");
        td.textContent = bomentry[3].length;
        tr.appendChild(td);
      }
    }
    bom.appendChild(tr);
    var handler = createRowHighlightHandler(tr.id, references, netname);
    tr.onmousemove = handler;
    highlightHandlers.push({
      id: tr.id,
      handler: handler,
    });
    if (references !== null) {
      for (var refIndex of references.map(r => r[1])) {
        footprintIndexToHandler[refIndex] = handler;
      }
    }
    if (netname !== null) {
      netsToHandler[netname] = handler;
    }
    if ((filter || reflookup) && first) {
      handler();
      first = false;
    }
  }
  EventHandler.emitEvent(
    IBOM_EVENT_TYPES.BOM_BODY_CHANGE_EVENT,
    {
      filter: filter,
      reflookup: reflookup,
      checkboxes: settings.checkboxes,
      bommode: settings.bommode,
    });
}

function highlightPreviousRow() {
  if (!currentHighlightedRowId) {
    highlightHandlers[highlightHandlers.length - 1].handler();
  } else {
    if (highlightHandlers.length > 1 &&
      highlightHandlers[0].id == currentHighlightedRowId) {
      highlightHandlers[highlightHandlers.length - 1].handler();
    } else {
      for (var i = 0; i < highlightHandlers.length - 1; i++) {
        if (highlightHandlers[i + 1].id == currentHighlightedRowId) {
          highlightHandlers[i].handler();
          break;
        }
      }
    }
  }
  smoothScrollToRow(currentHighlightedRowId);
}

function highlightNextRow() {
  if (!currentHighlightedRowId) {
    highlightHandlers[0].handler();
  } else {
    if (highlightHandlers.length > 1 &&
      highlightHandlers[highlightHandlers.length - 1].id == currentHighlightedRowId) {
      highlightHandlers[0].handler();
    } else {
      for (var i = 1; i < highlightHandlers.length; i++) {
        if (highlightHandlers[i - 1].id == currentHighlightedRowId) {
          highlightHandlers[i].handler();
          break;
        }
      }
    }
  }
  smoothScrollToRow(currentHighlightedRowId);
}

function populateBomTable() {
  populateBomHeader();
  populateBomBody();
}

function footprintsClicked(footprintIndexes) {
  var lastClickedIndex = footprintIndexes.indexOf(lastClicked);
  for (var i = 1; i <= footprintIndexes.length; i++) {
    var refIndex = footprintIndexes[(lastClickedIndex + i) % footprintIndexes.length];
    if (refIndex in footprintIndexToHandler) {
      lastClicked = refIndex;
      footprintIndexToHandler[refIndex]();
      smoothScrollToRow(currentHighlightedRowId);
      break;
    }
  }
}

function netClicked(net) {
  if (net in netsToHandler) {
    netsToHandler[net]();
    smoothScrollToRow(currentHighlightedRowId);
  } else {
    clearHighlightedFootprints();
    highlightedNet = net;
    drawHighlights();
  }
}

function updateFilter(input) {
  filter = input.toLowerCase();
  populateBomTable();
}

function updateRefLookup(input) {
  reflookup = input.toLowerCase();
  populateBomTable();
}

function changeCanvasLayout(layout) {
  document.getElementById("fl-btn").classList.remove("depressed");
  document.getElementById("fb-btn").classList.remove("depressed");
  document.getElementById("bl-btn").classList.remove("depressed");
  switch (layout) {
    case 'F':
      document.getElementById("fl-btn").classList.add("depressed");
      if (settings.bomlayout != "bom-only") {
        canvassplit.collapse(1);
      }
      break;
    case 'B':
      document.getElementById("bl-btn").classList.add("depressed");
      if (settings.bomlayout != "bom-only") {
        canvassplit.collapse(0);
      }
      break;
    default:
      document.getElementById("fb-btn").classList.add("depressed");
      if (settings.bomlayout != "bom-only") {
        canvassplit.setSizes([50, 50]);
      }
  }
  settings.canvaslayout = layout;
  writeStorage("canvaslayout", layout);
  resizeAll();
  changeBomMode(settings.bommode);
}

function populateMetadata() {
  document.getElementById("title").innerHTML = pcbdata.metadata.title;
  document.getElementById("revision").innerHTML = "Rev: " + pcbdata.metadata.revision;
  document.getElementById("company").innerHTML = pcbdata.metadata.company;
  document.getElementById("filedate").innerHTML = pcbdata.metadata.date;
  if (pcbdata.metadata.title != "") {
    document.title = pcbdata.metadata.title + " BOM";
  }
  // Calculate board stats
  var fp_f = 0, fp_b = 0, pads_f = 0, pads_b = 0, pads_th = 0;
  for (var i = 0; i < pcbdata.footprints.length; i++) {
    if (pcbdata.bom.skipped.includes(i)) continue;
    var mod = pcbdata.footprints[i];
    if (mod.layer == "F") {
      fp_f++;
    } else {
      fp_b++;
    }
    for (var pad of mod.pads) {
      if (pad.type == "th") {
        pads_th++;
      } else {
        if (pad.layers.includes("F")) {
          pads_f++;
        }
        if (pad.layers.includes("B")) {
          pads_b++;
        }
      }
    }
  }
  document.getElementById("stats-components-front").innerHTML = fp_f;
  document.getElementById("stats-components-back").innerHTML = fp_b;
  document.getElementById("stats-components-total").innerHTML = fp_f + fp_b;
  document.getElementById("stats-groups-front").innerHTML = pcbdata.bom.F.length;
  document.getElementById("stats-groups-back").innerHTML = pcbdata.bom.B.length;
  document.getElementById("stats-groups-total").innerHTML = pcbdata.bom.both.length;
  document.getElementById("stats-smd-pads-front").innerHTML = pads_f;
  document.getElementById("stats-smd-pads-back").innerHTML = pads_b;
  document.getElementById("stats-smd-pads-total").innerHTML = pads_f + pads_b;
  document.getElementById("stats-th-pads").innerHTML = pads_th;
  // Update version string
  document.getElementById("github-link").innerHTML = "InteractiveHtmlBom&nbsp;" +
    /^v\d+\.\d+/.exec(pcbdata.ibom_version)[0];
}

function changeBomLayout(layout) {
  document.getElementById("bom-btn").classList.remove("depressed");
  document.getElementById("lr-btn").classList.remove("depressed");
  document.getElementById("tb-btn").classList.remove("depressed");
  switch (layout) {
    case 'bom-only':
      document.getElementById("bom-btn").classList.add("depressed");
      if (bomsplit) {
        bomsplit.destroy();
        bomsplit = null;
        canvassplit.destroy();
        canvassplit = null;
      }
      document.getElementById("frontcanvas").style.display = "none";
      document.getElementById("backcanvas").style.display = "none";
      document.getElementById("bot").style.height = "";
      break;
    case 'top-bottom':
      document.getElementById("tb-btn").classList.add("depressed");
      document.getElementById("frontcanvas").style.display = "";
      document.getElementById("backcanvas").style.display = "";
      document.getElementById("bot").style.height = "calc(100% - 80px)";
      document.getElementById("bomdiv").classList.remove("split-horizontal");
      document.getElementById("canvasdiv").classList.remove("split-horizontal");
      document.getElementById("frontcanvas").classList.add("split-horizontal");
      document.getElementById("backcanvas").classList.add("split-horizontal");
      if (bomsplit) {
        bomsplit.destroy();
        bomsplit = null;
        canvassplit.destroy();
        canvassplit = null;
      }
      bomsplit = Split(['#bomdiv', '#canvasdiv'], {
        sizes: [50, 50],
        onDragEnd: resizeAll,
        direction: "vertical",
        gutterSize: 5
      });
      canvassplit = Split(['#frontcanvas', '#backcanvas'], {
        sizes: [50, 50],
        gutterSize: 5,
        onDragEnd: resizeAll
      });
      break;
    case 'left-right':
      document.getElementById("lr-btn").classList.add("depressed");
      document.getElementById("frontcanvas").style.display = "";
      document.getElementById("backcanvas").style.display = "";
      document.getElementById("bot").style.height = "calc(100% - 80px)";
      document.getElementById("bomdiv").classList.add("split-horizontal");
      document.getElementById("canvasdiv").classList.add("split-horizontal");
      document.getElementById("frontcanvas").classList.remove("split-horizontal");
      document.getElementById("backcanvas").classList.remove("split-horizontal");
      if (bomsplit) {
        bomsplit.destroy();
        bomsplit = null;
        canvassplit.destroy();
        canvassplit = null;
      }
      bomsplit = Split(['#bomdiv', '#canvasdiv'], {
        sizes: [50, 50],
        onDragEnd: resizeAll,
        gutterSize: 5
      });
      canvassplit = Split(['#frontcanvas', '#backcanvas'], {
        sizes: [50, 50],
        gutterSize: 5,
        direction: "vertical",
        onDragEnd: resizeAll
      });
  }
  settings.bomlayout = layout;
  writeStorage("bomlayout", layout);
  changeCanvasLayout(settings.canvaslayout);
}

function changeBomMode(mode) {
  document.getElementById("bom-grouped-btn").classList.remove("depressed");
  document.getElementById("bom-ungrouped-btn").classList.remove("depressed");
  document.getElementById("bom-netlist-btn").classList.remove("depressed");
  switch (mode) {
    case 'grouped':
      document.getElementById("bom-grouped-btn").classList.add("depressed");
      break;
    case 'ungrouped':
      document.getElementById("bom-ungrouped-btn").classList.add("depressed");
      break;
    case 'netlist':
      document.getElementById("bom-netlist-btn").classList.add("depressed");
  }
  writeStorage("bommode", mode);
  if (mode != settings.bommode) {
    settings.bommode = mode;
    bomSortFunction = null;
    currentSortColumn = null;
    currentSortOrder = null;
    clearHighlightedFootprints();
  }
  populateBomTable();
}

function focusFilterField() {
  focusInputField(document.getElementById("filter"));
}

function focusRefLookupField() {
  focusInputField(document.getElementById("reflookup"));
}

function toggleBomCheckbox(bomrowid, checkboxnum) {
  if (!bomrowid || checkboxnum > settings.checkboxes.length) {
    return;
  }
  var bomrow = document.getElementById(bomrowid);
  var checkbox = bomrow.childNodes[checkboxnum].childNodes[0];
  checkbox.checked = !checkbox.checked;
  checkbox.indeterminate = false;
  checkbox.onchange();
}

function checkBomCheckbox(bomrowid, checkboxname) {
  var checkboxnum = 0;
  while (checkboxnum < settings.checkboxes.length &&
    settings.checkboxes[checkboxnum].toLowerCase() != checkboxname.toLowerCase()) {
    checkboxnum++;
  }
  if (!bomrowid || checkboxnum >= settings.checkboxes.length) {
    return;
  }
  var bomrow = document.getElementById(bomrowid);
  var checkbox = bomrow.childNodes[checkboxnum + 1].childNodes[0];
  checkbox.checked = true;
  checkbox.indeterminate = false;
  checkbox.onchange();
}

function setBomCheckboxes(value) {
  writeStorage("bomCheckboxes", value);
  settings.checkboxes = value.split(",").filter((e) => e);
  prepCheckboxes();
  populateBomTable();
  populateDarkenWhenCheckedOptions();
}

function setDarkenWhenChecked(value) {
  writeStorage("darkenWhenChecked", value);
  settings.darkenWhenChecked = value;
  populateBomTable();
}

function prepCheckboxes() {
  var table = document.getElementById("checkbox-stats");
  while (table.childElementCount > 1) {
    table.removeChild(table.lastChild);
  }
  if (settings.checkboxes.length) {
    table.style.display = "";
  } else {
    table.style.display = "none";
  }
  for (var checkbox of settings.checkboxes) {
    var tr = document.createElement("TR");
    var td = document.createElement("TD");
    td.innerHTML = checkbox;
    tr.appendChild(td);
    td = document.createElement("TD");
    td.id = "checkbox-stats-" + checkbox;
    var progressbar = document.createElement("div");
    progressbar.classList.add("bar");
    td.appendChild(progressbar);
    var text = document.createElement("div");
    text.classList.add("text");
    td.appendChild(text);
    tr.appendChild(td);
    table.appendChild(tr);
    updateCheckboxStats(checkbox);
  }
}

function populateDarkenWhenCheckedOptions() {
  var container = document.getElementById("darkenWhenCheckedContainer");

  if (settings.checkboxes.length == 0) {
    container.parentElement.style.display = "none";
    return;
  }

  container.innerHTML = '';
  container.parentElement.style.display = "inline-block";

  function createOption(name, displayName) {
    var id = "darkenWhenChecked-" + name;

    var div = document.createElement("div");
    div.classList.add("radio-container");

    var input = document.createElement("input");
    input.type = "radio";
    input.name = "darkenWhenChecked";
    input.value = name;
    input.id = id;
    input.onchange = () => setDarkenWhenChecked(name);
    div.appendChild(input);

    // Preserve the selected element when the checkboxes change
    if (name == settings.darkenWhenChecked) {
      input.checked = true;
    }

    var label = document.createElement("label");
    label.innerHTML = displayName;
    label.htmlFor = id;
    div.appendChild(label);

    container.appendChild(div);
  }
  createOption("", "None");
  for (var checkbox of settings.checkboxes) {
    createOption(checkbox, checkbox);
  }
}

function updateCheckboxStats(checkbox) {
  var checked = getStoredCheckboxRefs(checkbox).size;
  var total = pcbdata.footprints.length - pcbdata.bom.skipped.length;
  var percent = checked * 100.0 / total;
  var td = document.getElementById("checkbox-stats-" + checkbox);
  td.firstChild.style.width = percent + "%";
  td.lastChild.innerHTML = checked + "/" + total + " (" + Math.round(percent) + "%)";
}

document.onkeydown = function(e) {
  switch (e.key) {
    case "n":
      if (document.activeElement.type == "text") {
        return;
      }
      if (currentHighlightedRowId !== null) {
        checkBomCheckbox(currentHighlightedRowId, "placed");
        highlightNextRow();
        e.preventDefault();
      }
      break;
    case "ArrowUp":
      highlightPreviousRow();
      e.preventDefault();
      break;
    case "ArrowDown":
      highlightNextRow();
      e.preventDefault();
      break;
    default:
      break;
  }
  if (e.altKey) {
    switch (e.key) {
      case "f":
        focusFilterField();
        e.preventDefault();
        break;
      case "r":
        focusRefLookupField();
        e.preventDefault();
        break;
      case "z":
        changeBomLayout("bom-only");
        e.preventDefault();
        break;
      case "x":
        changeBomLayout("left-right");
        e.preventDefault();
        break;
      case "c":
        changeBomLayout("top-bottom");
        e.preventDefault();
        break;
      case "v":
        changeCanvasLayout("F");
        e.preventDefault();
        break;
      case "b":
        changeCanvasLayout("FB");
        e.preventDefault();
        break;
      case "n":
        changeCanvasLayout("B");
        e.preventDefault();
        break;
      default:
        break;
    }
    if (e.key >= '1' && e.key <= '9') {
      toggleBomCheckbox(currentHighlightedRowId, parseInt(e.key));
    }
  }
}

function hideNetlistButton() {
  document.getElementById("bom-ungrouped-btn").classList.remove("middle-button");
  document.getElementById("bom-ungrouped-btn").classList.add("right-most-button");
  document.getElementById("bom-netlist-btn").style.display = "none";
}

window.onload = function(e) {
  initUtils();
  initRender();
  initStorage();
  initDefaults();
  cleanGutters();
  populateMetadata();
  dbgdiv = document.getElementById("dbg");
  bom = document.getElementById("bombody");
  bomhead = document.getElementById("bomhead");
  filter = "";
  reflookup = "";
  if (!("nets" in pcbdata)) {
    hideNetlistButton();
  }
  initDone = true;
  prepCheckboxes();
  // Triggers render
  changeBomLayout(settings.bomlayout);

  // Users may leave fullscreen without touching the checkbox. Uncheck.
  document.addEventListener('fullscreenchange', () => {
    if (!document.fullscreenElement)
      document.getElementById('fullscreenCheckbox').checked = false;
  });
}

window.onresize = resizeAll;
window.matchMedia("print").addListener(resizeAll);

///////////////////////////////////////////////

///////////////////////////////////////////////
 
///////////////////////////////////////////////
  </script>
</head>

<body>
<!-- USERHEADER -->
<div id="topmostdiv" class="topmostdiv">
  <div id="top">
    <div style="float: right; height: 100%;">
      <div class="hideonprint menu" style="float: right; top: 8px;">
        <button class="menubtn"></button>
        <div class="menu-content">
          <label class="menu-label menu-label-top" style="width: calc(50% - 18px)">
            <input id="darkmodeCheckbox" type="checkbox" onchange="setDarkMode(this.checked)">
            Dark mode
          </label><!-- This comment eats space! All of it!
          --><label class="menu-label menu-label-top" style="width: calc(50% - 17px); border-left: 0;">
            <input id="fullscreenCheckbox" type="checkbox" onchange="setFullscreen(this.checked)">
            Full Screen
          </label>
          <label class="menu-label" style="width: calc(50% - 18px)">
            <input id="fabricationCheckbox" type="checkbox" checked onchange="fabricationVisible(this.checked)">
            Fab layer
          </label><!-- This comment eats space! All of it!
          --><label class="menu-label" style="width: calc(50% - 17px); border-left: 0;">
            <input id="silkscreenCheckbox" type="checkbox" checked onchange="silkscreenVisible(this.checked)">
            Silkscreen
          </label>
          <label class="menu-label" style="width: calc(50% - 18px)">
            <input id="referencesCheckbox" type="checkbox" checked onchange="referencesVisible(this.checked)">
            References
          </label><!-- This comment eats space! All of it!
          --><label class="menu-label" style="width: calc(50% - 17px); border-left: 0;">
            <input id="valuesCheckbox" type="checkbox" checked onchange="valuesVisible(this.checked)">
            Values
          </label>
          <div id="tracksAndZonesCheckboxes">
            <label class="menu-label" style="width: calc(50% - 18px)">
              <input id="tracksCheckbox" type="checkbox" checked onchange="tracksVisible(this.checked)">
              Tracks
            </label><!-- This comment eats space! All of it!
            --><label class="menu-label" style="width: calc(50% - 17px); border-left: 0;">
              <input id="zonesCheckbox" type="checkbox" checked onchange="zonesVisible(this.checked)">
              Zones
            </label>
          </div>
          <label class="menu-label" style="width: calc(50% - 18px)">
            <input id="padsCheckbox" type="checkbox" checked onchange="padsVisible(this.checked)">
            Pads
          </label><!-- This comment eats space! All of it!
          --><label class="menu-label" style="width: calc(50% - 17px); border-left: 0;">
            <input id="dnpOutlineCheckbox" type="checkbox" checked onchange="dnpOutline(this.checked)">
            DNP outlined
          </label>
          <label class="menu-label">
            <input id="highlightpin1Checkbox" type="checkbox" onchange="setHighlightPin1(this.checked)">
            Highlight first pin
          </label>
          <label class="menu-label">
            <input id="dragCheckbox" type="checkbox" checked onchange="setRedrawOnDrag(this.checked)">
            Continuous redraw on drag
          </label>
          <label class="menu-label">
            <input id="crosshairCheckbox" type="checkbox" checked onchange="setShowCrosshair(this.checked)">
            Show Crosshair
          </label>
          <label class="menu-label">
            <span>Board rotation</span>
            <span style="float: right"><span id="rotationDegree">0</span>&#176;</span>
            <input id="boardRotation" type="range" min="-36" max="36" value="0" class="slider" oninput="setBoardRotation(this.value)">
          </label>
          <label class="menu-label">
            <div style="margin-left: 5px">Bom checkboxes</div>
            <input id="bomCheckboxes" class="menu-textbox" type=text
                   oninput="setBomCheckboxes(this.value)">
          </label>
          <label class="menu-label">
            <div style="margin-left: 5px">Darken when checked</div>
            <div id="darkenWhenCheckedContainer"></div>
          </label>
          <label class="menu-label">
            <span class="shameless-plug">
              <span>Created using</span>
              <a id="github-link" target="blank" href="https://github.com/openscopeproject/InteractiveHtmlBom">InteractiveHtmlBom</a>
            </span>
          </label>
        </div>
      </div>
      <div class="button-container hideonprint"
           style="float: right; position: relative; top: 8px">
        <button id="fl-btn" class="left-most-button" onclick="changeCanvasLayout('F')"
                title="Front only">F
        </button>
        <button id="fb-btn" class="middle-button" onclick="changeCanvasLayout('FB')"
                title="Front and Back">FB
        </button>
        <button id="bl-btn" class="right-most-button" onclick="changeCanvasLayout('B')"
                title="Back only">B
        </button>
      </div>
      <div class="button-container hideonprint"
           style="float: right; position: relative; top: 8px">
        <button id="bom-btn" class="left-most-button" onclick="changeBomLayout('bom-only')"
                title="BOM only"></button>
        <button id="lr-btn" class="middle-button" onclick="changeBomLayout('left-right')"
                title="BOM left, drawings right"></button>
        <button id="tb-btn" class="right-most-button" onclick="changeBomLayout('top-bottom')"
                title="BOM top, drawings bot"></button>
      </div>
      <div class="button-container hideonprint"
           style="float: right; position: relative; top: 8px">
        <button id="bom-grouped-btn" class="left-most-button" onclick="changeBomMode('grouped')"
                title="Grouped BOM"></button>
        <button id="bom-ungrouped-btn" class="middle-button" onclick="changeBomMode('ungrouped')"
                title="Ungrouped BOM"></button>
        <button id="bom-netlist-btn" class="right-most-button" onclick="changeBomMode('netlist')"
                title="Netlist"></button>
      </div>
      <div class="hideonprint menu" style="float: right; top: 8px;">
        <button class="statsbtn"></button>
        <div class="menu-content">
          <table class="stats">
            <tbody>
              <tr>
                <td width="40%">Board stats</td>
                <td>Front</td>
                <td>Back</td>
                <td>Total</td>
              </tr>
              <tr>
                <td>Components</td>
                <td id="stats-components-front">~</td>
                <td id="stats-components-back">~</td>
                <td id="stats-components-total">~</td>
              </tr>
              <tr>
                <td>Groups</td>
                <td id="stats-groups-front">~</td>
                <td id="stats-groups-back">~</td>
                <td id="stats-groups-total">~</td>
              </tr>
              <tr>
                <td>SMD pads</td>
                <td id="stats-smd-pads-front">~</td>
                <td id="stats-smd-pads-back">~</td>
                <td id="stats-smd-pads-total">~</td>
              </tr>
              <tr>
                <td>TH pads</td>
                <td colspan=3 id="stats-th-pads">~</td>
              </tr>
            </tbody>
          </table>
          <table class="stats">
            <col width="40%"/><col />
            <tbody id="checkbox-stats">
              <tr>
                <td colspan=2 style="border-top: 0">Checkboxes</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="hideonprint menu" style="float: right; top: 8px;">
        <button class="iobtn"></button>
        <div class="menu-content">
          <div class="menu-label menu-label-top">
            <div style="margin-left: 5px;">Save board image</div>
            <div class="flexbox">
              <input id="render-save-width" class="menu-textbox" type="text" value="1000" placeholder="Width"
                  style="flex-grow: 1; width: 50px;" oninput="validateSaveImgDimension(this)">
              <span>X</span>
              <input id="render-save-height" class="menu-textbox" type="text" value="1000" placeholder="Height"
                  style="flex-grow: 1; width: 50px;" oninput="validateSaveImgDimension(this)">
            </div>
            <label>
              <input id="render-save-transparent" type="checkbox">
              Transparent background
            </label>
            <div class="flexbox">
              <button class="savebtn" onclick="saveImage('F')">Front</button>
              <button class="savebtn" onclick="saveImage('B')">Back</button>
            </div>
          </div>
          <div class="menu-label">
            <span style="margin-left: 5px;">Config and checkbox state</span>
            <div class="flexbox">
              <button class="savebtn" onclick="saveSettings()">Export</button>
              <button class="savebtn" onclick="loadSettings()">Import</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="fileinfodiv" style="overflow: auto;">
      <table class="fileinfo">
        <tbody>
          <tr>
            <td id="title" class="title" style="width: 70%">
              Title
            </td>
            <td id="revision" class="title" style="width: 30%">
              Revision
            </td>
          </tr>
          <tr>
            <td id="company">
              Company
            </td>
            <td id="filedate">
              Date
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div id="bot" class="split" style="height: calc(100% - 80px)">
    <div id="bomdiv" class="split split-horizontal">
      <div style="width: 100%">
        <input id="reflookup" class="textbox searchbox reflookup hideonprint" type="text" placeholder="Ref lookup"
               oninput="updateRefLookup(this.value)">
        <input id="filter" class="textbox searchbox filter hideonprint" type="text" placeholder="Filter"
               oninput="updateFilter(this.value)">
        <div class="button-container hideonprint" style="float: left; margin: 0;">
          <button id="copy" title="Copy bom table to clipboard"
               onclick="copyToClipboard()"></button>
        </div>
      </div>
      <div id="dbg"></div>
      <table class="bom">
        <thead id="bomhead">
        </thead>
        <tbody id="bombody">
        </tbody>
      </table>
    </div>
    <div id="canvasdiv" class="split split-horizontal">
      <div id="frontcanvas" class="split" touch-action="none" style="overflow: hidden">
        <div style="position: relative; width: 100%; height: 100%;">
          <canvas id="F_bg" style="position: absolute; left: 0; top: 0; z-index: 0;"></canvas>
          <canvas id="F_fab" style="position: absolute; left: 0; top: 0; z-index: 1;"></canvas>
          <canvas id="F_slk" style="position: absolute; left: 0; top: 0; z-index: 2;"></canvas>
          <canvas id="F_hl" style="position: absolute; left: 0; top: 0; z-index: 3;"></canvas>
        </div>
      </div>
      <div id="backcanvas" class="split" touch-action="none" style="overflow: hidden">
        <div style="position: relative; width: 100%; height: 100%;">
          <canvas id="B_bg" style="position: absolute; left: 0; top: 0; z-index: 0;"></canvas>
          <canvas id="B_fab" style="position: absolute; left: 0; top: 0; z-index: 1;"></canvas>
          <canvas id="B_slk" style="position: absolute; left: 0; top: 0; z-index: 2;"></canvas>
          <canvas id="B_hl" style="position: absolute; left: 0; top: 0; z-index: 3;"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- USERFOOTER -->
</body>

</html>
